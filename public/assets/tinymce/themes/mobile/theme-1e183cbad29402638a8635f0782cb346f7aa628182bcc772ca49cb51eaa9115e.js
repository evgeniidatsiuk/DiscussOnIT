!function(){"use strict";function n(n,e,t){var r=t||!1,o=function(){e(),r=!0},i=function(){n(),r=!1};return{on:o,off:i,toggle:function(){(r?i:o)()},isOn:function(){return r}}}function e(n,e,t,r,o){return n(t,r)?an.some(t):X(o)&&o(t)?an.none():e(t,r,o)}function t(n,e){var t=function(t){var r=e(t);if(r<=0||null===r){var o=du.get(t,n);return parseFloat(o)||0}return r},r=function(n,e){return Xn(e,function(e,t){var r=du.get(n,t),o=r===undefined?0:parseInt(r,10);return isNaN(o)?e:e+o},0)};return{set:function(e,t){if(!K(t)&&!t.match(/^[0-9]+$/))throw n+".set accepts only positive integer values. Value was "+t;var r=e.dom();uu(r)&&(r.style[n]=t+"px")},get:t,getOuter:t,aggregate:r,max:function(n,e,t){var o=r(n,t);return o<e?e-o:0}}}function r(n,e){return i(document.createElement("canvas"),n,e)}function o(n){return n.getContext("2d")}function i(n,e,t){return n.width=e,n.height=t,n}function u(){return new(ot.getOrDie("FileReader"))}function a(n){return new Mf(function(e,t){function r(){a(),e(u)}function o(){a(),t("Unable to load data of type "+n.type+": "+i)}var i=URL.createObjectURL(n),u=new Image,a=function(){u.removeEventListener("load",r),u.removeEventListener("error",o)};u.addEventListener("load",r),u.addEventListener("error",o),u.src=i,u.complete&&r()})}function c(n){return new Mf(function(e,t){var r=new XMLHttpRequest;r.open("GET",n,!0),r.responseType="blob",r.onload=function(){200==this.status&&e(this.response)},r.onerror=function(){var n,e=this;t(0===this.status?((n=new Error("No access to download image")).code=18,n.name="SecurityError",n):new Error("Error "+e.status+" downloading image"))},r.send()})}function s(n){var e=n.split(","),t=/data:([^;]+)/.exec(e[0]);if(!t)return an.none();for(var r,o,i,u=t[1],a=e[1],c=If.atob(a),s=c.length,f=Math.ceil(s/1024),l=new Array(f),d=0;d<f;++d){for(var m=1024*d,g=Math.min(m+1024,s),v=new Array(g-m),p=m,h=0;p<g;++h,++p)v[h]=c[p].charCodeAt(0);l[d]=(r=v,new(ot.getOrDie("Uint8Array"))(r))}return an.some((o=l,i={type:u},new(ot.getOrDie("Blob"))(o,i)))}function f(n){return new Mf(function(e,t){s(n).fold(function(){t("uri is not base64: "+n)},e)})}function l(n){return new Mf(function(e){var t=u();t.onloadend=function(){e(t.result)},t.readAsDataURL(n)})}function d(){var n=function(n){var e=!0===n.scrollable?"${prefix}-toolbar-scrollable-group":"";return{dom:Ns('<div aria-label="'+n.label+'" class="${prefix}-toolbar-group '+e+'"></div>'),tgroupBehaviours:wo([Gf("adhoc-scrollable-toolbar",!0===n.scrollable?[Zr(function(n){du.set(n.element(),"overflow-x","auto"),jg.markAsHorizontal(n.element()),Wd.register(n.element())})]:[])]),components:[Kf.sketch({components:[Vg.parts().items({})]})],markers:{itemClass:nu.resolve("toolbar-group-item")},items:n.items}},e=sd(Ng.sketch({dom:Ns('<div class="${prefix}-toolbar"></div>'),components:[Ng.parts().groups({})],toolbarBehaviours:wo([Xi.config({toggleClass:nu.resolve("context-toolbar"),toggleOnExecute:!1,aria:{mode:"none"}}),kc.config({mode:"cyclic"})]),shell:!0})),t=sd(Kf.sketch({dom:{classes:[nu.resolve("toolstrip")]},components:[fd(e)],containerBehaviours:wo([Xi.config({toggleClass:nu.resolve("android-selection-context-toolbar"),toggleOnExecute:!1})])})),r=function(){Ng.setGroups(e,o.get()),Xi.off(e)},o=Yo([]);return{wrapper:V(t),toolbar:V(e),createGroups:function(e){return $n(e,F(Vg.sketch,n))},setGroups:function(n){o.set(n),r()},setContextToolbar:function(n){Xi.on(e),Ng.setGroups(e,n)},restoreToolbar:function(){Xi.isOn(e)&&r()},refresh:function(){},focus:function(){kc.focusIn(e)}}}function m(){var n={};return{registerId:function(e,t,r){sn(r,function(r,o){var i=n[o]!==undefined?n[o]:{};i[t]=Ul(r,e),n[o]=i})},unregisterId:function(e){sn(n,function(n){n.hasOwnProperty(e)&&delete n[e]})},filterByType:function(e){return Qt(n,e).map(function(n){return dn(n,function(n,e){return bv(e,n)})}).getOr([])},find:function(e,t,r){var o=Kt(t)(n);return pv(r,function(n){return e=o,ws(t=n).fold(function(){return an.none()},function(n){var r=Kt(n);return e.bind(r).map(function(n){return hv(t,n)})});var e,t},e)}}}function g(){var n=m(),e={},t=function(n){var e=n.element();return ws(e).fold(function(){return e="uid-",t=n.element(),r=zc(bs+e),Ao.set(t,ys,r),r;var e,t,r},function(n){return n})},r=function(t){ws(t.element()).each(function(t){e[t]=undefined,n.unregisterId(t)})};return{find:function(e,t,r){return n.find(e,t,r)},filter:function(e){return n.filterByType(e)},register:function(o){var i=t(o);tr(e,i)&&function(n,t){var o=e[t];if(o!==n)throw new Error('The tagId "'+t+'" is already used by: '+pi(o.element())+"\nCannot use it for: "+pi(n.element())+"\nThe conflicting element is"+(qe.inBody(o.element())?" ":" not ")+"already in the DOM");r(n)}(o,i);var u=[o];n.registerId(u,i,o.events()),e[i]=o},unregister:r,getById:function(n){return Kt(n)(e)}}}function v(n){var e=sd(Kf.sketch({dom:{classes:[nu.resolve("outer-container")].concat(n.classes)},containerBehaviours:wo([qo.config({alpha:wv(),omega:xv()})])}));return yv(e)}var p,h,b,y,w,x,T,S,O,C,k,E,D,A,R,M,I,N,B=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e]},F=function(n,e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return n(e.apply(null,arguments))}},V=function(n){return function(){return n}},H=function(n){return n},z=function(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];for(var r=new Array(arguments.length-1),o=1;o<arguments.length;o++)r[o-1]=arguments[o];return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var o=new Array(arguments.length),i=0;i<o.length;i++)o[i]=arguments[i];var u=r.concat(o);return n.apply(null,u)}},j=function(n){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return!n.apply(null,arguments)}},L=function(n){return function(){throw new Error(n)}},U=function(n){return n()},P=V(!1),_=V(!0),W=function(n){return function(e){return function(n){if(null===n)return"null";var e=typeof n;return"object"===e&&Array.prototype.isPrototypeOf(n)?"array":"object"===e&&String.prototype.isPrototypeOf(n)?"string":e}(e)===n}},$=W("string"),G=W("object"),q=W("array"),Y=W("boolean"),X=W("function"),K=W("number"),J=Object.prototype.hasOwnProperty,Q=function(n){return function(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];if(0===e.length)throw new Error("Can't merge zero objects");for(var r={},o=0;o<e.length;o++){var i=e[o];for(var u in i)J.call(i,u)&&(r[u]=n(r[u],i[u]))}return r}},Z=Q(function(n,e){return G(n)&&G(e)?Z(n,e):e}),nn=Q(function(n,e){return e}),en=P,tn=_,rn=function(){return on},on=(y={fold:function(n){return n()},is:en,isSome:en,isNone:tn,getOr:b=function(n){return n},getOrThunk:h=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:function(){return null},getOrUndefined:function(){return undefined},or:b,orThunk:h,map:rn,ap:rn,each:function(){},bind:rn,flatten:rn,exists:en,forall:tn,filter:rn,equals:p=function(n){return n.isNone()},equals_:p,toArray:function(){return[]},toString:V("none()")},Object.freeze&&Object.freeze(y),y),un=function(n){var e=function(){return n},t=function(){return o},r=function(e){return e(n)},o={fold:function(e,t){return t(n)},is:function(e){return n===e},isSome:tn,isNone:en,getOr:e,getOrThunk:e,getOrDie:e,getOrNull:e,getOrUndefined:e,or:t,orThunk:t,map:function(e){return un(e(n))},ap:function(e){return e.fold(rn,function(e){return un(e(n))})},each:function(e){e(n)},bind:r,flatten:e,exists:r,forall:r,filter:function(e){return e(n)?o:on},equals:function(e){return e.is(n)},equals_:function(e,t){return e.fold(en,function(e){return t(n,e)})},toArray:function(){return[n]},toString:function(){return"some("+n+")"}};return o},an={some:un,none:rn,from:function(n){return null===n||n===undefined?on:un(n)}},cn=Object.keys,sn=function(n,e){for(var t=cn(n),r=0,o=t.length;r<o;r++){var i=t[r];e(n[i],i,n)}},fn=function(n,e){return ln(n,function(n,t,r){return{k:t,v:e(n,t,r)}})},ln=function(n,e){var t={};return sn(n,function(r,o){var i=e(r,o,n);t[i.k]=i.v}),t},dn=function(n,e){var t=[];return sn(n,function(n,r){t.push(e(n,r))}),t},mn=V("touchstart"),gn=V("touchmove"),vn=V("touchend"),pn=V("mousedown"),hn=V("mousemove"),bn=V("mouseup"),yn=V("mouseover"),wn=V("keydown"),xn=V("input"),Tn=V("change"),Sn=V("click"),On=V("transitionend"),Cn=V("selectstart"),kn=function(n){var e,t=!1;return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];return t||(t=!0,e=n.apply(null,r)),e}},En=function(n,e){var t=function(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(r.test(e))return r}return undefined}(n,e);if(!t)return{major:0,minor:0};var r=function(n){return Number(e.replace(t,"$"+n))};return An(r(1),r(2))},Dn=function(){return An(0,0)},An=function(n,e){return{major:n,minor:e}},Rn={nu:An,detect:function(n,e){var t=String(e).toLowerCase();return 0===n.length?Dn():En(n,t)},unknown:Dn},Mn="Firefox",In=function(n,e){return function(){return e===n}},Nn=function(n){var e=n.current;return{current:e,version:n.version,isEdge:In("Edge",e),isChrome:In("Chrome",e),isIE:In("IE",e),isOpera:In("Opera",e),isFirefox:In(Mn,e),isSafari:In("Safari",e)}},Bn={unknown:function(){return Nn({current:undefined,version:Rn.unknown()})},nu:Nn,edge:V("Edge"),chrome:V("Chrome"),ie:V("IE"),opera:V("Opera"),firefox:V(Mn),safari:V("Safari")},Fn="Windows",Vn="Android",Hn="Solaris",zn="FreeBSD",jn=function(n,e){return function(){return e===n}},Ln=function(n){var e=n.current;return{current:e,version:n.version,isWindows:jn(Fn,e),isiOS:jn("iOS",e),isAndroid:jn(Vn,e),isOSX:jn("OSX",e),isLinux:jn("Linux",e),isSolaris:jn(Hn,e),isFreeBSD:jn(zn,e)}},Un={unknown:function(){return Ln({current:undefined,version:Rn.unknown()})},nu:Ln,windows:V(Fn),ios:V("iOS"),android:V(Vn),linux:V("Linux"),osx:V("OSX"),solaris:V(Hn),freebsd:V(zn)},Pn=(w=Array.prototype.indexOf)===undefined?function(n,e){return Qn(n,e)}:function(n,e){return w.call(n,e)},_n=function(n,e){return-1<Pn(n,e)},Wn=function(n,e){return Jn(n,e).isSome()},$n=function(n,e){for(var t=n.length,r=new Array(t),o=0;o<t;o++){var i=n[o];r[o]=e(i,o,n)}return r},Gn=function(n,e){for(var t=0,r=n.length;t<r;t++)e(n[t],t,n)},qn=function(n,e){for(var t=[],r=0,o=n.length;r<o;r++){var i=n[r];e(i,r,n)&&t.push(i)}return t},Yn=function(n,e,t){return function(n,e){for(var t=n.length-1;0<=t;t--)e(n[t],t,n)}(n,function(n){t=e(t,n)}),t},Xn=function(n,e,t){return Gn(n,function(n){t=e(t,n)}),t},Kn=function(n,e){for(var t=0,r=n.length;t<r;t++){var o=n[t];if(e(o,t,n))return an.some(o)}return an.none()},Jn=function(n,e){for(var t=0,r=n.length;t<r;t++)if(e(n[t],t,n))return an.some(t);return an.none()},Qn=function(n,e){for(var t=0,r=n.length;t<r;++t)if(n[t]===e)return t;return-1},Zn=Array.prototype.push,ne=function(n){for(var e=[],t=0,r=n.length;t<r;++t){if(!Array.prototype.isPrototypeOf(n[t]))throw new Error("Arr.flatten item "+t+" was not an array, input: "+n);Zn.apply(e,n[t])}return e},ee=function(n,e){var t=$n(n,e);return ne(t)},te=function(n,e){for(var t=0,r=n.length;t<r;++t)if(!0!==e(n[t],t,n))return!1;return!0},re=Array.prototype.slice,oe=function(n){var e=re.call(n,0);return e.reverse(),e},ie=function(n){return[n]},ue=(X(Array.from)&&Array.from,function(n,e){var t=String(e).toLowerCase();return Kn(n,function(n){return n.search(t)})}),ae=function(n,e){return ue(n,e).map(function(n){var t=Rn.detect(n.versionRegexes,e);return{current:n.name,version:t}})},ce=function(n,e){return ue(n,e).map(function(n){var t=Rn.detect(n.versionRegexes,e);return{current:n.name,version:t}})},se=function(n,e){return-1!==n.indexOf(e)},fe=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,le=function(n){return function(e){return se(e,n)}},de=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(n){return se(n,"edge/")&&se(n,"chrome")&&se(n,"safari")&&se(n,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,fe],search:function(n){return se(n,"chrome")&&!se(n,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(n){return se(n,"msie")||se(n,"trident")}},{name:"Opera",versionRegexes:[fe,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:le("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:le("firefox")},{name:"Safari",versionRegexes:[fe,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(n){return(se(n,"safari")||se(n,"mobile/"))&&se(n,"applewebkit")}}],me=[{name:"Windows",search:le("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(n){return se(n,"iphone")||se(n,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:le("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:le("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:le("linux"),versionRegexes:[]},{name:"Solaris",search:le("sunos"),versionRegexes:[]},{name:"FreeBSD",search:le("freebsd"),versionRegexes:[]}],ge={browsers:V(de),oses:V(me)},ve=function(n){var e,t,r,o,i,u,a,c,s,f,l,d=ge.browsers(),m=ge.oses(),g=ae(d,n).fold(Bn.unknown,Bn.nu),v=ce(m,n).fold(Un.unknown,Un.nu);return{browser:g,os:v,deviceType:(t=g,r=n,o=(e=v).isiOS()&&!0===/ipad/i.test(r),i=e.isiOS()&&!o,u=e.isAndroid()&&3===e.version.major,a=e.isAndroid()&&4===e.version.major,c=o||u||a&&!0===/mobile/i.test(r),s=e.isiOS()||e.isAndroid(),f=s&&!c,l=t.isSafari()&&e.isiOS()&&!1===/safari/i.test(r),{isiPad:V(o),isiPhone:V(i),isTablet:V(c),isPhone:V(f),isTouch:V(s),isAndroid:e.isAndroid,isiOS:e.isiOS,isWebView:V(l)})}},pe={detect:kn(function(){var n=navigator.userAgent;return ve(n)})},he={tap:V("alloy.tap")},be=V("alloy.focus"),ye=V("alloy.blur.post"),we=V("alloy.receive"),xe=V("alloy.execute"),Te=V("alloy.focus.item"),Se=he.tap,Oe=pe.detect().deviceType.isTouch()?he.tap:Sn,Ce=V("alloy.longpress"),ke=V("alloy.system.init"),Ee=V("alloy.system.scroll"),De=V("alloy.system.attached"),Ae=V("alloy.system.detached"),Re=function(n,e){Be(n,n.element(),e,{})},Me=function(n,e,t){Be(n,n.element(),e,t)},Ie=function(n){Re(n,xe())},Ne=function(n,e,t){Be(n,e,t,{})},Be=function(n,e,t,r){var o=Z({target:e},r);n.getSystem().triggerEvent(t,e,fn(o,V))},Fe=function(n){if(null===n||n===undefined)throw new Error("Node cannot be null or undefined");return{dom:V(n)}},Ve={fromHtml:function(n,e){var t=(e||document).createElement("div");if(t.innerHTML=n,!t.hasChildNodes()||1<t.childNodes.length)throw console.error("HTML does not have a single root node",n),"HTML must have a single root node";return Fe(t.childNodes[0])},fromTag:function(n,e){var t=(e||document).createElement(n);return Fe(t)},fromText:function(n,e){var t=(e||document).createTextNode(n);return Fe(t)},fromDom:Fe,fromPoint:function(n,e,t){var r=n.dom();return an.from(r.elementFromPoint(e,t)).map(Fe)}},He={ATTRIBUTE:Node.ATTRIBUTE_NODE,CDATA_SECTION:Node.CDATA_SECTION_NODE,COMMENT:Node.COMMENT_NODE,DOCUMENT:Node.DOCUMENT_NODE,DOCUMENT_TYPE:Node.DOCUMENT_TYPE_NODE,DOCUMENT_FRAGMENT:Node.DOCUMENT_FRAGMENT_NODE,ELEMENT:Node.ELEMENT_NODE,TEXT:Node.TEXT_NODE,PROCESSING_INSTRUCTION:Node.PROCESSING_INSTRUCTION_NODE,ENTITY_REFERENCE:Node.ENTITY_REFERENCE_NODE,ENTITY:Node.ENTITY_NODE,NOTATION:Node.NOTATION_NODE},ze=function(n){return n.dom().nodeName.toLowerCase()},je=function(n){return n.dom().nodeType},Le=function(n){return function(e){return je(e)===n}},Ue=Le(He.ELEMENT),Pe=Le(He.TEXT),_e=Le(He.DOCUMENT),We={name:ze,type:je,value:function(n){return n.dom().nodeValue},isElement:Ue,isText:Pe,isDocument:_e,isComment:function(n){return je(n)===He.COMMENT||"#comment"===ze(n)}},$e=kn(function(){return Ge(Ve.fromDom(document))}),Ge=function(n){var e=n.dom().body;if(null===e||e===undefined)throw"Body is not available yet";return Ve.fromDom(e)},qe={body:$e,getBody:Ge,inBody:function(n){var e=We.isText(n)?n.dom().parentNode:n.dom();return e!==undefined&&null!==e&&e.ownerDocument.body.contains(e)}},Ye=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(n.length!==e.length)throw new Error('Wrong number of arguments to struct. Expected "['+n.length+']", got '+e.length+" arguments");var r={};return Gn(n,function(n,t){r[n]=V(e[t])}),r}},Xe=function(n){return n.slice(0).sort()},Ke=function(n,e){throw new Error("All required keys ("+Xe(n).join(", ")+") were not specified. Specified keys were: "+Xe(e).join(", ")+".")},Je=function(n){throw new Error("Unsupported keys for object: "+Xe(n).join(", "))},Qe=function(n,e){if(!q(e))throw new Error("The "+n+" fields must be an array. Was: "+e+".");Gn(e,function(e){if(!$(e))throw new Error("The value "+e+" in the "+n+" fields was not a string.")})},Ze=function(n){var e=Xe(n);Kn(e,function(n,t){return t<e.length-1&&n===e[t+1]}).each(function(n){throw new Error("The field: "+n+" occurs more than once in the combined fields: ["+e.join(", ")+"].")})},nt=function(n,e){var t=n.concat(e);if(0===t.length)throw new Error("You must specify at least one required or optional field.");return Qe("required",n),Qe("optional",e),Ze(t),function(r){var o=cn(r);te(n,function(n){return _n(o,n)})||Ke(n,o);var i=qn(o,function(n){return!_n(t,n)});0<i.length&&Je(i);var u={};return Gn(n,function(n){u[n]=V(r[n])}),Gn(e,function(n){u[n]=V(Object.prototype.hasOwnProperty.call(r,n)?an.some(r[n]):an.none())}),u}},et=function(n,e){for(var t=[],r=function(n){return t.push(n),e(n)},o=e(n);(o=o.bind(r)).isSome(););return t},tt="undefined"!=typeof window?window:Function("return this;")(),rt=function(n,e){return function(n,e){for(var t=e!==undefined&&null!==e?e:tt,r=0;r<n.length&&t!==undefined&&null!==t;++r)t=t[n[r]];return t}(n.split("."),e)},ot={getOrDie:function(n,e){var t=rt(n,e);if(t===undefined||null===t)throw n+" not available on this browser";return t}},it=He.ELEMENT,ut=He.DOCUMENT,at=function(n){return n.nodeType!==it&&n.nodeType!==ut||0===n.childElementCount},ct={all:function(n,e){var t=e===undefined?document:e.dom();return at(t)?[]:$n(t.querySelectorAll(n),Ve.fromDom)},is:function(n,e){var t=n.dom();if(t.nodeType!==it)return!1;if(t.matches!==undefined)return t.matches(e);if(t.msMatchesSelector!==undefined)return t.msMatchesSelector(e);if(t.webkitMatchesSelector!==undefined)return t.webkitMatchesSelector(e);if(t.mozMatchesSelector!==undefined)return t.mozMatchesSelector(e);throw new Error("Browser lacks native selectors")},one:function(n,e){var t=e===undefined?document:e.dom();return at(t)?an.none():an.from(t.querySelector(n)).map(Ve.fromDom)}},st=function(n,e){return n.dom()===e.dom()},ft=(pe.detect().browser.isIE(),st),lt=function(n){var e=n.dom();return an.from(e.parentNode).map(Ve.fromDom)},dt=function(n){var e=n.dom();return an.from(e.previousSibling).map(Ve.fromDom)},mt=function(n){var e=n.dom();return an.from(e.nextSibling).map(Ve.fromDom)},gt=function(n){var e=n.dom();return $n(e.childNodes,Ve.fromDom)},vt=function(n,e){var t=n.dom().childNodes;return an.from(t[e]).map(Ve.fromDom)},pt=Ye("element","offset"),ht={owner:function(n){return Ve.fromDom(n.dom().ownerDocument)},defaultView:function(n){var e=n.dom().ownerDocument.defaultView;return Ve.fromDom(e)},documentElement:function(n){return Ve.fromDom(n.dom().ownerDocument.documentElement)},parent:lt,findIndex:function(n){return lt(n).bind(function(e){var t=gt(e);return Jn(t,function(e){return ft(n,e)})})},parents:function(n,e){for(var t=X(e)?e:V(!1),r=n.dom(),o=[];null!==r.parentNode&&r.parentNode!==undefined;){var i=r.parentNode,u=Ve.fromDom(i);if(o.push(u),!0===t(u))break;r=i}return o},siblings:function(n){return lt(n).map(gt).map(function(e){return qn(e,function(e){return!ft(n,e)})}).getOr([])},prevSibling:dt,offsetParent:function(n){var e=n.dom();return an.from(e.offsetParent).map(Ve.fromDom)},prevSiblings:function(n){return oe(et(n,dt))},nextSibling:mt,nextSiblings:function(n){return et(n,mt)},children:gt,child:vt,firstChild:function(n){return vt(n,0)},lastChild:function(n){return vt(n,n.dom().childNodes.length-1)},childNodesCount:function(n){return n.dom().childNodes.length},hasChildNodes:function(n){return n.dom().hasChildNodes()},leaf:function(n,e){var t=gt(n);return 0<t.length&&e<t.length?pt(t[e],0):pt(n,e)}},bt=function(n,e){ht.parent(n).each(function(t){t.dom().insertBefore(e.dom(),n.dom())})},yt=function(n,e){n.dom().appendChild(e.dom())},wt={before:bt,after:function(n,e){ht.nextSibling(n).fold(function(){ht.parent(n).each(function(n){yt(n,e)})},function(n){bt(n,e)})},prepend:function(n,e){ht.firstChild(n).fold(function(){yt(n,e)},function(t){n.dom().insertBefore(e.dom(),t.dom())})},append:yt,appendAt:function(n,e,t){ht.child(n,t).fold(function(){yt(n,e)},function(n){bt(n,e)})},wrap:function(n,e){bt(n,e),yt(e,n)}},xt=function(n,e){Gn(e,function(e){wt.before(n,e)})},Tt=function(n,e){Gn(e,function(e){wt.append(n,e)})},St=function(n){var e=n.dom();null!==e.parentNode&&e.parentNode.removeChild(e)},Ot={empty:function(n){n.dom().textContent="",Gn(ht.children(n),function(n){St(n)})},remove:St,unwrap:function(n){var e=ht.children(n);0<e.length&&xt(n,e),St(n)}},Ct=function(n){Re(n,Ae());var e=n.components();Gn(e,Ct)},kt=function(n){var e=n.components();Gn(e,kt),Re(n,De())},Et=function(n,e){Dt(n,e,wt.append)},Dt=function(n,e,t){n.getSystem().addToWorld(e),t(n.element(),e.element()),qe.inBody(n.element())&&kt(e),n.syncComponents()},At=function(n){Ct(n),Ot.remove(n.element()),n.getSystem().removeFromWorld(n)},Rt=function(n){var e=ht.parent(n.element()).bind(function(e){return n.getSystem().getByDom(e).fold(an.none,an.some)});At(n),e.each(function(n){n.syncComponents()})},Mt=function(n){return{is:function(e){return n===e},isValue:_,isError:P,getOr:V(n),getOrThunk:V(n),getOrDie:V(n),or:function(){return Mt(n)},orThunk:function(){return Mt(n)},fold:function(e,t){return t(n)},map:function(e){return Mt(e(n))},each:function(e){e(n)},bind:function(e){return e(n)},exists:function(e){return e(n)},forall:function(e){return e(n)},toOption:function(){return an.some(n)}}},It=function(n){return{is:P,isValue:P,isError:_,getOr:H,getOrThunk:function(n){return n()},getOrDie:function(){return L(String(n))()},or:function(n){return n},orThunk:function(n){return n()},fold:function(e){return e(n)},map:function(){return It(n)},each:B,bind:function(){return It(n)},exists:P,forall:_,toOption:an.none}},Nt={value:Mt,error:It},Bt=function(n){if(!q(n))throw new Error("cases must be an array");if(0===n.length)throw new Error("there must be at least one case");var e=[],t={};return Gn(n,function(r,o){var i=cn(r);if(1!==i.length)throw new Error("one and only one name per case");var u=i[0],a=r[u];if(t[u]!==undefined)throw new Error("duplicate key detected:"+u);if("cata"===u)throw new Error("cannot have a case named cata (sorry)");if(!q(a))throw new Error("case arguments must be an array");e.push(u),t[u]=function(){var t=arguments.length;if(t!==a.length)throw new Error("Wrong number of arguments to case "+u+". Expected "+a.length+" ("+a+"), got "+t);for(var r=new Array(t),i=0;i<r.length;i++)r[i]=arguments[i];return{fold:function(){if(arguments.length!==n.length)throw new Error("Wrong number of arguments to fold. Expected "+n.length+", got "+arguments.length);return arguments[o].apply(null,r)},match:function(n){var t=cn(n);if(e.length!==t.length)throw new Error("Wrong number of arguments to match. Expected: "+e.join(",")+"\nActual: "+t.join(","));if(!te(e,function(n){return _n(t,n)}))throw new Error("Not all branches were specified when using match. Specified: "+t.join(", ")+"\nRequired: "+e.join(", "));return n[u].apply(null,r)},log:function(n){console.log(n,{constructors:e,constructor:u,params:r})}}}}),t},Ft=Bt([{strict:[]},{defaultedThunk:["fallbackThunk"]},{asOption:[]},{asDefaultedOptionThunk:["fallbackThunk"]},{mergeWithThunk:["baseThunk"]}]),Vt=function(n){return Ft.defaultedThunk(V(n))},Ht=Ft.strict,zt=Ft.asOption,jt=Ft.defaultedThunk,Lt=(Ft.asDefaultedOptionThunk,Ft.mergeWithThunk),Ut=(Bt([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),function(n){var e=[],t=[];return Gn(n,function(n){n.fold(function(n){e.push(n)},function(n){t.push(n)})}),{errors:e,values:t}}),Pt=function(n){return F(Nt.error,ne)(n)},_t=function(n,e){var t,r,o=Ut(n);return 0<o.errors.length?Pt(o.errors):(t=o.values,r=e,Nt.value(Z.apply(undefined,[r].concat(t))))},Wt=function(n){var e=Ut(n);return 0<e.errors.length?Pt(e.errors):Nt.value(e.values)},$t=function(n){return function(e){return e.hasOwnProperty(n)?an.from(e[n]):an.none()}},Gt=function(n,e){return $t(e)(n)},qt=function(n,e){var t={};return t[n]=e,t},Yt=function(n,e){return t=n,r={},Gn(e,function(n){t[n]!==undefined&&t.hasOwnProperty(n)&&(r[n]=t[n])}),r;var t,r},Xt=function(n,e){return t=e,r={},sn(n,function(n,e){_n(t,e)||(r[e]=n)}),r;var t,r},Kt=function(n){return $t(n)},Jt=function(n,e){return t=n,r=e,function(n){return $t(t)(n).getOr(r)};var t,r},Qt=function(n,e){return Gt(n,e)},Zt=function(n,e){return qt(n,e)},nr=function(n){return e={},Gn(n,function(n){e[n.key]=n.value}),e;var e},er=function(n,e){return _t(n,e)},tr=function(n,e){return r=e,(t=n).hasOwnProperty(r)&&t[r]!==undefined&&null!==t[r];var t,r},rr=Bt([{setOf:["validator","valueType"]},{arrOf:["valueType"]},{objOf:["fields"]},{itemOf:["validator"]},{choiceOf:["key","branches"]},{thunk:["description"]},{func:["args","outputSchema"]}]),or=Bt([{field:["name","presence","type"]},{state:["name"]}]),ir=function(){return ot.getOrDie("JSON")},ur=function(n,e,t){return ir().stringify(n,e,t)},ar=function(n){return G(n)&&100<cn(n).length?" removed due to size":ur(n,null,2)},cr=function(n,e){return Nt.error([{path:n,getErrorInfo:e}])},sr=Bt([{field:["key","okey","presence","prop"]},{state:["okey","instantiator"]}]),fr=function(n,e,t){return Gt(e,t).fold(function(){return r=t,o=e,cr(n,function(){return'Could not find valid *strict* value for "'+r+'" in '+ar(o)});var r,o},Nt.value)},lr=function(n,e,t){var r=Gt(n,e).fold(function(){return t(n)},H);return Nt.value(r)},dr=function(n,e,t,r){return t.fold(function(t,o,i,u){var a=function(e){return u.extract(n.concat([t]),r,e).map(function(n){return qt(o,r(n))})},c=function(e){return e.fold(function(){var n=qt(o,r(an.none()));return Nt.value(n)},function(e){return u.extract(n.concat([t]),r,e).map(function(n){return qt(o,r(an.some(n)))})})};return i.fold(function(){return fr(n,e,t).bind(a)},function(n){return lr(e,t,n).bind(a)},function(){return(n=e,r=t,Nt.value(Gt(n,r))).bind(c);var n,r},function(n){return(r=e,o=t,i=n,u=Gt(r,o).map(function(n){return!0===n?i(r):n}),Nt.value(u)).bind(c);var r,o,i,u},function(n){var r=n(e);return lr(e,t,V({})).map(function(n){return Z(r,n)}).bind(a)})},function(n,t){var o=t(e);return Nt.value(qt(n,r(o)))})},mr=function(n){return{extract:function(e,t,r){return n(r,t).fold(function(n){return t=n,cr(e,function(){return t});var t},Nt.value)},toString:function(){return"val"},toDsl:function(){return rr.itemOf(n)}}},gr=function(n){var e=vr(n),t=Yn(n,function(n,e){return e.fold(function(e){return Z(n,Zt(e,!0))},V(n))},{});return{extract:function(n,r,o){var i,u,a,c=Y(o)?[]:(u=cn(i=o),qn(u,function(n){return tr(i,n)})),s=qn(c,function(n){return!tr(t,n)});return 0===s.length?e.extract(n,r,o):(a=s,cr(n,function(){return"There are unsupported fields: ["+a.join(", ")+"] specified"}))},toString:e.toString,toDsl:e.toDsl}},vr=function(n){return{extract:function(e,t,r){return o=e,i=r,u=t,a=$n(n,function(n){return dr(o,i,n,u)}),_t(a,{});var o,i,u,a},toString:function(){return"obj{\n"+$n(n,function(n){return n.fold(function(n,e,t,r){return n+" -> "+r.toString()},function(n){return"state("+n+")"})}).join("\n")+"}"},toDsl:function(){return rr.objOf($n(n,function(n){return n.fold(function(n,e,t,r){return or.field(n,t,r)},function(n){return or.state(n)})}))}}},pr=function(n,e){var t=function(e,t){return(r=mr(n),{extract:function(n,e,t){var o=$n(t,function(t,o){return r.extract(n.concat(["["+o+"]"]),e,t)});return Wt(o)},toString:function(){return"array("+r.toString()+")"},toDsl:function(){return rr.arrOf(r)}}).extract(e,H,t);var r};return{extract:function(n,r,o){var i=cn(o);return t(n,i).bind(function(t){var i=$n(t,function(n){return sr.field(n,n,Ht(),e)});return vr(i).extract(n,r,o)})},toString:function(){return"setOf("+e.toString()+")"},toDsl:function(){return rr.setOf(n,e)}}},hr=V(mr(Nt.value)),br=sr.state,yr=sr.field,wr=function(n,e,t,r,o){return Qt(r,o).fold(function(){return e=r,t=o,cr(n,function(){return'The chosen schema: "'+t+'" did not exist in branches: '+ar(e)});var e,t},function(r){return vr(r).extract(n.concat(["branch: "+o]),e,t)})},xr=function(n,e){return{extract:function(t,r,o){return Qt(o,n).fold(function(){return e=n,cr(t,function(){return'Choice schema did not contain choice key: "'+e+'"'});var e},function(n){return wr(t,r,o,e,n)})},toString:function(){return"chooseOn("+n+"). Possible values: "+cn(e)},toDsl:function(){return rr.choiceOf(n,e)}}},Tr=mr(Nt.value),Sr=function(n,e,t,r){return e.extract([n],t,r).fold(function(n){return Nt.error({input:r,errors:n})},Nt.value)},Or=function(n,e,t){return Sr(n,e,V,t)},Cr=function(n){return n.fold(function(n){throw new Error(Dr(n))},H)},kr=function(n,e,t){return Cr(Sr(n,e,H,t))},Er=function(n,e,t){return Cr(Or(n,e,t))},Dr=function(n){return"Errors: \n"+(t=10<(e=n.errors).length?e.slice(0,10).concat([{path:[],getErrorInfo:function(){return"... (only showing first ten failures)"}}]):e,$n(t,function(n){return"Failed path: ("+n.path.join(" > ")+")\n"+n.getErrorInfo()}))+"\n\nInput object: "+ar(n.input);var e,t},Ar=function(n,e){return xr(n,e)},Rr=V(Tr),Mr=(x=X,T="function",mr(function(n){var e=typeof n;return x(n)?Nt.value(n):Nt.error("Expected type: "+T+" but got: "+e)})),Ir=function(n){return yr(n,n,Ht(),hr())},Nr=function(n,e){return yr(n,n,Ht(),e)},Br=function(n){return Nr(n,Mr)},Fr=function(n,e){return yr(n,n,Ht(),vr(e))},Vr=function(n){return yr(n,n,zt(),hr())},Hr=function(n,e){return yr(n,n,zt(),vr(e))},zr=function(n,e){return yr(n,n,zt(),gr(e))},jr=function(n,e){return yr(n,n,Vt(e),hr())},Lr=function(n,e,t){return yr(n,n,Vt(e),t)},Ur=function(n,e){return br(n,e)},Pr=function(n){if(!tr(n,"can")&&!tr(n,"abort")&&!tr(n,"run"))throw new Error("EventHandler defined by: "+ur(n,null,2)+" does not have can, abort, or run!");return kr("Extracting event.handler",gr([jr("can",V(!0)),jr("abort",V(!1)),jr("run",B)]),n)},_r=function(n){var e,t,r,o,i=(e=n,t=function(n){return n.can},function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return Xn(e,function(e,r){return e&&t(r).apply(undefined,n)},!0)}),u=(r=n,o=function(n){return n.abort},function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Xn(r,function(e,t){return e||o(t).apply(undefined,n)},!1)});return Pr({can:i,abort:u,run:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Gn(n,function(n){n.run.apply(undefined,e)})}})},Wr=function(n){return nr(n)},$r=function(n,e){return{key:n,value:Pr({abort:e})}},Gr=function(n,e){return{key:n,value:Pr({run:e})}},qr=function(n,e,t){return{key:n,value:Pr({run:function(n){e.apply(undefined,[n].concat(t))}})}},Yr=function(n){return function(e){return{key:n,value:Pr({run:function(n,t){var r;r=t,ft(n.element(),r.event().target())&&e(n,t)}})}}},Xr=function(n,e,t){var r,o,i=e.partUids()[t];return o=i,Gr(r=n,function(n,e){n.getSystem().getByUid(o).each(function(n){var t,o,i,u;o=(t=n).element(),i=r,u=e,t.getSystem().triggerEvent(i,o,u.event())})})},Kr=function(n){return Gr(n,function(n,e){e.cut()})},Jr=Yr(De()),Qr=Yr(Ae()),Zr=Yr(ke()),no=(S=xe(),function(n){return Gr(S,n)}),eo=function(n){return $n(n,function(n){return r=e="/*",o=(t=n).length-e.length,""!==r&&(t.length<r.length||t.substr(o,o+r.length)!==r)?n:n.substring(0,n.length-"/*".length);var e,t,r,o})},to=function(n,e){var t=n.toString(),r=t.indexOf(")")+1,o=t.indexOf("("),i=t.substring(o+1,r-1).split(/,\s*/);return n.toFunctionAnnotation=function(){return{name:e,parameters:eo(i)}},n},ro=nt(["tag"],["classes","attributes","styles","value","innerHtml","domChildren","defChildren"]),oo=function(n){return{tag:n.tag(),classes:n.classes().getOr([]),attributes:n.attributes().getOr({}),styles:n.styles().getOr({}),value:n.value().getOr("<none>"),innerHtml:n.innerHtml().getOr("<none>"),defChildren:n.defChildren().fold(function(){return"<none>"},function(n){return ur(n,null,2)}),domChildren:n.domChildren().fold(function(){return"<none>"},function(n){return 0===n.length?"0 children, but still specified":String(n.length)})}},io=nt([],["classes","attributes","styles","value","innerHtml","defChildren","domChildren"]),uo=function(n,e,t){return e.fold(function(){return t.fold(function(){return{}},function(e){return Zt(n,e)})},function(e){return t.fold(function(){return Zt(n,e)},function(e){return Zt(n,e)})})
},ao=function(n,e,t){return Zr(function(r){t(r,n,e)})},co=function(n,e,t,r,o,i){var u,a,c=n,s=Hr(e,[(u="config",a=n,yr(u,u,zt(),a))]);return lo(c,s,e,t,r,o,i)},so=function(n,e,t){var r,o,i,u,a,c;return r=function(r){for(var o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];var u=[r].concat(o);return r.config({name:V(n)}).fold(function(){throw new Error("We could not find any behaviour configuration for: "+n+". Using API: "+t)},function(n){var t=Array.prototype.slice.call(u,1);return e.apply(undefined,[r,n.config,n.state].concat(t))})},o=t,u=(i=e.toString()).indexOf(")")+1,a=i.indexOf("("),c=i.substring(a+1,u-1).split(/,\s*/),r.toFunctionAnnotation=function(){return{name:o,parameters:eo(c.slice(0,1).concat(c.slice(3)))}},r},fo=function(n){return{key:n,value:undefined}},lo=function(n,e,t,r,o,i,u){var a=function(n){return tr(n,t)?n[t]():an.none()},c=fn(o,function(n,e){return so(t,n,e)}),s=fn(i,function(n,e){return to(n,e)}),f=Z(s,c,{revoke:z(fo,t),config:function(e){var r=Er(t+"-config",n,e);return{key:t,value:{config:r,me:f,configAsRaw:kn(function(){return kr(t+"-config",n,e)}),initialConfig:e,state:u}}},schema:function(){return e},exhibit:function(n,e){return a(n).bind(function(n){return Qt(r,"exhibit").map(function(t){return t(e,n.config,n.state)})}).getOr(io({}))},name:function(){return t},handlers:function(n){return a(n).bind(function(n){return Qt(r,"events").map(function(e){return e(n.config,n.state)})}).getOr({})}});return f},mo=function(n,e){return go(n,e,{validate:X,label:"function"})},go=function(n,e,t){if(0===e.length)throw new Error("You must specify at least one required field.");return Qe("required",e),Ze(e),function(r){var o=cn(r);te(e,function(n){return _n(o,n)})||Ke(e,o),n(e,o);var i=qn(e,function(n){return!t.validate(r[n],n)});return 0<i.length&&function(n,e){throw new Error("All values need to be of type: "+e+". Keys ("+Xe(n).join(", ")+") were not.")}(i,t.label),r}},vo=function(n,e){var t=qn(e,function(e){return!_n(n,e)});0<t.length&&Je(t)},po=B,ho=function(n){return mo(vo,n)},bo={init:function(){return yo({readState:function(){return"No State required"}})}},yo=function(n){return mo(po,["readState"])(n),n},wo=function(n){return nr(n)},xo=gr([Ir("fields"),Ir("name"),jr("active",{}),jr("apis",{}),jr("state",bo),jr("extra",{})]),To=function(n){var e,t,r,o,i,u,a,c,s=kr("Creating behaviour: "+n.name,xo,n);return e=s.fields,t=s.name,r=s.active,o=s.apis,i=s.extra,u=s.state,a=gr(e),c=Hr(t,[zr("config",e)]),lo(a,c,t,r,o,i,u)},So=gr([Ir("branchKey"),Ir("branches"),Ir("name"),jr("active",{}),jr("apis",{}),jr("state",bo),jr("extra",{})]),Oo=V(undefined),Co=function(n,e,t){if(!($(t)||Y(t)||K(t)))throw console.error("Invalid call to Attr.set. Key ",e,":: Value ",t,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(e,t+"")},ko=function(n,e,t){Co(n.dom(),e,t)},Eo=function(n,e){var t=n.dom().getAttribute(e);return null===t?undefined:t},Do=function(n,e){var t=n.dom();return!(!t||!t.hasAttribute)&&t.hasAttribute(e)},Ao={clone:function(n){return Xn(n.dom().attributes,function(n,e){return n[e.name]=e.value,n},{})},set:ko,setAll:function(n,e){var t=n.dom();sn(e,function(n,e){Co(t,e,n)})},get:Eo,has:Do,remove:function(n,e){n.dom().removeAttribute(e)},hasNone:function(n){var e=n.dom().attributes;return e===undefined||null===e||0===e.length},transfer:function(n,e,t){We.isElement(n)&&We.isElement(e)&&Gn(t,function(t){var r,o,i;o=e,Do(r=n,i=t)&&!Do(o,i)&&ko(o,i,Eo(r,i))})}},Ro=function(n,e){var t=Ao.get(n,e);return t===undefined||""===t?[]:t.split(" ")},Mo=Ro,Io=function(n,e,t){var r=Ro(n,e).concat([t]);return Ao.set(n,e,r.join(" ")),!0},No=function(n,e,t){var r=qn(Ro(n,e),function(n){return n!==t});return 0<r.length?Ao.set(n,e,r.join(" ")):Ao.remove(n,e),!1},Bo=function(n){return Mo(n,"class")},Fo=function(n,e){return Io(n,"class",e)},Vo=function(n,e){return No(n,"class",e)},Ho=Bo,zo=Fo,jo=Vo,Lo=function(n,e){return _n(Bo(n),e)?Vo(n,e):Fo(n,e)},Uo=function(n){return n.dom().classList!==undefined},Po=function(n,e){return Uo(n)&&n.dom().classList.contains(e)},_o={add:function(n,e){Uo(n)?n.dom().classList.add(e):zo(n,e)},remove:function(n,e){var t;Uo(n)?n.dom().classList.remove(e):jo(n,e),0===(Uo(t=n)?t.dom().classList:Ho(t)).length&&Ao.remove(t,"class")},toggle:function(n,e){return Uo(n)?n.dom().classList.toggle(e):Lo(n,e)},toggler:function(e,t){var r=Uo(e),o=e.dom().classList;return n(function(){r?o.remove(t):jo(e,t)},function(){r?o.add(t):zo(e,t)},Po(e,t))},has:Po},Wo=function(n,e,t){_o.remove(n,t),_o.add(n,e)},$o=Object.freeze({toAlpha:function(n,e){Wo(n.element(),e.alpha(),e.omega())},toOmega:function(n,e){Wo(n.element(),e.omega(),e.alpha())},isAlpha:function(n,e){return _o.has(n.element(),e.alpha())},isOmega:function(n,e){return _o.has(n.element(),e.omega())},clear:function(n,e){_o.remove(n.element(),e.alpha()),_o.remove(n.element(),e.omega())}}),Go=[Ir("alpha"),Ir("omega")],qo=To({fields:Go,name:"swapping",apis:$o}),Yo=function(n){var e=n,t=function(){return e};return{get:t,set:function(n){e=n},clone:function(){return Yo(t())}}},Xo=function(n,e,t){for(var r=n.dom(),o=X(t)?t:V(!1);r.parentNode;){r=r.parentNode;var i=Ve.fromDom(r);if(e(i))return an.some(i);if(o(i))break}return an.none()},Ko=function(n,e){return Kn(n.dom().childNodes,F(e,Ve.fromDom)).map(Ve.fromDom)},Jo=function(n,e){var t=function(n){for(var r=0;r<n.childNodes.length;r++){if(e(Ve.fromDom(n.childNodes[r])))return an.some(Ve.fromDom(n.childNodes[r]));var o=t(n.childNodes[r]);if(o.isSome())return o}return an.none()};return t(n.dom())},Qo={first:function(n){return Jo(qe.body(),n)},ancestor:Xo,closest:function(n,t,r){return e(function(n){return t(n)},Xo,n,t,r)},sibling:function(n,e){var t=n.dom();return t.parentNode?Ko(Ve.fromDom(t.parentNode),function(t){return!ft(n,t)&&e(t)}):an.none()},child:Ko,descendant:Jo},Zo=function(n){var e=n!==undefined?n.dom():document;return an.from(e.activeElement).map(Ve.fromDom)},ni=function(n){var e=ht.owner(n).dom();return n.dom()===e.activeElement},ei=function(n){n.dom().focus()},ti=function(n){n.dom().blur()},ri=Zo,oi=function(n){return Zo(ht.owner(n)).filter(function(e){return n.dom().contains(e.dom())})},ii=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),ui=tinymce.util.Tools.resolve("tinymce.ThemeManager"),ai=function(n){var e=document.createElement("a");e.target="_blank",e.href=n.href,e.rel="noreferrer noopener";var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),document.body.appendChild(e),e.dispatchEvent(t),document.body.removeChild(e)},ci={formatChanged:V("formatChanged"),orientationChanged:V("orientationChanged"),dropupDismissed:V("dropupDismissed")},si=function(n,e){var t=(e||document).createElement("div");return t.innerHTML=n,ht.children(Ve.fromDom(t))},fi=function(n){return n.dom().innerHTML},li=fi,di=function(n,e){var t=ht.owner(n).dom(),r=Ve.fromDom(t.createDocumentFragment()),o=si(e,t);Tt(r,o),Ot.empty(n),wt.append(n,r)},mi=function(n){var e=Ve.fromTag("div"),t=Ve.fromDom(n.dom().cloneNode(!0));return wt.append(e,t),fi(e)},gi=function(n,e){return Ve.fromDom(n.dom().cloneNode(e))},vi=function(n){return gi(n,!1)},pi=function(n){return e=vi(n),mi(e);var e},hi=Object.freeze({events:function(n){return Wr([Gr(we(),function(e,t){var r,o,i=n.channels(),u=(r=cn(i),(o=t).universal()?r:qn(r,function(n){return _n(o.channels(),n)}));Gn(u,function(n){var r=i[n](),o=r.schema(),u=Er("channel["+n+"] data\nReceiver: "+pi(e.element()),o,t.data());r.onReceive()(e,u)})})])}}),bi=function(n){for(var e=[],t=function(n){e.push(n)},r=0;r<n.length;r++)n[r].each(t);return e},yi=function(n,e){for(var t=0;t<n.length;t++){var r=e(n[t],t);if(r.isSome())return r}return an.none()},wi="unknown",xi=[],Ti=["alloy/data/Fields","alloy/debugging/Debugging"],Si={logEventCut:B,logEventStopped:B,logNoParent:B,logEventNoHandlers:B,logEventResponse:B,write:B},Oi=function(n,e,t){var r,o="*"===xi||_n(xi,n)?(r=[],{logEventCut:function(n,e,t){r.push({outcome:"cut",target:e,purpose:t})},logEventStopped:function(n,e,t){r.push({outcome:"stopped",target:e,purpose:t})},logNoParent:function(n,e,t){r.push({outcome:"no-parent",target:e,purpose:t})},logEventNoHandlers:function(n,e){r.push({outcome:"no-handlers-left",target:e})},logEventResponse:function(n,e,t){r.push({outcome:"response",purpose:t,target:e})},write:function(){_n(["mousemove","mouseover","mouseout",ke()],n)||console.log(n,{event:n,target:e.dom(),sequence:$n(r,function(n){return _n(["cut","stopped","response"],n.outcome)?"{"+n.purpose+"} "+n.outcome+" at ("+pi(n.target)+")":n.outcome})})}}):Si,i=t(o);return o.write(),i},Ci=V([Ir("menu"),Ir("selectedMenu")]),ki=V([Ir("item"),Ir("selectedItem")]),Ei=(V(gr(ki().concat(Ci()))),V(gr(ki()))),Di=Fr("initSize",[Ir("numColumns"),Ir("numRows")]),Ai=function(n,e,t){var r;return function(){var n=new Error;if(n.stack!==undefined){var e=n.stack.split("\n");Kn(e,function(n){return 0<n.indexOf("alloy")&&!Wn(Ti,function(e){return-1<n.indexOf(e)})}).getOr(wi)}}(),yr(e,e,t,(r=function(n){return Nt.value(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.apply(undefined,e)})},mr(function(n){return r(n)})))},Ri=function(n){return Ai(0,n,Vt(B))},Mi=function(n){return Ai(0,n,Vt(an.none))},Ii=function(n){return Ai(0,n,Ht())},Ni=function(n){return Ai(0,n,Ht())},Bi=function(n,e){return Ur(n,V(e))},Fi=function(n){return Ur(n,H)},Vi=V(Di),Hi=[Nr("channels",pr(Nt.value,gr([Ii("onReceive"),jr("schema",Rr())])))],zi=To({fields:Hi,name:"receiving",active:hi}),ji=function(n,e){var t=_i(n,e),r=e.aria();r.update()(n,r,t)},Li=function(n,e){_o.toggle(n.element(),e.toggleClass()),ji(n,e)},Ui=function(n,e){_o.add(n.element(),e.toggleClass()),ji(n,e)},Pi=function(n,e){_o.remove(n.element(),e.toggleClass()),ji(n,e)},_i=function(n,e){return _o.has(n.element(),e.toggleClass())},Wi=function(n,e,t){(e.selected()?Ui:Pi)(n,e,t)},$i=Object.freeze({onLoad:Wi,toggle:Li,isOn:_i,on:Ui,off:Pi}),Gi=Object.freeze({exhibit:function(){return io({})},events:function(n,e){var t,r,o,i=(t=n,r=e,o=Li,no(function(n){o(n,t,r)})),u=ao(n,e,Wi);return Wr(ne([n.toggleOnExecute()?[i]:[],[u]]))}}),qi=function(n,e,t){Ao.set(n.element(),"aria-expanded",t)},Yi=[jr("selected",!1),Ir("toggleClass"),jr("toggleOnExecute",!0),Lr("aria",{mode:"none"},Ar("mode",{pressed:[jr("syncWithExpanded",!1),Bi("update",function(n,e,t){Ao.set(n.element(),"aria-pressed",t),e.syncWithExpanded()&&qi(n,e,t)})],checked:[Bi("update",function(n,e,t){Ao.set(n.element(),"aria-checked",t)})],expanded:[Bi("update",qi)],selected:[Bi("update",function(n,e,t){Ao.set(n.element(),"aria-selected",t)})],none:[Bi("update",B)]}))],Xi=To({fields:Yi,name:"toggling",active:Gi,apis:$i}),Ki=function(n,e){return zi.config({channels:Zt(ci.formatChanged(),{onReceive:function(t,r){r.command===n&&e(t,r.state)}})})},Ji=function(n){return zi.config({channels:Zt(ci.orientationChanged(),{onReceive:n})})},Qi=function(n,e){return{key:n,value:{onReceive:e}}},Zi="tinymce-mobile",nu={resolve:function(n){return Zi+"-"+n},prefix:V(Zi)},eu=function(n,e){e.ignore()||(ei(n.element()),e.onFocus()(n))},tu=Object.freeze({focus:eu,blur:function(n,e){e.ignore()||ti(n.element())},isFocused:function(n){return ni(n.element())}}),ru=Object.freeze({exhibit:function(n,e){return e.ignore()?io({}):io({attributes:{tabindex:"-1"}})},events:function(n){return Wr([Gr(be(),function(e,t){eu(e,n),t.stop()})])}}),ou=[Ri("onFocus"),jr("ignore",!1)],iu=To({fields:ou,name:"focusing",active:ru,apis:tu}),uu=function(n){return n.style!==undefined},au=function(n,e,t){if(!$(t))throw console.error("Invalid call to CSS.set. Property ",e,":: Value ",t,":: Element ",n),new Error("CSS value must be a string: "+t);uu(n)&&n.style.setProperty(e,t)},cu=function(n,e){uu(n)&&n.style.removeProperty(e)},su=function(n,e,t){var r=n.dom();au(r,e,t)},fu=function(n,e){return uu(n)?n.style.getPropertyValue(e):""},lu=function(n,e){var t=n.dom(),r=fu(t,e);return an.from(r).filter(function(n){return 0<n.length})},du={copy:function(n,e){var t=n.dom(),r=e.dom();uu(t)&&uu(r)&&(r.style.cssText=t.style.cssText)},set:su,preserve:function(n,e){var t=Ao.get(n,"style"),r=e(n);return(t===undefined?Ao.remove:Ao.set)(n,"style",t),r},setAll:function(n,e){var t=n.dom();sn(e,function(n,e){au(t,e,n)})},setOptions:function(n,e){var t=n.dom();sn(e,function(n,e){n.fold(function(){cu(t,e)},function(n){au(t,e,n)})})},remove:function(n,e){var t=n.dom();cu(t,e),Ao.has(n,"style")&&""===Ao.get(n,"style").replace(/^\s+|\s+$/g,"")&&Ao.remove(n,"style")},get:function(n,e){var t=n.dom(),r=window.getComputedStyle(t).getPropertyValue(e),o=""!==r||qe.inBody(n)?r:fu(t,e);return null===o?undefined:o},getRaw:lu,getAllRaw:function(n){var e={},t=n.dom();if(uu(t))for(var r=0;r<t.style.length;r++){var o=t.style.item(r);e[o]=t.style[o]}return e},isValidValue:function(n,e,t){var r=Ve.fromTag(n);return su(r,e,t),lu(r,e).isSome()},reflow:function(n){return n.dom().offsetWidth},transfer:function(n,e,t){We.isElement(n)&&We.isElement(e)&&Gn(t,function(t){var r,o;r=e,lu(n,o=t).each(function(n){lu(r,o).isNone()&&su(r,o,n)})})}},mu=t("height",function(n){var e=n.dom();return qe.inBody(n)?e.getBoundingClientRect().height:e.offsetHeight}),gu=function(n){return mu.get(n)},vu=function(n,e,t){return qn(ht.parents(n,t),e)},pu=function(n,e){return qn(ht.siblings(n),e)},hu=function(n){return ct.all(n)},bu=function(n,e,t){return vu(n,function(n){return ct.is(n,e)},t)},yu=function(n,e){return pu(n,function(n){return ct.is(n,e)})},wu=function(n,e){return ct.all(e,n)},xu=function(n,e,t){return Qo.ancestor(n,function(n){return ct.is(n,e)},t)},Tu=function(n){return ct.one(n)},Su=xu,Ou=function(n,e){return ct.one(e,n)},Cu=function(n,t,r){return e(ct.is,xu,n,t,r)},ku=function(n,e,t){var r=oe(n.slice(0,e)),o=oe(n.slice(e+1));return Kn(r.concat(o),t)},Eu=function(n,e,t){var r=oe(n.slice(0,e));return Kn(r,t)},Du=function(n,e,t){var r=n.slice(0,e),o=n.slice(e+1);return Kn(o.concat(r),t)},Au=function(n,e,t){var r=n.slice(e+1);return Kn(r,t)},Ru=function(n){return function(e){var t=e.raw();return _n(n,t.which)}},Mu=function(n){return function(e){return te(n,function(n){return n(e)})}},Iu=function(n){return!0===n.raw().shiftKey},Nu=function(n){return!0===n.raw().ctrlKey},Bu=j(Iu),Fu=function(n,e){return{matches:n,classification:e}},Vu=function(n,e,t,r){var o=n+e;return r<o?t:o<t?r:o},Hu=function(n,e,t){return n<=e?e:t<=n?t:n},zu=function(n,e){var t=wu(n.element(),"."+e.highlightClass());Gn(t,function(t){_o.remove(t,e.highlightClass()),n.getSystem().getByDom(t).each(function(t){e.onDehighlight()(n,t)})})},ju=function(n,e,t,r){var o=Lu(n,e,t,r);zu(n,e),_o.add(r.element(),e.highlightClass()),o||e.onHighlight()(n,r)},Lu=function(n,e,t,r){return _o.has(r.element(),e.highlightClass())},Uu=function(n,e,t,r){var o=wu(n.element(),"."+e.itemClass());return an.from(o[r]).fold(function(){return Nt.error("No element found with index "+r)},n.getSystem().getByDom)},Pu=function(n,e){return Ou(n.element(),"."+e.itemClass()).bind(function(e){return n.getSystem().getByDom(e).toOption()})},_u=function(n,e){var t=wu(n.element(),"."+e.itemClass());return(0<t.length?an.some(t[t.length-1]):an.none()).bind(function(e){return n.getSystem().getByDom(e).toOption()})},Wu=function(n,e,t,r){var o=wu(n.element(),"."+e.itemClass());return Jn(o,function(n){return _o.has(n,e.highlightClass())}).bind(function(e){var t=Vu(e,r,0,o.length-1);return n.getSystem().getByDom(o[t]).toOption()})},$u=Object.freeze({dehighlightAll:zu,dehighlight:function(n,e,t,r){var o=Lu(n,e,t,r);_o.remove(r.element(),e.highlightClass()),o&&e.onDehighlight()(n,r)},highlight:ju,highlightFirst:function(n,e,t){Pu(n,e,t).each(function(r){ju(n,e,t,r)})},highlightLast:function(n,e,t){_u(n,e,t).each(function(r){ju(n,e,t,r)})},highlightAt:function(n,e,t,r){Uu(n,e,t,r).fold(function(n){throw new Error(n)},function(r){ju(n,e,t,r)})},highlightBy:function(n,e,t,r){var o=wu(n.element(),"."+e.itemClass()),i=bi($n(o,function(e){return n.getSystem().getByDom(e).toOption()}));Kn(i,r).each(function(r){ju(n,e,t,r)})},isHighlighted:Lu,getHighlighted:function(n,e){return Ou(n.element(),"."+e.highlightClass()).bind(function(e){return n.getSystem().getByDom(e).toOption()})},getFirst:Pu,getLast:_u,getPrevious:function(n,e){return Wu(n,e,0,-1)},getNext:function(n,e){return Wu(n,e,0,1)}}),Gu=[Ir("highlightClass"),Ir("itemClass"),Ri("onHighlight"),Ri("onDehighlight")],qu=To({fields:Gu,name:"highlighting",apis:$u}),Yu=function(){return{get:function(n){return oi(n.element())},set:function(n,e){n.getSystem().triggerFocus(e,n.element())}}},Xu=function(n,e,t,r,o,i){var u=function(n,e,r,o){var i,u;return(i=t(n,e,r,o),u=e.event(),Kn(i,function(n){return n.matches(u)}).map(function(n){return n.classification})).bind(function(t){return t(n,e,r,o)})},a={schema:function(){return n.concat([jr("focusManager",Yu()),Bi("handler",a),Bi("state",e)])},processKey:u,toEvents:function(n,e){var t=r(n,e),o=Wr(i.map(function(t){return Gr(be(),function(r,o){t(r,n,e,o),o.stop()})}).toArray().concat([Gr(wn(),function(t,r){u(t,r,n,e).each(function(){r.stop()})})]));return Z(t,o)},toApis:o};return a},Ku=function(n){var e=[Vr("onEscape"),Vr("onEnter"),jr("selector",'[data-alloy-tabstop="true"]'),jr("firstTabstop",0),jr("useTabstopAt",V(!0)),Vr("visibilitySelector")].concat([n]),t=function(n,e){var t=n.visibilitySelector().bind(function(n){return Cu(e,n)}).getOr(e);return 0<gu(t)},r=function(n,e,r,o,i){return i(e,r,function(n){return t(e=o,r=n)&&e.useTabstopAt()(r);var e,r}).fold(function(){return o.cyclic()?an.some(!0):an.none()},function(e){return o.focusManager().set(n,e),an.some(!0)})},o=function(n,e,t,o){var i,u,a=wu(n.element(),t.selector());return(i=n,u=t,u.focusManager().get(i).bind(function(n){return Cu(n,u.selector())})).bind(function(e){return Jn(a,z(ft,e)).bind(function(e){return r(n,a,e,t,o)})})},i=V([Fu(Mu([Iu,Ru([9])]),function(n,e,t){var r=t.cyclic()?ku:Eu;return o(n,0,t,r)}),Fu(Ru([9]),function(n,e,t){var r=t.cyclic()?Du:Au;return o(n,0,t,r)}),Fu(Ru([27]),function(n,e,t){return t.onEscape().bind(function(t){return t(n,e)})}),Fu(Mu([Bu,Ru([13])]),function(n,e,t){return t.onEnter().bind(function(t){return t(n,e)})})]),u=V({}),a=V({});return Xu(e,bo.init,i,u,a,an.some(function(n,e){var r,o,i,u;(r=n,o=e,i=wu(r.element(),o.selector()),u=qn(i,function(n){return t(o,n)}),an.from(u[o.firstTabstop()])).each(function(t){e.focusManager().set(n,t)})}))},Ju=Ku(Ur("cyclic",V(!1))),Qu=Ku(Ur("cyclic",V(!0))),Zu=function(n){return"input"===We.name(n)&&"radio"!==Ao.get(n,"type")||"textarea"===We.name(n)},na=function(n,e,t){return Zu(t)&&Ru([32])(e.event())?an.none():(Ne(n,t,xe()),an.some(!0))},ea=[jr("execute",na),jr("useSpace",!1),jr("useEnter",!0),jr("useControlEnter",!1),jr("useDown",!1)],ta=function(n,e,t){return t.execute()(n,e,n.element())},ra=V({}),oa=V({}),ia=Xu(ea,bo.init,function(n,e,t){var r=t.useSpace()&&!Zu(n.element())?[32]:[],o=t.useEnter()?[13]:[],i=t.useDown()?[40]:[],u=r.concat(o).concat(i);return[Fu(Ru(u),ta)].concat(t.useControlEnter()?[Fu(Mu([Nu,Ru([13])]),ta)]:[])},ra,oa,an.none()),ua=function(){var n=Yo(an.none());return yo({readState:V({}),setGridSize:function(e,t){n.set(an.some({numRows:V(e),numColumns:V(t)}))},getNumRows:function(){return n.get().map(function(n){return n.numRows()})},getNumColumns:function(){return n.get().map(function(n){return n.numColumns()})}})},aa=Object.freeze({flatgrid:ua,init:function(n){return n.state()(n)}}),ca=function(n){return"rtl"===du.get(n,"direction")?"rtl":"ltr"},sa=function(n,e){return function(t){return"rtl"===ca(t)?e:n}},fa=function(n){return function(e,t,r,o){var i=n(e.element());return ga(i,e,t,r,o)}},la=function(n,e){var t=sa(n,e);return fa(t)},da=function(n,e){var t=sa(e,n);return fa(t)},ma=function(n){return function(e,t,r,o){return ga(n,e,t,r,o)}},ga=function(n,e,t,r,o){return r.focusManager().get(e).bind(function(t){return n(e.element(),t,r,o)}).map(function(n){return r.focusManager().set(e,n),!0})},va=ma,pa=ma,ha=ma,ba=function(n){var e;return!((e=n.dom()).offsetWidth<=0&&e.offsetHeight<=0)},ya=nt(["index","candidates"],[]),wa=function(n,e,t){return xa(n,e,t,ba)},xa=function(n,e,t){var r,o=z(ft,e),i=wu(n,t),u=qn(i,ba);return Jn(r=u,o).map(function(n){return ya({index:n,candidates:r})})},Ta=function(n,e){return Jn(n,function(n){return ft(e,n)})},Sa=function(n,e,t,r){return r(Math.floor(e/t),e%t).bind(function(e){var r=e.row()*t+e.column();return 0<=r&&r<n.length?an.some(n[r]):an.none()})},Oa=function(n,e,t,r,o){return Sa(n,e,r,function(e,i){var u=e===t-1?n.length-e*r:r,a=Vu(i,o,0,u-1);return an.some({row:V(e),column:V(a)})})},Ca=function(n,e,t,r,o){return Sa(n,e,r,function(e,i){var u=Vu(e,o,0,t-1),a=u===t-1?n.length-u*r:r,c=Hu(i,0,a-1);return an.some({row:V(u),column:V(c)})})},ka=[Ir("selector"),jr("execute",na),Mi("onEscape"),jr("captureTab",!1),Vi()],Ea=function(n){return function(e,t,r,o){return wa(e,t,r.selector()).bind(function(e){return n(e.candidates(),e.index(),o.getNumRows().getOr(r.initSize().numRows()),o.getNumColumns().getOr(r.initSize().numColumns()))})}},Da=function(n,e,t){return t.captureTab()?an.some(!0):an.none()},Aa=Ea(function(n,e,t,r){return Oa(n,e,t,r,-1)}),Ra=Ea(function(n,e,t,r){return Oa(n,e,t,r,1)}),Ma=Ea(function(n,e,t,r){return Ca(n,e,t,r,-1)}),Ia=Ea(function(n,e,t,r){return Ca(n,e,t,r,1)}),Na=V([Fu(Ru([37]),la(Aa,Ra)),Fu(Ru([39]),da(Aa,Ra)),Fu(Ru([38]),va(Ma)),Fu(Ru([40]),pa(Ia)),Fu(Mu([Iu,Ru([9])]),Da),Fu(Mu([Bu,Ru([9])]),Da),Fu(Ru([27]),function(n,e,t){return t.onEscape()(n,e)}),Fu(Ru([32].concat([13])),function(n,e,t){return(r=n,o=t,o.focusManager().get(r).bind(function(n){return Cu(n,o.selector())})).bind(function(r){return t.execute()(n,e,r)});var r,o})]),Ba=V({}),Fa=Xu(ka,ua,Na,Ba,{},an.some(function(n,e){Ou(n.element(),e.selector()).each(function(t){e.focusManager().set(n,t)})})),Va=function(n,e,t,r){return wa(n,t,e).bind(function(n){var e=n.index(),t=n.candidates(),o=Vu(e,r,0,t.length-1);return an.from(t[o])})},Ha=[Ir("selector"),jr("getInitial",an.none),jr("execute",na),jr("executeOnMove",!1),jr("allowVertical",!0)],za=function(n,e,t){return(r=n,o=t,o.focusManager().get(r).bind(function(n){return Cu(n,o.selector())})).bind(function(r){return t.execute()(n,e,r)});var r,o},ja=function(n,e,t){return Va(n,t.selector(),e,-1)},La=function(n,e,t){return Va(n,t.selector(),e,1)},Ua=function(n){return function(e,t,r){return n(e,t,r).bind(function(){return r.executeOnMove()?za(e,t,r):an.some(!0)})}},Pa=V({}),_a=V({}),Wa=Xu(Ha,bo.init,function(n,e,t){var r=[37].concat(t.allowVertical()?[38]:[]),o=[39].concat(t.allowVertical()?[40]:[]);return[Fu(Ru(r),Ua(la(ja,La))),Fu(Ru(o),Ua(da(ja,La))),Fu(Ru([13]),za),Fu(Ru([32]),za)]},Pa,_a,an.some(function(n,e){e.getInitial()(n).or(Ou(n.element(),e.selector())).each(function(t){e.focusManager().set(n,t)})})),$a=nt(["rowIndex","columnIndex","cell"],[]),Ga=function(n,e,t){return an.from(n[e]).bind(function(n){return an.from(n[t]).map(function(n){return $a({rowIndex:e,columnIndex:t,cell:n})})})},qa=function(n,e,t,r){var o=n[e].length,i=Vu(t,r,0,o-1);return Ga(n,e,i)},Ya=function(n,e,t,r){var o=Vu(t,r,0,n.length-1),i=n[o].length,u=Hu(e,0,i-1);return Ga(n,o,u)},Xa=function(n,e,t,r){var o=n[e].length,i=Hu(t+r,0,o-1);return Ga(n,e,i)},Ka=function(n,e,t,r){var o=Hu(t+r,0,n.length-1),i=n[o].length,u=Hu(e,0,i-1);return Ga(n,o,u)},Ja=[Fr("selectors",[Ir("row"),Ir("cell")]),jr("cycles",!0),jr("previousSelector",an.none),jr("execute",na)],Qa=function(n,e){return function(t,r,o){var i=o.cycles()?n:e;return Cu(r,o.selectors().row()).bind(function(n){var e=wu(n,o.selectors().cell());return Ta(e,r).bind(function(e){var r=wu(t,o.selectors().row());return Ta(r,n).bind(function(n){var t,u=(t=o,$n(r,function(n){return wu(n,t.selectors().cell())}));return i(u,n,e).map(function(n){return n.cell()})})})})}},Za=Qa(function(n,e,t){return qa(n,e,t,-1)},function(n,e,t){return Xa(n,e,t,-1)}),nc=Qa(function(n,e,t){return qa(n,e,t,1)},function(n,e,t){return Xa(n,e,t,1)}),ec=Qa(function(n,e,t){return Ya(n,t,e,-1)},function(n,e,t){return Ka(n,t,e,-1)}),tc=Qa(function(n,e,t){return Ya(n,t,e,1)},function(n,e,t){return Ka(n,t,e,1)}),rc=V([Fu(Ru([37]),la(Za,nc)),Fu(Ru([39]),da(Za,nc)),Fu(Ru([38]),va(ec)),Fu(Ru([40]),pa(tc)),Fu(Ru([32].concat([13])),function(n,e,t){return oi(n.element()).bind(function(r){return t.execute()(n,e,r)})})]),oc=V({}),ic=V({}),uc=Xu(Ja,bo.init,rc,oc,ic,an.some(function(n,e){e.previousSelector()(n).orThunk(function(){var t=e.selectors();return Ou(n.element(),t.cell())}).each(function(t){e.focusManager().set(n,t)})})),ac=[Ir("selector"),jr("execute",na),jr("moveOnTab",!1)],cc=function(n,e,t){return t.focusManager().get(n).bind(function(r){return t.execute()(n,e,r)})},sc=function(n,e,t){return Va(n,t.selector(),e,-1)},fc=function(n,e,t){return Va(n,t.selector(),e,1)},lc=V([Fu(Ru([38]),ha(sc)),Fu(Ru([40]),ha(fc)),Fu(Mu([Iu,Ru([9])]),function(n,e,t){return t.moveOnTab()?ha(sc)(n,e,t):an.none()}),Fu(Mu([Bu,Ru([9])]),function(n,e,t){return t.moveOnTab()?ha(fc)(n,e,t):an.none()}),Fu(Ru([13]),cc),Fu(Ru([32]),cc)]),dc=V({}),mc=V({}),gc=Xu(ac,bo.init,lc,dc,mc,an.some(function(n,e){Ou(n.element(),e.selector()).each(function(t){e.focusManager().set(n,t)})})),vc=[Mi("onSpace"),Mi("onEnter"),Mi("onShiftEnter"),Mi("onLeft"),Mi("onRight"),Mi("onTab"),Mi("onShiftTab"),Mi("onUp"),Mi("onDown"),Mi("onEscape"),Vr("focusIn")],pc=Xu(vc,bo.init,function(n,e,t){return[Fu(Ru([32]),t.onSpace()),Fu(Mu([Bu,Ru([13])]),t.onEnter()),Fu(Mu([Iu,Ru([13])]),t.onShiftEnter()),Fu(Mu([Iu,Ru([9])]),t.onShiftTab()),Fu(Mu([Bu,Ru([9])]),t.onTab()),Fu(Ru([38]),t.onUp()),Fu(Ru([40]),t.onDown()),Fu(Ru([37]),t.onLeft()),Fu(Ru([39]),t.onRight()),Fu(Ru([32]),t.onSpace()),Fu(Ru([27]),t.onEscape())]},function(){return{}},function(){return{}},an.some(function(n,e){return e.focusIn().bind(function(t){return t(n,e)})})),hc=Ju.schema(),bc=Qu.schema(),yc=Wa.schema(),wc=Fa.schema(),xc=uc.schema(),Tc=ia.schema(),Sc=gc.schema(),Oc=pc.schema(),Cc=Object.freeze({acyclic:hc,cyclic:bc,flow:yc,flatgrid:wc,matrix:xc,execution:Tc,menu:Sc,special:Oc}),kc=co(Ar((C=kr("Creating behaviour: "+(O={branchKey:"mode",branches:Cc,name:"keying",active:{events:function(n,e){return n.handler().toEvents(n,e)}},apis:{focusIn:function(n){n.getSystem().triggerFocus(n.element(),n.element())},setGridSize:function(n,e,t,r,o){tr(t,"setGridSize")?t.setGridSize(r,o):console.error("Layout does not support setGridSize")}},state:aa}).name,So,O)).branchKey,C.branches),C.name,C.active,C.apis,C.extra,C.state),Ec=function(n,e){return t=n,r={},o=$n(e,function(e){return t=e.name(),r="Cannot configure "+e.name()+" for "+n,yr(t,t,zt(),mr(function(){return Nt.error("The field: "+t+" is forbidden. "+r)}));var t,r}).concat([Ur("dump",H)]),yr(t,t,Vt(r),vr(o));var t,r,o},Dc=function(n){return n.dump()},Ac="placeholder",Rc=Bt([{single:["required","valueThunk"]},{multiple:["required","valueThunks"]}]),Mc=function(n,e,t,r){return t.uiType===Ac?(i=t,u=r,(o=n).exists(function(n){return n!==i.owner})?Rc.single(!0,V(i)):Qt(u,i.name).fold(function(){throw new Error("Unknown placeholder component: "+i.name+"\nKnown: ["+cn(u)+"]\nNamespace: "+o.getOr("none")+"\nSpec: "+ur(i,null,2))},function(n){return n.replace()})):Rc.single(!1,V(t));var o,i,u},Ic=function(n,e,t,r){return Mc(n,0,t,r).fold(function(o,i){var u=i(e,t.config,t.validated),a=Qt(u,"components").getOr([]),c=ee(a,function(t){return Ic(n,e,t,r)});return[Z(u,{components:c})]},function(n,r){return r(e,t.config,t.validated)})},Nc=function(n,e,t,r){var o,i,u,a=fn(r,function(n,e){return r=n,o=!1,{name:V(t=e),required:function(){return r.fold(function(n){return n},function(n){return n})},used:function(){return o},replace:function(){if(!0===o)throw new Error("Trying to use the same placeholder more than once: "+t);return o=!0,r}};var t,r,o}),c=(o=n,i=e,u=a,ee(t,function(n){return Ic(o,i,n,u)}));return sn(a,function(t){if(!1===t.used()&&t.required())throw new Error("Placeholder: "+t.name()+" was not found in components list\nNamespace: "+n.getOr("none")+"\nComponents: "+ur(e.components(),null,2))}),c},Bc=Rc.single,Fc=Rc.multiple,Vc=V(Ac),Hc=0,zc=function(n){var e=(new Date).getTime();return n+"_"+Math.floor(1e9*Math.random())+ ++Hc+String(e)},jc=Bt([{required:["data"]},{external:["data"]},{optional:["data"]},{group:["data"]}]),Lc=jr("factory",{sketch:H}),Uc=jr("schema",[]),Pc=Ir("name"),_c=yr("pname","pname",jt(function(n){return"<alloy."+zc(n.name)+">"}),Rr()),Wc=jr("defaults",V({})),$c=jr("overrides",V({})),Gc=vr([Lc,Uc,Pc,_c,Wc,$c]),qc=vr([Lc,Uc,Pc,Wc,$c]),Yc=vr([Lc,Uc,Pc,_c,Wc,$c]),Xc=vr([Lc,Uc,Pc,Ir("unit"),_c,Wc,$c]),Kc=function(n){var e=function(n){return n.name()};return n.fold(e,e,e,e)},Jc=function(n,e){return function(t){var r=Er("Converting part type",e,t);return n(r)}},Qc=Jc(jc.required,Gc),Zc=(Jc(jc.external,qc),Jc(jc.optional,Yc)),ns=Jc(jc.group,Xc),es=V("entirety"),ts=function(n,e,t,r){var o=t;return Z(e.defaults()(n,t,r),t,{uid:n.partUids()[e.name()]},e.overrides()(n,t,r),{"debug.sketcher":Zt("part-"+e.name(),o)})},rs=function(n,e){var t={};return Gn(e,function(e){var r;(r=e,r.fold(an.some,an.none,an.some,an.some)).each(function(e){var r=os(n,e.pname());t[e.name()]=function(t){var o=kr("Part: "+e.name()+" in "+n,vr(e.schema()),t);return Z(r,{config:t,validated:o})}})}),t},os=function(n,e){return{uiType:Vc(),owner:n,name:e}},is=function(n,e,t){return r=e,o={},i={},Gn(t,function(n){n.fold(function(n){o[n.pname()]=Bc(!0,function(e,t,r){return n.factory().sketch(ts(e,n,t,r))})},function(n){var e=r.parts()[n.name()]();i[n.name()]=V(ts(r,n,e[es()]()))},function(n){o[n.pname()]=Bc(!1,function(e,t,r){return n.factory().sketch(ts(e,n,t,r))})},function(n){o[n.pname()]=Fc(!0,function(e){var t=e[n.name()]();return $n(t,function(t){return n.factory().sketch(Z(n.defaults()(e,t),t,n.overrides()(e,t)))})})})}),{internals:V(o),externals:V(i)};var r,o,i},us=function(n,e,t){return Nc(an.some(n),e,e.components(),t)},as=function(n,e,t){var r=e.partUids()[t];return n.getSystem().getByUid(r).toOption()},cs=function(n,e,t){return as(n,e,t).getOrDie("Could not find part: "+t)},ss=function(n,e){var t=$n(e,Kc);return nr($n(t,function(e){return{key:e,value:n+"-"+e}}))},fs=function(n){return yr("partUids","partUids",Lt(function(e){return ss(e.uid,n)}),Rr())},ls=zc("alloy-premade"),ds=zc("api"),ms=function(n){return Zt(ls,n)},gs=function(n){return e=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var o=e.config(ds);return n.apply(undefined,[o].concat([e].concat(t)))},r=(t=n.toString()).indexOf(")")+1,o=t.indexOf("("),i=t.substring(o+1,r-1).split(/,\s*/),e.toFunctionAnnotation=function(){return{name:"OVERRIDE",parameters:eo(i.slice(1))}},e;var e,t,r,o,i},vs=V(ds),ps=V("alloy-id-"),hs=V("data-alloy-id"),bs=ps(),ys=hs(),ws=function(n){var e=We.isElement(n)?Ao.get(n,ys):null;return an.from(e)},xs=function(n){return zc(n)},Ts=function(n,e,t,r,o){var i,u,a=(u=o,(0<(i=r).length?[Fr("parts",i)]:[]).concat([Ir("uid"),jr("dom",{}),jr("components",[]),Fi("originalSpec"),jr("debug.sketcher",{})]).concat(u));return Er(n+" [SpecSchema]",gr(a.concat(e)),t)},Ss=function(n,e,t,r,o){var i=Os(o),u=ee(t,function(n){return n.fold(an.none,an.some,an.none,an.none).map(function(n){return Fr(n.name(),n.schema().concat([Fi(es())]))}).toArray()}),a=fs(t),c=Ts(n,e,i,u,[a]),s=is(0,c,t),f=us(n,c,s.internals());return Z(r(c,f,i,s.externals()),{"debug.sketcher":Zt(n,o)})},Os=function(n){return Z({uid:xs("uid")},n)},Cs=gr([Ir("name"),Ir("factory"),Ir("configFields"),jr("apis",{}),jr("extraApis",{})]),ks=gr([Ir("name"),Ir("factory"),Ir("configFields"),Ir("partFields"),jr("apis",{}),jr("extraApis",{})]),Es=function(n){var e=kr("Sketcher for "+n.name,Cs,n),t=fn(e.apis,gs),r=fn(e.extraApis,function(n,e){return to(n,e)});return Z({name:V(e.name),partFields:V([]),configFields:V(e.configFields),sketch:function(n){return t=e.name,r=e.configFields,o=e.factory,u=Os(i=n),a=Ts(t,r,u,[],[]),Z(o(a,u),{"debug.sketcher":Zt(t,i)});var t,r,o,i,u,a}},t,r)},Ds=function(n){var e=kr("Sketcher for "+n.name,ks,n),t=rs(e.name,e.partFields),r=fn(e.apis,gs),o=fn(e.extraApis,function(n,e){return to(n,e)});return Z({name:V(e.name),partFields:V(e.partFields),configFields:V(e.configFields),sketch:function(n){return Ss(e.name,e.configFields,e.partFields,e.factory,n)},parts:V(t)},r,o)},As=Es({name:"Button",factory:function(n){var e,t,r,o=(e=n.action(),t=function(n,e){e.stop(),Ie(n)},r=pe.detect().deviceType.isTouch()?[Gr(Se(),t)]:[Gr(Sn(),t),Gr(pn(),function(n,e){e.cut()})],Wr(ne([e.map(function(n){return Gr(xe(),function(e,t){n(e),t.stop()})}).toArray(),r]))),i=Qt(n.dom(),"attributes").bind(Kt("type")),u=Qt(n.dom(),"tag");return{uid:n.uid(),dom:n.dom(),components:n.components(),events:o,behaviours:Z(wo([iu.config({}),kc.config({mode:"execution",useSpace:!0,useEnter:!0})]),Dc(n.buttonBehaviours())),domModification:{attributes:Z(i.fold(function(){return u.is("button")?{type:"button"}:{}},function(){return{}}),{
role:n.role().getOr("button")})},eventOrder:n.eventOrder()}},configFields:[jr("uid",undefined),Ir("dom"),jr("components",[]),Ec("buttonBehaviours",[iu,kc]),Vr("action"),Vr("role"),jr("eventOrder",{})]}),Rs=Object.freeze({events:function(){return Wr([$r(Cn(),V(!0))])},exhibit:function(){return io({styles:{"-webkit-user-select":"none","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none"},attributes:{unselectable:"on"}})}}),Ms=To({fields:[],name:"unselecting",active:Rs}),Is=function(n){var e,t,r,o=Ve.fromHtml(n),i=ht.children(o),u=(t=(e=o).dom().attributes!==undefined?e.dom().attributes:[],Xn(t,function(n,e){return"class"===e.name?n:Z(n,Zt(e.name,e.value))},{})),a=(r=o,Array.prototype.slice.call(r.dom().classList,0)),c=0===i.length?{}:{innerHtml:li(o)};return Z({tag:We.name(o),classes:a,attributes:u},c)},Ns=function(n){var e,t,r=(e=n,t={prefix:nu.prefix()},e.replace(/\$\{([^{}]*)\}/g,function(n,e){var r,o=t[e];return"string"==(r=typeof o)||"number"===r?o.toString():n}));return Is(r)},Bs=function(n){return{dom:Ns(n)}},Fs=function(n){return wo([Xi.config({toggleClass:nu.resolve("toolbar-button-selected"),toggleOnExecute:!1,aria:{mode:"pressed"}}),Ki(n,function(n,e){(e?Xi.on:Xi.off)(n)})])},Vs=function(n,e,t){return As.sketch({dom:Ns('<span class="${prefix}-toolbar-button ${prefix}-icon-'+n+' ${prefix}-icon"></span>'),action:e,buttonBehaviours:Z(wo([Ms.config({})]),t)})},Hs={forToolbar:Vs,forToolbarCommand:function(n,e){return Vs(e,function(){n.execCommand(e)},{})},forToolbarStateAction:function(n,e,t,r){var o=Fs(t);return Vs(e,r,o)},forToolbarStateCommand:function(n,e){var t=Fs(e);return Vs(e,function(){n.execCommand(e)},t)}},zs=function(n,e){return{left:V(n),top:V(e),translate:function(t,r){return zs(n+t,e+r)}}},js=zs,Ls=function(n,e,t){return Math.max(e,Math.min(t,n))},Us=function(n,e,t,r,o,i,u){var a=t-e;if(r<n.left)return e-1;if(r>n.right)return t+1;var c,s,f,l,d=Math.min(n.right,Math.max(r,n.left))-n.left,m=Ls(d/n.width*a+e,e-1,t+1),g=Math.round(m);return i&&e<=m&&m<=t?(c=m,s=e,f=t,l=o,u.fold(function(){var n=c-s,e=Math.round(n/l)*l;return Ls(s+e,s-1,f+1)},function(n){var e=(c-n)%l,t=Math.round(e/l),r=Math.floor((c-n)/l),o=Math.floor((f-n)/l),i=n+Math.min(o,r+t)*l;return Math.max(n,i)})):g},Ps="slider.change.value",_s=pe.detect().deviceType.isTouch(),Ws=function(n){return function(n){var e=n.event().raw();if(_s){var t=e;return t.touches!==undefined&&1===t.touches.length?an.some(t.touches[0]).map(function(n){return js(n.clientX,n.clientY)}):an.none()}var r=e;return r.clientX!==undefined?an.some(r).map(function(n){return js(n.clientX,n.clientY)}):an.none()}(n).map(function(n){return n.left()})},$s=function(n,e){Me(n,Ps,{value:e})},Gs=function(n,e,t,r){return Ws(r).map(function(r){var o,i,u,a;return o=n,u=r,a=Us(t,(i=e).min(),i.max(),u,i.stepSize(),i.snapToGrid(),i.snapStart()),$s(o,a),r})},qs=function(n,e){var t,r,o,i,u=(t=e.value().get(),r=e.min(),o=e.max(),i=e.stepSize(),t<r?t:o<t?o:t===r?r-1:Math.max(r,t-i));$s(n,u)},Ys=function(n,e){var t,r,o,i,u=(t=e.value().get(),r=e.min(),o=e.max(),i=e.stepSize(),o<t?t:t<r?r:t===o?o+1:Math.min(o,t+i));$s(n,u)},Xs=pe.detect().deviceType.isTouch(),Ks=function(n,e){return Zc({name:n+"-edge",overrides:function(n){var t=Wr([qr(mn(),e,[n])]),r=Wr([qr(pn(),e,[n]),qr(hn(),function(n,t){t.mouseIsDown().get()&&e(n,t)},[n])]);return{events:Xs?t:r}}})},Js=[Ks("left",function(n,e){$s(n,e.min()-1)}),Ks("right",function(n,e){$s(n,e.max()+1)}),Qc({name:"thumb",defaults:V({dom:{styles:{position:"absolute"}}}),overrides:function(n){return{events:Wr([Xr(mn(),n,"spectrum"),Xr(gn(),n,"spectrum"),Xr(vn(),n,"spectrum")])}}}),Qc({schema:[Ur("mouseIsDown",function(){return Yo(!1)})],name:"spectrum",overrides:function(n){var e=function(e,t){var r=e.element().dom().getBoundingClientRect();Gs(e,n,r,t)},t=Wr([Gr(mn(),e),Gr(gn(),e)]),r=Wr([Gr(pn(),e),Gr(hn(),function(t,r){n.mouseIsDown().get()&&e(t,r)})]);return{behaviours:wo(Xs?[]:[kc.config({mode:"special",onLeft:function(e){return qs(e,n),an.some(!0)},onRight:function(e){return Ys(e,n),an.some(!0)}}),iu.config({})]),events:Xs?t:r}}})],Qs=function(n,e,t){e.store().manager().onLoad(n,e,t)},Zs=function(n,e,t){e.store().manager().onUnload(n,e,t)},nf=Object.freeze({onLoad:Qs,onUnload:Zs,setValue:function(n,e,t,r){e.store().manager().setValue(n,e,t,r)},getValue:function(n,e,t){return e.store().manager().getValue(n,e,t)}}),ef=Object.freeze({events:function(n,e){var t=n.resetOnDom()?[Jr(function(t){Qs(t,n,e)}),Qr(function(t){Zs(t,n,e)})]:[ao(n,e,Qs)];return Wr(t)}}),tf=function(){var n=Yo(null);return yo({set:n.set,get:n.get,isNotSet:function(){return null===n.get()},clear:function(){n.set(null)},readState:function(){return{mode:"memory",value:n.get()}}})},rf=function(){var n=Yo({});return yo({readState:function(){return{mode:"dataset",dataset:n.get()}},set:n.set,get:n.get})},of=Object.freeze({memory:tf,dataset:rf,manual:function(){return yo({readState:function(){}})},init:function(n){return n.store().manager().state(n)}}),uf=function(n,e,t,r){e.store().getDataKey(),t.set({}),e.store().setData()(n,r),e.onSetValue()(n,r)},af=[Vr("initialValue"),Ir("getFallbackEntry"),Ir("getDataKey"),Ir("setData"),Bi("manager",{setValue:uf,getValue:function(n,e,t){var r=e.store().getDataKey()(n),o=t.get();return Qt(o,r).fold(function(){return e.store().getFallbackEntry()(r)},function(n){return n})},onLoad:function(n,e,t){e.store().initialValue().each(function(r){uf(n,e,t,r)})},onUnload:function(n,e,t){t.set({})},state:rf})],cf=[Ir("getValue"),jr("setValue",B),Vr("initialValue"),Bi("manager",{setValue:function(n,e,t,r){e.store().setValue()(n,r),e.onSetValue()(n,r)},getValue:function(n,e){return e.store().getValue()(n)},onLoad:function(n,e){e.store().initialValue().each(function(t){e.store().setValue()(n,t)})},onUnload:B,state:bo.init})],sf=[Lr("store",{mode:"memory"},Ar("mode",{memory:[Vr("initialValue"),Bi("manager",{setValue:function(n,e,t,r){t.set(r),e.onSetValue()(n,r)},getValue:function(n,e,t){return t.get()},onLoad:function(n,e,t){e.store().initialValue().each(function(n){t.isNotSet()&&t.set(n)})},onUnload:function(n,e,t){t.clear()},state:tf})],manual:cf,dataset:af})),Ri("onSetValue"),jr("resetOnDom",!1)],ff=To({fields:sf,name:"representing",active:ef,apis:nf,extra:{setValueFrom:function(n,e){var t=ff.getValue(e);ff.setValue(n,t)}},state:of}),lf=pe.detect().deviceType.isTouch(),df=[Ir("min"),Ir("max"),jr("stepSize",1),jr("onChange",B),jr("onInit",B),jr("onDragStart",B),jr("onDragEnd",B),jr("snapToGrid",!1),Vr("snapStart"),Ir("getInitialValue"),Ec("sliderBehaviours",[kc,ff]),Ur("value",function(n){return Yo(n.min)})].concat(lf?[]:[Ur("mouseIsDown",function(){return Yo(!1)})]),mf=t("width",function(n){return n.dom().offsetWidth}),gf=function(n,e){mf.set(n,e)},vf=function(n){return mf.get(n)},pf=pe.detect().deviceType.isTouch(),hf=Ds({name:"Slider",configFields:df,partFields:Js,factory:function(n,e){var t=n.max()-n.min(),r=function(n){var e=n.element().dom().getBoundingClientRect();return(e.left+e.right)/2},o=function(e){return cs(e,n,"thumb")},i=function(e){var o,i,u,a,c=cs(e,n,"spectrum").element().dom().getBoundingClientRect(),s=e.element().dom().getBoundingClientRect(),f=(o=e,i=c,(a=(u=n).value().get())<u.min()?as(o,u,"left-edge").fold(function(){return 0},function(n){return r(n)-i.left}):a>u.max()?as(o,u,"right-edge").fold(function(){return i.width},function(n){return r(n)-i.left}):(u.value().get()-u.min())/t*i.width);return c.left-s.left+f},u=function(n){var e=i(n),t=o(n),r=vf(t.element())/2;du.set(t.element(),"left",e-r+"px")},a=function(e,t){var r=n.value().get(),i=o(e);return r!==t||du.getRaw(i.element(),"left").isNone()?(n.value().set(t),u(e),n.onChange()(e,i,t),an.some(!0)):an.none()},c=pf?[Gr(mn(),function(e){n.onDragStart()(e,o(e))}),Gr(vn(),function(e){n.onDragEnd()(e,o(e))})]:[Gr(pn(),function(e,t){t.stop(),n.onDragStart()(e,o(e)),n.mouseIsDown().set(!0)}),Gr(bn(),function(e){n.onDragEnd()(e,o(e)),n.mouseIsDown().set(!1)})];return{uid:n.uid(),dom:n.dom(),components:e,behaviours:Z(wo(ne([pf?[]:[kc.config({mode:"special",focusIn:function(e){return as(e,n,"spectrum").map(kc.focusIn).map(V(!0))}})],[ff.config({store:{mode:"manual",getValue:function(){return n.value().get()}}})]])),Dc(n.sliderBehaviours())),events:Wr([Gr(Ps,function(n,e){a(n,e.event().value())}),Jr(function(e){n.value().set(n.getInitialValue()());var t=o(e);u(e),n.onInit()(e,t,n.value().get())})].concat(c)),apis:{resetToMin:function(e){a(e,n.min())},resetToMax:function(e){a(e,n.max())},refresh:u},domModification:{styles:{position:"relative"}}}},apis:{resetToMin:function(n,e){n.resetToMin(e)},resetToMax:function(n,e){n.resetToMax(e)},refresh:function(n,e){n.refresh(e)}}}),bf=function(n,e,t){return Hs.forToolbar(e,function(){var r=t();n.setContextToolbar([{label:e+" group",items:r}])},{})},yf=function(n){return[(e=n,t=function(n){return n<0?"black":360<n?"white":"hsl("+n+", 100%, 50%)"},hf.sketch({dom:Ns('<div class="${prefix}-slider ${prefix}-hue-slider-container"></div>'),components:[hf.parts()["left-edge"](Bs('<div class="${prefix}-hue-slider-black"></div>')),hf.parts().spectrum({dom:Ns('<div class="${prefix}-slider-gradient-container"></div>'),components:[Bs('<div class="${prefix}-slider-gradient"></div>')],behaviours:wo([Xi.config({toggleClass:nu.resolve("thumb-active")})])}),hf.parts()["right-edge"](Bs('<div class="${prefix}-hue-slider-white"></div>')),hf.parts().thumb({dom:Ns('<div class="${prefix}-slider-thumb"></div>'),behaviours:wo([Xi.config({toggleClass:nu.resolve("thumb-active")})])})],onChange:function(n,r,o){var i=t(o);du.set(r.element(),"background-color",i),e.onChange(n,r,i)},onDragStart:function(n,e){Xi.on(e)},onDragEnd:function(n,e){Xi.off(e)},onInit:function(n,e,r){var o=t(r);du.set(e.element(),"background-color",o)},stepSize:10,min:0,max:360,getInitialValue:e.getInitialValue,sliderBehaviours:wo([Ji(hf.refresh)])}))];var e,t},wf=function(n,e){var t={onChange:function(n,t,r){e.undoManager.transact(function(){e.formatter.apply("forecolor",{value:r}),e.nodeChanged()})},getInitialValue:function(){return-1}};return bf(n,"color",function(){return yf(t)})},xf=gr([Ir("getInitialValue"),Ir("onChange"),Ir("category"),Ir("sizes")]),Tf=function(n){var e=kr("SizeSlider",xf,n);return hf.sketch({dom:{tag:"div",classes:[nu.resolve("slider-"+e.category+"-size-container"),nu.resolve("slider"),nu.resolve("slider-size-container")]},onChange:function(n,t,r){var o;0<=(o=r)&&o<e.sizes.length&&e.onChange(r)},onDragStart:function(n,e){Xi.on(e)},onDragEnd:function(n,e){Xi.off(e)},min:0,max:e.sizes.length-1,stepSize:1,getInitialValue:e.getInitialValue,snapToGrid:!0,sliderBehaviours:wo([Ji(hf.refresh)]),components:[hf.parts().spectrum({dom:Ns('<div class="${prefix}-slider-size-container"></div>'),components:[Bs('<div class="${prefix}-slider-size-line"></div>')]}),hf.parts().thumb({dom:Ns('<div class="${prefix}-slider-thumb"></div>'),behaviours:wo([Xi.config({toggleClass:nu.resolve("thumb-active")})])})]})},Sf=["9px","10px","11px","12px","14px","16px","18px","20px","24px","32px","36px"],Of=function(n){var e,t,r=n.selection.getStart(),o=Ve.fromDom(r),i=Ve.fromDom(n.getBody()),u=(e=function(n){return ft(i,n)},t=o,(We.isElement(t)?an.some(t):ht.parent(t)).map(function(n){return Qo.closest(n,function(n){return du.getRaw(n,"font-size").isSome()},e).bind(function(n){return du.getRaw(n,"font-size")}).getOrThunk(function(){return du.get(n,"font-size")})}).getOr(""));return Kn(Sf,function(n){return u===n}).getOr("medium")},Cf={candidates:V(Sf),get:function(n){var e,t=Of(n);return(e=t,Jn(Sf,function(n){return n===e})).getOr(2)},apply:function(n,e){var t;(t=e,an.from(Sf[t])).each(function(e){var t,r;r=e,Of(t=n)!==r&&t.execCommand("fontSize",!1,r)})}},kf=Cf.candidates(),Ef=function(n){return[Bs('<span class="${prefix}-toolbar-button ${prefix}-icon-small-font ${prefix}-icon"></span>'),(e=n,Tf({onChange:e.onChange,sizes:kf,category:"font",getInitialValue:e.getInitialValue})),Bs('<span class="${prefix}-toolbar-button ${prefix}-icon-large-font ${prefix}-icon"></span>')];var e},Df=function(n){var e=n.uid!==undefined&&tr(n,"uid")?n.uid:xs("memento");return{get:function(n){return n.getSystem().getByUid(e).getOrDie()},getOpt:function(n){return n.getSystem().getByUid(e).fold(an.none,an.some)},asSpec:function(){return Z(n,{uid:e})}}},Af={create:r,clone:function(n){var e;return o(e=r(n.width,n.height)).drawImage(n,0,0),e},resize:i,get2dContext:o,get3dContext:function(n){var e=null;try{e=n.getContext("webgl")||n.getContext("experimental-webgl")}catch(b){}return e||(e=null),e}},Rf={getWidth:function(n){return n.naturalWidth||n.width},getHeight:function(n){return n.naturalHeight||n.height}},Mf=window.Promise?window.Promise:function(){function n(n,e){return function(){n.apply(e,arguments)}}function e(n){var e=this;null!==this._state?c(function(){var t=e._state?n.onFulfilled:n.onRejected;if(null!==t){var r;try{r=t(e._value)}catch(s){return void n.reject(s)}n.resolve(r)}else(e._state?n.resolve:n.reject)(e._value)}):this._deferreds.push(n)}function t(e){try{if(e===this)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var i=e.then;if("function"==typeof i)return void u(n(i,e),n(t,this),n(r,this))}this._state=!0,this._value=e,o.call(this)}catch(s){r.call(this,s)}}function r(n){this._state=!1,this._value=n,o.call(this)}function o(){for(var n=0,t=this._deferreds.length;n<t;n++)e.call(this,this._deferreds[n]);this._deferreds=null}function i(n,e,t,r){this.onFulfilled="function"==typeof n?n:null,this.onRejected="function"==typeof e?e:null,this.resolve=t,this.reject=r}function u(n,e,r){var o=!1;try{n(function(n){o||(o=!0,e(n))},function(n){o||(o=!0,r(n))})}catch(t){if(o)return;o=!0,r(t)}}var a=function(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],u(e,n(t,this),n(r,this))},c=a.immediateFn||"function"==typeof window.setImmediate&&window.setImmediate||function(n){setTimeout(n,1)},s=Array.isArray||function(n){return"[object Array]"===Object.prototype.toString.call(n)};return a.prototype["catch"]=function(n){return this.then(null,n)},a.prototype.then=function(n,t){var r=this;return new a(function(o,u){e.call(r,new i(n,t,o,u))})},a.all=function(){var e=Array.prototype.slice.call(1===arguments.length&&s(arguments[0])?arguments[0]:arguments);return new a(function(t,r){function o(u,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var c=a.then;if("function"==typeof c)return void c.call(a,function(n){o(u,n)},r)}e[u]=a,0==--i&&t(e)}catch(n){r(n)}}if(0===e.length)return t([]);for(var i=e.length,u=0;u<e.length;u++)o(u,e[u])})},a.resolve=function(n){return n&&"object"==typeof n&&n.constructor===a?n:new a(function(e){e(n)})},a.reject=function(n){return new a(function(e,t){t(n)})},a.race=function(n){return new a(function(e,t){for(var r=0,o=n.length;r<o;r++)n[r].then(e,t)})},a}(),If={atob:function(n){return ot.getOrDie("atob")(n)},requestAnimationFrame:function(n){ot.getOrDie("requestAnimationFrame")(n)}},Nf={blobToImage:a,imageToBlob:function(n){var e=n.src;return 0===e.indexOf("data:")?f(e):c(e)},blobToArrayBuffer:function(n){return new Mf(function(e){var t=u();t.onloadend=function(){e(t.result)},t.readAsArrayBuffer(n)})},blobToDataUri:l,blobToBase64:function(n){return l(n).then(function(n){return n.split(",")[1]})},dataUriToBlobSync:s,canvasToBlob:function(n,e,t){return e=e||"image/png",HTMLCanvasElement.prototype.toBlob?new Mf(function(r){n.toBlob(function(n){r(n)},e,t)}):f(n.toDataURL(e,t))},canvasToDataURL:function(n,e,t){return e=e||"image/png",n.then(function(n){return n.toDataURL(e,t)})},blobToCanvas:function(n){return a(n).then(function(n){var e,t;return e=n,URL.revokeObjectURL(e.src),t=Af.create(Rf.getWidth(n),Rf.getHeight(n)),Af.get2dContext(t).drawImage(n,0,0),t})},uriToBlob:function(n){return 0===n.indexOf("blob:")?c(n):0===n.indexOf("data:")?f(n):null}},Bf=function(n){return Nf.blobToBase64(n)},Ff=function(n){var e=Df({dom:{tag:"input",attributes:{accept:"image/*",type:"file",title:""},styles:{visibility:"hidden",position:"absolute"}},events:Wr([Kr(Sn()),Gr(Tn(),function(e,t){var r,o,i;(r=t,o=r.event(),i=o.raw().target.files||o.raw().dataTransfer.files,an.from(i[0])).each(function(e){var t,r;t=n,Bf(r=e).then(function(n){t.undoManager.transact(function(){var e=t.editorUpload.blobCache,o=e.create(zc("mceu"),r,n);e.add(o);var i=t.dom.createHTML("img",{src:o.blobUri()});t.insertContent(i)})})})})])});return As.sketch({dom:Ns('<span class="${prefix}-toolbar-button ${prefix}-icon-image ${prefix}-icon"></span>'),components:[e.asSpec()],action:function(n){e.get(n).element().dom().click()}})},Vf=function(n){return n.dom().textContent},Hf=function(n,e){n.dom().textContent=e},zf=function(n){return 0<n.length},jf=function(n){return n===undefined||null===n?"":n},Lf=function(n,e,t){return t.text.filter(zf).fold(function(){return Ao.get(t=n,"href")===Vf(t)?an.some(e):an.none();var t},an.some)},Uf=function(n){var e=Ve.fromDom(n.selection.getStart());return Cu(e,"a")},Pf={getInfo:function(n){return Uf(n).fold(function(){return{url:"",text:n.selection.getContent({format:"text"}),title:"",target:"",link:an.none()}},function(n){return t=Vf(e=n),r=Ao.get(e,"href"),o=Ao.get(e,"title"),i=Ao.get(e,"target"),{url:jf(r),text:t!==r?jf(t):"",title:jf(o),target:jf(i),link:an.some(e)};var e,t,r,o,i})},applyInfo:function(n,e){e.url.filter(zf).fold(function(){var t;t=n,e.link.bind(H).each(function(){t.execCommand("unlink")})},function(t){var r,o,i=(r=e,(o={}).href=t,r.title.filter(zf).each(function(n){o.title=n}),r.target.filter(zf).each(function(n){o.target=n}),o);e.link.bind(H).fold(function(){var r=e.text.filter(zf).getOr(t);n.insertContent(n.dom.createHTML("a",i,n.dom.encode(r)))},function(n){var r=Lf(n,t,e);Ao.setAll(n,i),r.each(function(e){Hf(n,e)})})})},query:Uf},_f=pe.detect(),Wf=function(n,e){var t=e.selection.getRng();n(),e.selection.setRng(t)},$f=function(n,e){(_f.os.isAndroid()?Wf:U)(e,n)},Gf=function(n,e){var t,r;return{key:n,value:{config:{},me:(t=n,r=Wr(e),To({fields:[Ir("enabled")],name:t,active:{events:V(r)}})),configAsRaw:V({}),initialConfig:{},state:bo}}},qf=Object.freeze({getCurrent:function(n,e){return e.find()(n)}}),Yf=[Ir("find")],Xf=To({fields:Yf,name:"composing",apis:qf}),Kf=Es({name:"Container",factory:function(n){return{uid:n.uid(),dom:Z({tag:"div",attributes:{role:"presentation"}},n.dom()),components:n.components(),behaviours:Dc(n.containerBehaviours()),events:n.events(),domModification:n.domModification(),eventOrder:n.eventOrder()}},configFields:[jr("components",[]),Ec("containerBehaviours",[]),jr("events",{}),jr("domModification",{}),jr("eventOrder",{})]}),Jf=Es({name:"DataField",factory:function(n){return{uid:n.uid(),dom:n.dom(),behaviours:Z(wo([ff.config({store:{mode:"memory",initialValue:n.getInitialValue()()}}),Xf.config({find:an.some})]),Dc(n.dataBehaviours())),events:Wr([Jr(function(e){ff.setValue(e,n.getInitialValue()())})])}},configFields:[Ir("uid"),Ir("dom"),Ir("getInitialValue"),Ec("dataBehaviours",[ff,Xf])]}),Qf=function(n,e){if(e===undefined)throw new Error("Value.set was undefined");n.dom().value=e},Zf=function(n){return n.dom().value},nl=V([Vr("data"),jr("inputAttributes",{}),jr("inputStyles",{}),jr("type","input"),jr("tag","input"),jr("inputClasses",[]),Ri("onSetValue"),jr("styles",{}),Vr("placeholder"),jr("eventOrder",{}),Ec("inputBehaviours",[ff,iu]),jr("selectOnFocus",!0)]),el=function(n){return Z(wo([ff.config({store:{mode:"manual",initialValue:n.data().getOr(undefined),getValue:function(n){return Zf(n.element())},setValue:function(n,e){Zf(n.element())!==e&&Qf(n.element(),e)}},onSetValue:n.onSetValue()})]),(e=n,wo([iu.config({onFocus:!1===e.selectOnFocus()?B:function(n){var e=n.element(),t=Zf(e);e.dom().setSelectionRange(0,t.length)}})])),Dc(n.inputBehaviours()));var e},tl=Es({name:"Input",configFields:nl(),factory:function(n){return{uid:n.uid(),dom:(e=n,{tag:e.tag(),attributes:Z(nr([{key:"type",value:e.type()}].concat(e.placeholder().map(function(n){return{key:"placeholder",value:n}}).toArray())),e.inputAttributes()),styles:e.inputStyles(),classes:e.inputClasses()}),components:[],behaviours:el(n),eventOrder:n.eventOrder()};var e}}),rl=Object.freeze({exhibit:function(n,e){return io({attributes:nr([{key:e.tabAttr(),value:"true"}])})}}),ol=[jr("tabAttr","data-alloy-tabstop")],il=To({fields:ol,name:"tabstopping",active:rl}),ul=function(n,e){var t=Df(tl.sketch({placeholder:e,onSetValue:function(n){Re(n,xn())},inputBehaviours:wo([Xf.config({find:an.some}),il.config({}),kc.config({mode:"execution"})]),selectOnFocus:!1})),r=Df(As.sketch({dom:Ns('<button class="${prefix}-input-container-x ${prefix}-icon-cancel-circle ${prefix}-icon"></button>'),action:function(n){var e=t.get(n);ff.setValue(e,"")}}));return{name:n,spec:Kf.sketch({dom:Ns('<div class="${prefix}-input-container"></div>'),components:[t.asSpec(),r.asSpec()],containerBehaviours:wo([Xi.config({toggleClass:nu.resolve("input-container-empty")}),Xf.config({find:function(n){return an.some(t.get(n))}}),Gf("input-clearing",[Gr(xn(),function(n){var e=t.get(n);(0<ff.getValue(e).length?Xi.off:Xi.on)(n)})])])})}},al=["input","button","textarea"],cl=function(n,e,t){e.disabled()&&gl(n,e,t)},sl=function(n){return _n(al,We.name(n.element()))},fl=function(n){Ao.set(n.element(),"disabled","disabled")},ll=function(n){Ao.remove(n.element(),"disabled")},dl=function(n){Ao.set(n.element(),"aria-disabled","true")},ml=function(n){Ao.set(n.element(),"aria-disabled","false")},gl=function(n,e){e.disableClass().each(function(e){_o.add(n.element(),e)}),(sl(n)?fl:dl)(n)},vl=function(n){return sl(n)?Ao.has(n.element(),"disabled"):"true"===Ao.get(n.element(),"aria-disabled")},pl=Object.freeze({enable:function(n,e){e.disableClass().each(function(e){_o.remove(n.element(),e)}),(sl(n)?ll:ml)(n)},disable:gl,isDisabled:vl,onLoad:cl}),hl=Object.freeze({exhibit:function(n,e){return io({classes:e.disabled()?e.disableClass().map(ie).getOr([]):[]})},events:function(n,e){return Wr([$r(xe(),function(n){return vl(n)}),ao(n,e,cl)])}}),bl=[jr("disabled",!1),Vr("disableClass")],yl=To({fields:bl,name:"disabling",active:hl,apis:pl}),wl=[Ec("formBehaviours",[ff])],xl=function(n){return"<alloy.field."+n+">"},Tl=function(n,e,t){return Z({"debug.sketcher":{Form:t},uid:n.uid(),dom:n.dom(),components:e,behaviours:Z(wo([ff.config({store:{mode:"manual",getValue:function(e){var t,r,o=(t=n,r=e.getSystem(),fn(t.partUids(),function(n){return V(r.getByUid(n))}));return fn(o,function(n){return n().bind(Xf.getCurrent).map(ff.getValue)})},setValue:function(e,t){sn(t,function(t,r){as(e,n,r).each(function(n){Xf.getCurrent(n).each(function(n){ff.setValue(n,t)})})})}}})]),Dc(n.formBehaviours())),apis:{getField:function(e,t){return as(e,n,t).bind(Xf.getCurrent)}}})},Sl=(gs(function(n,e,t){return n.getField(e,t)}),function(n){var e,t=(e=[],{field:function(n,t){return e.push(n),r="form",o=xl(n),i=t,{uiType:Vc(),owner:r,name:o,config:i,validated:{}};var r,o,i},record:function(){return e}}),r=n(t),o=t.record(),i=$n(o,function(n){return Qc({name:n,pname:xl(n)})});return Ss("form",wl,i,Tl,r)}),Ol=function(){var n=Yo(an.none()),e=function(){n.get().each(function(n){n.destroy()})};return{clear:function(){e(),n.set(an.none())},isSet:function(){return n.get().isSome()},set:function(t){e(),n.set(an.some(t))},run:function(e){n.get().each(e)}}},Cl=function(){var n=Yo(an.none());return{clear:function(){n.set(an.none())},set:function(e){n.set(an.some(e))},isSet:function(){return n.get().isSome()},on:function(e){n.get().each(e)}}},kl=function(n){return{xValue:n,points:[]}},El=function(n,e){if(e===n.xValue)return n;var t=0<e-n.xValue?1:-1,r={direction:t,xValue:e};return{xValue:e,points:(0===n.points.length?[]:n.points[n.points.length-1].direction===t?n.points.slice(0,n.points.length-1):n.points).concat([r])}},Dl=function(n){if(0===n.points.length)return 0;var e=n.points[0].direction,t=n.points[n.points.length-1].direction;return-1===e&&-1===t?-1:1===e&&1===t?1:0},Al=function(n){var e="navigateEvent",t=vr([Ir("fields"),jr("maxFieldIndex",n.fields.length-1),Ir("onExecute"),Ir("getInitialValue"),Ur("state",function(){return{dialogSwipeState:Cl(),currentScreen:Yo(0)}})]),r=kr("SerialisedDialog",t,n),o=function(n,t,r){return As.sketch({dom:Ns('<span class="${prefix}-icon-'+t+' ${prefix}-icon"></span>'),action:function(t){Me(t,e,{direction:n})},buttonBehaviours:wo([yl.config({disableClass:nu.resolve("toolbar-navigation-disabled"),disabled:!r})])})},i=function(n,e){var t=wu(n.element(),"."+nu.resolve("serialised-dialog-screen"));Ou(n.element(),"."+nu.resolve("serialised-dialog-chain")).each(function(n){0<=r.state.currentScreen.get()+e&&r.state.currentScreen.get()+e<t.length&&(du.getRaw(n,"left").each(function(r){var o=parseInt(r,10),i=vf(t[0]);du.set(n,"left",o-e*i+"px")}),r.state.currentScreen.set(r.state.currentScreen.get()+e))})},u=function(n){var e=wu(n.element(),"input");an.from(e[r.state.currentScreen.get()]).each(function(e){n.getSystem().getByDom(e).each(function(e){var t,r;t=n,r=e.element(),t.getSystem().triggerFocus(r,t.element())})});var t=c.get(n);qu.highlightAt(t,r.state.currentScreen.get())},a=Df(Sl(function(n){return{dom:Ns('<div class="${prefix}-serialised-dialog"></div>'),components:[Kf.sketch({dom:Ns('<div class="${prefix}-serialised-dialog-chain" style="left: 0px; position: absolute;"></div>'),components:$n(r.fields,function(e,t){return t<=r.maxFieldIndex?Kf.sketch({dom:Ns('<div class="${prefix}-serialised-dialog-screen"></div>'),components:ne([[o(-1,"previous",0<t)],[n.field(e.name,e.spec)],[o(1,"next",t<r.maxFieldIndex)]])}):n.field(e.name,e.spec)})})],formBehaviours:wo([Ji(function(n,e){var t;t=e,Ou(n.element(),"."+nu.resolve("serialised-dialog-chain")).each(function(n){du.set(n,"left",-r.state.currentScreen.get()*t.width+"px")})}),kc.config({mode:"special",focusIn:function(n){u(n)},onTab:function(n){return i(n,1),an.some(!0)},onShiftTab:function(n){return i(n,-1),an.some(!0)}}),Gf("form-events",[Jr(function(n){r.state.currentScreen.set(0),r.state.dialogSwipeState.clear();var e=c.get(n);qu.highlightFirst(e),r.getInitialValue(n).each(function(e){ff.setValue(n,e)})}),no(r.onExecute),Gr(On(),function(n,e){"left"===e.event().raw().propertyName&&u(n)}),Gr(e,function(n,e){var t=e.event().direction();i(n,t)})])])}})),c=Df({dom:Ns('<div class="${prefix}-dot-container"></div>'),behaviours:wo([qu.config({highlightClass:nu.resolve("dot-active"),itemClass:nu.resolve("dot-item")})]),components:ee(r.fields,function(n,e){return e<=r.maxFieldIndex?[Bs('<div class="${prefix}-dot-item ${prefix}-icon-full-dot ${prefix}-icon"></div>')]:[]})});return{dom:Ns('<div class="${prefix}-serializer-wrapper"></div>'),components:[a.asSpec(),c.asSpec()],behaviours:wo([kc.config({mode:"special",focusIn:function(n){var e=a.get(n);kc.focusIn(e)}}),Gf("serializer-wrapper-events",[Gr(mn(),function(n,e){var t=e.event();r.state.dialogSwipeState.set(kl(t.touches[0].clientX))}),Gr(gn(),function(n,e){var t=e.event();r.state.dialogSwipeState.on(function(n){e.event().prevent(),r.state.dialogSwipeState.set(El(n,t.raw().touches[0].clientX))})}),Gr(vn(),function(n){r.state.dialogSwipeState.on(function(e){var t=a.get(n),r=-1*Dl(e);i(t,r)})})])])}},Rl=kn(function(n,e){return[{label:"the link group",items:[Al({fields:[ul("url","Type or paste URL"),ul("text","Link text"),ul("title","Link title"),ul("target","Link target"),(t="link",{name:t,spec:Jf.sketch({dom:{tag:"span",styles:{display:"none"}},getInitialValue:function(){return an.none()}})})],maxFieldIndex:["url","text","title","target"].length-1,getInitialValue:function(){return an.some(Pf.getInfo(e))},onExecute:function(t){var r=ff.getValue(t);Pf.applyInfo(e,r),n.restoreToolbar(),e.focus()}})]}];var t}),Ml=[{title:"Headings",items:[{title:"Heading 1",format:"h1"},{title:"Heading 2",format:"h2"},{title:"Heading 3",format:"h3"},{title:"Heading 4",format:"h4"},{title:"Heading 5",format:"h5"},{title:"Heading 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},{title:"Underline",icon:"underline",format:"underline"},{title:"Strikethrough",icon:"strikethrough",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"},{title:"Code",icon:"code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Alignment",items:[{title:"Left",icon:"alignleft",format:"alignleft"},{title:"Center",icon:"aligncenter",format:"aligncenter"},{title:"Right",icon:"alignright",format:"alignright"},{title:"Justify",icon:"alignjustify",format:"alignjustify"}]}],Il=Wr([(k=be(),E=function(n,e){var t,r,o=e.event().originator(),i=e.event().target();return r=i,!(ft(t=o,n.element())&&!ft(t,r)&&(console.warn(be()+" did not get interpreted by the desired target. \nOriginator: "+pi(o)+"\nTarget: "+pi(i)+"\nCheck the "+be()+" event handlers"),1))},{key:k,value:Pr({can:E})})]),Nl=Object.freeze({events:Il}),Bl=H,Fl=ho(["debugInfo","triggerFocus","triggerEvent","triggerEscape","addToWorld","removeFromWorld","addToGui","removeFromGui","build","getByUid","getByDom","broadcast","broadcastOn","isConnected"]),Vl=function(n){var e=function(e){return function(){throw new Error("The component must be in a context to send: "+e+"\n"+pi(n().element())+" is not in context.")}};return Fl({debugInfo:V("fake"),triggerEvent:e("triggerEvent"),triggerFocus:e("triggerFocus"),triggerEscape:e("triggerEscape"),build:e("build"),addToWorld:e("addToWorld"),removeFromWorld:e("removeFromWorld"),addToGui:e("addToGui"),removeFromGui:e("removeFromGui"),getByUid:e("getByUid"),getByDom:e("getByDom"),broadcast:e("broadcast"),broadcastOn:e("broadcastOn"),isConnected:V(!1)})},Hl=function(n,e){var t={};return sn(n,function(n,r){sn(n,function(n,o){var i=Jt(o,[])(t);t[o]=i.concat([e(r,n)])})}),t},zl=function(n,e){return 1<n.length?Nt.error('Multiple behaviours have tried to change DOM "'+e+'". The guilty behaviours are: '+ur($n(n,function(n){return n.name()}))+". At this stage, this is not supported. Future releases might provide strategies for resolving this."):0===n.length?Nt.value({}):Nt.value(n[0].modification().fold(function(){return{}},function(n){return Zt(e,n)}))},jl=function(n,e){return Xn(n,function(t,r){var o=r.modification().getOr({});return t.bind(function(t){var r=dn(o,function(r,o){return t[o]!==undefined?(i=e,u=o,a=n,Nt.error("Mulitple behaviours have tried to change the _"+u+'_ "'+i+'". The guilty behaviours are: '+ur(ee(a,function(n){return n.modification().getOr({})[u]!==undefined?[n.name()]:[]}),null,2)+". This is not currently supported.")):Nt.value(Zt(o,r));var i,u,a});return er(r,t)})},Nt.value({})).map(function(n){return Zt(e,n)})},Ll={classes:function(n,e){var t=ee(n,function(n){return n.modification().getOr([])});return Nt.value(Zt(e,t))},attributes:jl,styles:jl,domChildren:zl,defChildren:zl,innerHtml:zl,value:zl},Ul=function(n,e){return t=z.apply(undefined,[n.handler].concat(e)),r=n.purpose(),{cHandler:t,purpose:V(r)};var t,r},Pl=function(n){return n.cHandler},_l=function(n,e){return{name:V(n),handler:V(e)}},Wl=function(n,e,t){var r,o,i=Z(t,(r=n,o={},Gn(e,function(n){o[n.name()]=n.handlers(r)}),o));return Hl(i,_l)},$l=function(n){var e,t=X(e=n)?{can:V(!0),abort:V(!1),run:e}:e;return function(n,e){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];var i=[n,e].concat(r);t.abort.apply(undefined,i)?e.stop():t.can.apply(undefined,i)&&t.run.apply(undefined,i)}},Gl=function(n,e,t){var r,o,i=e[t];return i?function(n,e,t,o){var i=t.slice(0);try{var u=i.sort(function(t,r){var i=t[e](),u=r[e](),a=o.indexOf(i),c=o.indexOf(u);if(-1===a)throw new Error("The ordering for "+n+" does not have an entry for "+i+".\nOrder specified: "+ur(o,null,2));if(-1===c)throw new Error("The ordering for "+n+" does not have an entry for "+u+".\nOrder specified: "+ur(o,null,2));return a<c?-1:c<a?1:0});return Nt.value(u)}catch(r){return Nt.error([r])}}("Event: "+t,"name",n,i).map(function(n){var e=$n(n,function(n){return n.handler()});return _r(e)}):(r=t,o=n,Nt.error(["The event ("+r+') has more than one behaviour that listens to it.\nWhen this occurs, you must specify an event ordering for the behaviours in your spec (e.g. [ "listing", "toggling" ]).\nThe behaviours that can trigger it are: '+ur($n(o,function(n){return n.name()}),null,2)]))},ql=function(n,e){var t=dn(n,function(n,t){return(1===n.length?Nt.value(n[0].handler()):Gl(n,e,t)).map(function(r){var o=$l(r),i=1<n.length?qn(e,function(e){return _n(n,function(n){return n.name()===e})}).join(" > "):n[0].name();return Zt(t,{handler:o,purpose:V(i)})})});return er(t,{})
},Yl=function(n){return Or("custom.definition",gr([yr("dom","dom",Ht(),gr([Ir("tag"),jr("styles",{}),jr("classes",[]),jr("attributes",{}),Vr("value"),Vr("innerHtml")])),Ir("components"),Ir("uid"),jr("events",{}),jr("apis",V({})),yr("eventOrder","eventOrder",(e={"alloy.execute":["disabling","alloy.base.behaviour","toggling"],"alloy.focus":["alloy.base.behaviour","focusing","keying"],"alloy.system.init":["alloy.base.behaviour","disabling","toggling","representing"],input:["alloy.base.behaviour","representing","streaming","invalidating"],"alloy.system.detached":["alloy.base.behaviour","representing"]},Ft.mergeWithThunk(V(e))),Rr()),Vr("domModification"),Fi("originalSpec"),jr("debug.sketcher","unknown")]),n);var e},Xl=function(n){var e,t={tag:n.dom().tag(),classes:n.dom().classes(),attributes:Z((e=n,Zt(hs(),e.uid())),n.dom().attributes()),styles:n.dom().styles(),domChildren:$n(n.components(),function(n){return n.element()})};return ro(Z(t,n.dom().innerHtml().map(function(n){return Zt("innerHtml",n)}).getOr({}),n.dom().value().map(function(n){return Zt("value",n)}).getOr({})))},Kl=function(n,e){Gn(e,function(e){_o.add(n,e)})},Jl=function(n,e){Gn(e,function(e){_o.remove(n,e)})},Ql=function(n){if(n.domChildren().isSome()&&n.defChildren().isSome())throw new Error("Cannot specify children and child specs! Must be one or the other.\nDef: "+(e=oo(n),ur(e,null,2)));return n.domChildren().fold(function(){var e=n.defChildren().getOr([]);return $n(e,nd)},function(n){return n});var e},Zl=function(n){var e=Ve.fromTag(n.tag());Ao.setAll(e,n.attributes().getOr({})),Kl(e,n.classes().getOr([])),du.setAll(e,n.styles().getOr({})),di(e,n.innerHtml().getOr(""));var t=Ql(n);return Tt(e,t),n.value().each(function(n){Qf(e,n)}),e},nd=function(n){var e=ro(n);return Zl(e)},ed=function(n,e){return t=n,o=$n(r=e,function(n){return Hr(n.name(),[Ir("config"),jr("state",bo)])}),i=Or("component.behaviours",vr(o),t.behaviours).fold(function(n){throw new Error(Dr(n)+"\nComplete spec:\n"+ur(t,null,2))},function(n){return n}),{list:r,data:fn(i,function(n){var e=n().map(function(n){return{config:n.config(),state:n.state().init(n.config())}});return function(){return e}})};var t,r,o,i},td=function(n){var e,t,r=(e=Qt(n,"behaviours").getOr({}),t=qn(cn(e),function(n){return e[n]!==undefined}),$n(t,function(n){return e[n].me}));return ed(n,r)},rd=ho(["getSystem","config","hasConfigured","spec","connect","disconnect","element","syncComponents","readState","components","events"]),od=function(n,e,t){var r,o,i,u,a=Xl(n);return i=function(n,e,t,r){var o=Z({},e);Gn(t,function(e){o[e.name()]=e.exhibit(n,r)});var i=Hl(o,function(n,e){return{name:function(){return n},modification:e}}),u=fn(i,function(n){return ee(n,function(n){return n.modification().fold(function(){return[]},function(){return[n]})})}),a=dn(u,function(n,e){return Qt(Ll,e).fold(function(){return Nt.error("Unknown field type: "+e)},function(t){return t(n,e)})});return er(a,{}).map(io)}(t,{"alloy.base.modification":(r=n,r.domModification().fold(function(){return io({})},io))},e,a).getOrDie(),u=Z({tag:(o=a).tag(),classes:i.classes().getOr([]).concat(o.classes().getOr([])),attributes:nn(o.attributes().getOr({}),i.attributes().getOr({})),styles:nn(o.styles().getOr({}),i.styles().getOr({}))},i.innerHtml().or(o.innerHtml()).map(function(n){return Zt("innerHtml",n)}).getOr({}),uo("domChildren",i.domChildren(),o.domChildren()),uo("defChildren",i.defChildren(),o.defChildren()),i.value().or(o.value()).map(function(n){return Zt("value",n)}).getOr({})),ro(u)},id=function(n,e,t){var r,o,i,u,a,c,s={"alloy.base.behaviour":(r=n,r.events())};return(o=t,i=n.eventOrder(),u=e,a=s,c=Wl(o,u,a),ql(c,i)).getOrDie()},ud=function(n){var e,t,r,o,i,u,a,c,s,f,l,d,m,g,v=Bl(n),p=(e=v,t=Jt("components",[])(e),$n(t,sd)),h=Z(Nl,v,Zt("components",p));return Nt.value((r=h,i=Yo(Vl(o=function(){return g})),u=Cr(Yl(Z(r,{behaviours:undefined}))),c=(a=td(r)).list,s=a.data,f=od(u,c,s),l=Zl(f),d=id(u,c,s),m=Yo(u.components()),g=rd({getSystem:i.get,config:function(n){if(n===vs())return u.apis();if($(n))throw new Error("Invalid input: only API constant is allowed");var e=s;return(X(e[n.name()])?e[n.name()]:function(){throw new Error("Could not find "+n.name()+" in "+ur(r,null,2))})()},hasConfigured:function(n){return X(s[n.name()])},spec:V(r),readState:function(n){return s[n]().map(function(n){return n.state.readState()}).getOr("not enabled")},connect:function(n){i.set(n)},disconnect:function(){i.set(Vl(o))},element:V(l),syncComponents:function(){var n=ht.children(l),e=ee(n,function(n){return i.get().getByDom(n).fold(function(){return[]},function(n){return[n]})});m.set(e)},components:m.get,events:V(d)})))},ad=function(n){var e=Ve.fromText(n);return cd({element:e})},cd=function(n){var e=Er("external.component",gr([Ir("element"),Vr("uid")]),n),t=Yo(Vl());e.uid().each(function(n){var t;t=e.element(),Ao.set(t,ys,n)});var r=rd({getSystem:t.get,config:an.none,hasConfigured:V(!1),connect:function(n){t.set(n)},disconnect:function(){t.set(Vl(function(){return r}))},element:V(e.element()),spec:V(n),readState:V("No state"),syncComponents:B,components:V([]),events:V({})});return ms(r)},sd=function(n){return(e=n,Qt(e,ls)).fold(function(){var e=Z({uid:xs("")},n);return ud(e).getOrDie()},function(n){return n});var e},fd=ms,ld="alloy.item-hover",dd="alloy.item-focus",md=function(n){(oi(n.element()).isNone()||iu.isFocused(n))&&(iu.isFocused(n)||iu.focus(n),Me(n,ld,{item:n}))},gd=function(n){Me(n,dd,{item:n})},vd=V(ld),pd=V(dd),hd=[Ir("data"),Ir("components"),Ir("dom"),Vr("toggling"),jr("itemBehaviours",{}),jr("ignoreFocus",!1),jr("domModification",{}),Bi("builder",function(n){return{dom:Z(n.dom(),{attributes:{role:n.toggling().isSome()?"menuitemcheckbox":"menuitem"}}),behaviours:Z(wo([n.toggling().fold(Xi.revoke,function(n){return Xi.config(Z({aria:{mode:"checked"}},n))}),iu.config({ignore:n.ignoreFocus(),onFocus:function(n){gd(n)}}),kc.config({mode:"execution"}),ff.config({store:{mode:"memory",initialValue:n.data()}})]),n.itemBehaviours()),events:Wr([(e=Oe(),t=Ie,Gr(e,function(n,e){var r=e.event();n.getSystem().getByDom(r.target()).each(function(r){t(n,r,e)})})),Kr(pn()),Gr(yn(),md),Gr(Te(),iu.focus)]),components:n.components(),domModification:n.domModification(),eventOrder:n.eventOrder()};var e,t}),jr("eventOrder",{})],bd=[Ir("dom"),Ir("components"),Bi("builder",function(n){return{dom:n.dom(),components:n.components(),events:Wr([(e=Te(),Gr(e,function(n,e){e.stop()}))])};var e})],yd=V([Qc({name:"widget",overrides:function(n){return{behaviours:wo([ff.config({store:{mode:"manual",getValue:function(){return n.data()},setValue:function(){}}})])}}})]),wd=Ar("type",{widget:[Ir("uid"),Ir("data"),Ir("components"),Ir("dom"),jr("autofocus",!1),jr("domModification",{}),fs(yd()),Bi("builder",function(n){var e=is(0,n,yd()),t=us("item-widget",n,e.internals()),r=function(e){return as(e,n,"widget").map(function(n){return kc.focusIn(n),n})},o=function(e,t){return Zu(t.event().target())||n.autofocus()&&t.setSource(e.element()),an.none()};return Z({dom:n.dom(),components:t,domModification:n.domModification(),events:Wr([no(function(n,e){r(n).each(function(){e.stop()})}),Gr(yn(),md),Gr(Te(),function(e){n.autofocus()?r(e):iu.focus(e)})]),behaviours:wo([ff.config({store:{mode:"memory",initialValue:n.data()}}),iu.config({onFocus:function(n){gd(n)}}),kc.config({mode:"special",focusIn:n.autofocus()?function(n){r(n)}:Oo(),onLeft:o,onRight:o,onEscape:function(e,t){return iu.isFocused(e)||n.autofocus()?(n.autofocus()&&t.setSource(e.element()),an.none()):(iu.focus(e),an.some(!0))}})])})})],item:hd,separator:bd}),xd=V([ns({factory:{sketch:function(n){var e=Er("menu.spec item",wd,n);return e.builder()(e)}},name:"items",unit:"item",defaults:function(n,e){var t=xs("");return Z({uid:t},e)},overrides:function(n,e){return{type:e.type,ignoreFocus:n.fakeFocus(),domModification:{classes:[n.markers().item()]}}}})]),Td=V([Ir("value"),Ir("items"),Ir("dom"),Ir("components"),jr("eventOrder",{}),Ec("menuBehaviours",[qu,ff,Xf,kc]),Lr("movement",{mode:"menu",moveOnTab:!0},Ar("mode",{grid:[Vi(),Bi("config",function(n,e){return{mode:"flatgrid",selector:"."+n.markers().item(),initSize:{numColumns:e.initSize().numColumns(),numRows:e.initSize().numRows()},focusManager:n.focusManager()}})],menu:[jr("moveOnTab",!0),Bi("config",function(n,e){return{mode:"menu",selector:"."+n.markers().item(),moveOnTab:e.moveOnTab(),focusManager:n.focusManager()}})]})),Nr("markers",Ei()),jr("fakeFocus",!1),jr("focusManager",Yu()),Ri("onHighlight")]),Sd=V("alloy.menu-focus"),Od=Ds({name:"Menu",configFields:Td(),partFields:xd(),factory:function(n,e){return Z({dom:Z(n.dom(),{attributes:{role:"menu"}}),uid:n.uid(),behaviours:Z(wo([qu.config({highlightClass:n.markers().selectedItem(),itemClass:n.markers().item(),onHighlight:n.onHighlight()}),ff.config({store:{mode:"memory",initialValue:n.value()}}),Xf.config({find:an.some}),kc.config(n.movement().config()(n,n.movement()))]),Dc(n.menuBehaviours())),events:Wr([Gr(pd(),function(n,e){var t=e.event();n.getSystem().getByDom(t.target()).each(function(t){qu.highlight(n,t),e.stop(),Me(n,Sd(),{menu:n,item:t})})}),Gr(vd(),function(n,e){var t=e.event().item();qu.highlight(n,t)})]),components:e,eventOrder:n.eventOrder()})}}),Cd=function(n,e,t,r){var o=n.getSystem().build(r);Dt(n,o,t)},kd=function(n){return n.components()},Ed=Object.freeze({append:function(n,e,t,r){Cd(n,0,wt.append,r)},prepend:function(n,e,t,r){Cd(n,0,wt.prepend,r)},remove:function(n,e,t,r){var o=kd(n,e);Kn(o,function(n){return ft(r.element(),n.element())}).each(Rt)},set:function(n,e,t,r){var o,i,u,a,c,s;i=(o=n).components(),Gn(i,At),Ot.empty(o.element()),o.syncComponents(),u=function(){var e=$n(r,n.getSystem().build);Gn(e,function(e){Et(n,e)})},a=n.element(),c=ht.owner(a),s=ri(c).bind(function(n){var e=function(e){return ft(n,e)};return e(a)?an.some(a):Qo.descendant(a,e)}),u(a),s.each(function(n){ri(c).filter(function(e){return ft(e,n)}).fold(function(){ei(n)},B)})},contents:kd}),Dd=To({fields:[],name:"replacing",apis:Ed}),Ad=function(n,e,t,r){return Qt(t,r).bind(function(r){return Qt(n,r).bind(function(r){var o=Ad(n,e,t,r);return an.some([r].concat(o))})}).getOr([])},Rd=function(n,e){var t={};sn(n,function(n,e){Gn(n,function(n){t[n]=e})});var r=e,o=ln(e,function(n,e){return{k:n,v:e}}),i=fn(o,function(n,e){return[e].concat(Ad(t,r,o,e))});return fn(t,function(n){return Qt(i,n).getOr([n])})},Md=function(){var n=Yo({}),e=Yo({}),t=Yo({}),r=Yo(an.none()),o=Yo({}),i=function(n){return Qt(e.get(),n)};return{setContents:function(i,u,a,c){r.set(an.some(i)),n.set(a),e.set(u),o.set(c);var s=Rd(c,a);t.set(s)},expand:function(e){return Qt(n.get(),e).map(function(n){var r=Qt(t.get(),e).getOr([]);return[n].concat(r)})},refresh:function(n){return Qt(t.get(),n)},collapse:function(n){return Qt(t.get(),n).bind(function(n){return 1<n.length?an.some(n.slice(1)):an.none()})},lookupMenu:i,otherMenus:function(n){var e,t,r=o.get();return e=cn(r),t=n,qn(e,function(n){return!_n(t,n)})},getPrimary:function(){return r.get().bind(i)},getMenus:function(){return e.get()},clear:function(){n.set({}),e.set({}),t.set({}),r.set(an.none())},isClear:function(){return r.get().isNone()}}},Id=V("collapse-item"),Nd=Es({name:"TieredMenu",configFields:[Ni("onExecute"),Ni("onEscape"),Ii("onOpenMenu"),Ii("onOpenSubmenu"),Ri("onCollapseMenu"),jr("openImmediately",!0),Fr("data",[Ir("primary"),Ir("menus"),Ir("expansions")]),jr("fakeFocus",!1),Ri("onHighlight"),Ri("onHover"),Fr("markers",[Ir("backgroundMenu")].concat(Ci()).concat(ki())),Ir("dom"),jr("navigateOnHover",!0),jr("stayInDom",!1),Ec("tmenuBehaviours",[kc,qu,Xf,Dd]),jr("eventOrder",{})],apis:{collapseMenu:function(n,e){n.collapseMenu(e)}},factory:function(n,e){var t=function(t,r){return fn(r,function(r,o){var i=Od.sketch(Z(r,{value:o,items:r.items,markers:Yt(e.markers,["item","selectedItem"]),fakeFocus:n.fakeFocus(),onHighlight:n.onHighlight(),focusManager:n.fakeFocus()?{get:function(n){return qu.getHighlighted(n).map(function(n){return n.element()})},set:function(n,e){n.getSystem().getByDom(e).fold(B,function(e){qu.highlight(n,e)})}}:Yu()}));return t.getSystem().build(i)})},r=Md(),o=function(n){return ff.getValue(n).value},i=function(){return fn(n.data().menus(),function(n){return ee(n.items,function(n){return"separator"===n.type?[]:[n.data.value]})})},u=function(n,e){qu.highlight(n,e),qu.getHighlighted(e).orThunk(function(){return qu.getFirst(e)}).each(function(e){Ne(n,e.element(),Te())})},a=function(n,e){return bi($n(e,n.lookupMenu))},c=function(e,t,r){return an.from(r[0]).bind(t.lookupMenu).map(function(o){var i=a(t,r.slice(1));Gn(i,function(e){_o.add(e.element(),n.markers().backgroundMenu())}),qe.inBody(o.element())||Dd.append(e,fd(o)),Jl(o.element(),[n.markers().backgroundMenu()]),u(e,o);var c=a(t,t.otherMenus(r));return Gn(c,function(t){Jl(t.element(),[n.markers().backgroundMenu()]),n.stayInDom()||Dd.remove(e,t)}),o})},s=function(e,t){var i=o(t);return r.expand(i).bind(function(o){return an.from(o[0]).bind(r.lookupMenu).each(function(r){qe.inBody(r.element())||Dd.append(e,fd(r)),n.onOpenSubmenu()(e,t,r),qu.highlightFirst(r)}),c(e,r,o)})},f=function(e,t){var i=o(t);return r.collapse(i).bind(function(o){return c(e,r,o).map(function(r){return n.onCollapseMenu()(e,t,r),r})})},l=function(e){return function(t,r){return Cu(r.getSource(),"."+n.markers().item()).bind(function(n){return t.getSystem().getByDom(n).toOption().bind(function(n){return e(t,n).map(function(){return!0})})})}},d=Wr([Gr(Sd(),function(n,e){var t=e.event().menu();qu.highlight(n,t)}),no(function(e,t){var r=t.event().target();e.getSystem().getByDom(r).each(function(t){0===o(t).indexOf("collapse-item")&&f(e,t),s(e,t).fold(function(){n.onExecute()(e,t)},function(){})})}),Jr(function(e){var o,a,c;(o=e,a=t(o,n.data().menus()),c=i(o),r.setContents(n.data().primary(),a,n.data().expansions(),c),r.getPrimary()).each(function(t){Dd.append(e,fd(t)),n.openImmediately()&&(u(e,t),n.onOpenMenu()(e,t))})})].concat(n.navigateOnHover()?[Gr(vd(),function(e,t){var i,u,a=t.event().item();i=e,u=o(a),r.refresh(u).bind(function(n){return c(i,r,n)}),s(e,a),n.onHover()(e,a)})]:[]));return{uid:n.uid(),dom:n.dom(),behaviours:Z(wo([kc.config({mode:"special",onRight:l(function(n,e){return Zu(e.element())?an.none():s(n,e)}),onLeft:l(function(n,e){return Zu(e.element())?an.none():f(n,e)}),onEscape:l(function(e,t){return f(e,t).orThunk(function(){return n.onEscape()(e,t).map(function(){return e})})}),focusIn:function(n){r.getPrimary().each(function(e){Ne(n,e.element(),Te())})}}),qu.config({highlightClass:n.markers().selectedMenu(),itemClass:n.markers().menu()}),Xf.config({find:function(n){return qu.getHighlighted(n)}}),Dd.config({})]),Dc(n.tmenuBehaviours())),eventOrder:n.eventOrder(),apis:{collapseMenu:function(n){qu.getHighlighted(n).each(function(e){qu.getHighlighted(e).each(function(e){f(n,e)})})}},events:d}},extraApis:{tieredData:function(n,e,t){return{primary:n,menus:e,expansions:t}},singleData:function(n,e){return{primary:n,menus:Zt(n,e),expansions:{}}},collapseItem:function(n){return{value:zc(Id()),text:n}}}}),Bd=function(n,e,t,r){return Qt(e.routes(),r.start()).map(U).bind(function(n){return Qt(n,r.destination()).map(U)})},Fd=function(n,e,t,r){return Bd(0,e,0,r).bind(function(n){return n.transition().map(function(e){return{transition:V(e),route:V(n)}})})},Vd=function(n,e,t){var r,o,i;(r=n,o=e,i=t,Hd(r,o,i).bind(function(n){return Fd(r,o,i,n)})).each(function(t){var r=t.transition();_o.remove(n.element(),r.transitionClass()),Ao.remove(n.element(),e.destinationAttr())})},Hd=function(n,e){var t=n.element();return Ao.has(t,e.destinationAttr())?an.some({start:V(Ao.get(n.element(),e.stateAttr())),destination:V(Ao.get(n.element(),e.destinationAttr()))}):an.none()},zd=function(n,e,t,r){Vd(n,e,t),Ao.has(n.element(),e.stateAttr())&&Ao.get(n.element(),e.stateAttr())!==r&&e.onFinish()(n,r),Ao.set(n.element(),e.stateAttr(),r)},jd=Object.freeze({findRoute:Bd,disableTransition:Vd,getCurrentRoute:Hd,jumpTo:zd,progressTo:function(n,e,t,r){var o,i;i=e,Ao.has((o=n).element(),i.destinationAttr())&&(Ao.set(o.element(),i.stateAttr(),Ao.get(o.element(),i.destinationAttr())),Ao.remove(o.element(),i.destinationAttr()));var u,a,c=(u=e,a=r,{start:V(Ao.get(n.element(),u.stateAttr())),destination:V(a)});Fd(n,e,t,c).fold(function(){zd(n,e,t,r)},function(o){Vd(n,e,t);var i=o.transition();_o.add(n.element(),i.transitionClass()),Ao.set(n.element(),e.destinationAttr(),r)})},getState:function(n,e){var t=n.element();return Ao.has(t,e.stateAttr())?an.some(Ao.get(t,e.stateAttr())):an.none()}}),Ld=Object.freeze({events:function(n,e){return Wr([Gr(On(),function(t,r){var o=r.event().raw();Hd(t,n,e).each(function(r){Bd(0,n,0,r).each(function(i){i.transition().each(function(i){o.propertyName===i.property()&&(zd(t,n,e,r.destination()),n.onTransition()(t,r))})})})}),Jr(function(t){zd(t,n,e,n.initialState())})])}}),Ud=[jr("destinationAttr","data-transitioning-destination"),jr("stateAttr","data-transitioning-state"),Ir("initialState"),Ri("onTransition"),Ri("onFinish"),Nr("routes",pr(Nt.value,pr(Nt.value,gr([zr("transition",[Ir("property"),Ir("transitionClass")])]))))],Pd=To({fields:Ud,name:"transitioning",active:Ld,apis:jd,extra:{createRoutes:function(n){var e={};return sn(n,function(n,t){var r=t.split("<->");e[r[0]]=Zt(r[1],n),e[r[1]]=Zt(r[0],n)}),e},createBistate:function(n,e,t){return nr([{key:n,value:Zt(e,t)},{key:e,value:Zt(n,t)}])},createTristate:function(n,e,t,r){return nr([{key:n,value:nr([{key:e,value:r},{key:t,value:r}])},{key:e,value:nr([{key:n,value:r},{key:t,value:r}])},{key:t,value:nr([{key:n,value:r},{key:e,value:r}])}])}}}),_d=nu.resolve("scrollable"),Wd={register:function(n){_o.add(n,_d)},deregister:function(n){_o.remove(n,_d)},scrollable:V(_d)},$d=function(n){return Qt(n,"format").getOr(n.title)},Gd=function(n,e,t,r,o){return{data:{value:n,text:e},type:"item",dom:{tag:"div",classes:o?[nu.resolve("styles-item-is-menu")]:[]},toggling:{toggleOnExecute:!1,toggleClass:nu.resolve("format-matches"),selected:t},itemBehaviours:wo(o?[]:[Ki(n,function(n,e){(e?Xi.on:Xi.off)(n)})]),components:[{dom:{tag:"div",attributes:{style:r},innerHtml:e}}]}},qd=function(n,e,t,r){return{value:n,dom:{tag:"div"},components:[As.sketch({dom:{tag:"div",classes:[nu.resolve("styles-collapser")]},components:r?[{dom:{tag:"span",classes:[nu.resolve("styles-collapse-icon")]}},ad(n)]:[ad(n)],action:function(n){if(r){var e=t().get(n);Nd.collapseMenu(e)}}}),{dom:{tag:"div",classes:[nu.resolve("styles-menu-items-container")]},components:[Od.parts().items({})],behaviours:wo([Gf("adhoc-scrollable-menu",[Jr(function(n){du.set(n.element(),"overflow-y","auto"),du.set(n.element(),"-webkit-overflow-scrolling","touch"),Wd.register(n.element())}),Qr(function(n){du.remove(n.element(),"overflow-y"),du.remove(n.element(),"-webkit-overflow-scrolling"),Wd.deregister(n.element())})])])}],items:e,menuBehaviours:wo([Pd.config({initialState:"after",routes:Pd.createTristate("before","current","after",{transition:{property:"transform",transitionClass:"transitioning"}})})])}},Yd=function(n){var e,t,r,o,i,u=(e=n.formats,t=function(){return a},r=qd("Styles",[].concat($n(e.items,function(n){return Gd($d(n),n.title,n.isSelected(),n.getPreview(),tr(e.expansions,$d(n)))})),t,!1),o=fn(e.menus,function(n,r){var o=$n(n,function(n){return Gd($d(n),n.title,n.isSelected!==undefined&&n.isSelected(),n.getPreview!==undefined?n.getPreview():"",tr(e.expansions,$d(n)))});return qd(r,o,t,!0)}),i=Z(o,Zt("styles",r)),{tmenu:Nd.tieredData("styles",i,e.expansions)}),a=Df(Nd.sketch({dom:{tag:"div",classes:[nu.resolve("styles-menu")]},components:[],fakeFocus:!0,stayInDom:!0,onExecute:function(e,t){var r=ff.getValue(t);return n.handle(t,r.value),an.none()},onEscape:function(){return an.none()},onOpenMenu:function(n,e){var t=vf(n.element());gf(e.element(),t),Pd.jumpTo(e,"current")},onOpenSubmenu:function(n,e,t){var r=vf(n.element()),o=Su(e.element(),'[role="menu"]').getOrDie("hacky"),i=n.getSystem().getByDom(o).getOrDie();gf(t.element(),r),Pd.progressTo(i,"before"),Pd.jumpTo(t,"after"),Pd.progressTo(t,"current")},onCollapseMenu:function(n,e,t){var r=Su(e.element(),'[role="menu"]').getOrDie("hacky"),o=n.getSystem().getByDom(r).getOrDie();Pd.progressTo(o,"after"),Pd.progressTo(t,"current")},navigateOnHover:!1,openImmediately:!0,data:u.tmenu,markers:{backgroundMenu:nu.resolve("styles-background-menu"),menu:nu.resolve("styles-menu"),selectedMenu:nu.resolve("styles-selected-menu"),item:nu.resolve("styles-item"),selectedItem:nu.resolve("styles-selected-item")}}));return a.asSpec()},Xd=function(n){return tr(n,"items")?(t=Z(Xt(e=n,["items"]),{menu:!0}),r=Kd(e.items),{item:t,menus:Z(r.menus,Zt(e.title,r.items)),expansions:Z(r.expansions,Zt(e.title,e.title))}):{item:n,menus:{},expansions:{}};var e,t,r},Kd=function(n){return Yn(n,function(n,e){var t=Xd(e);return{menus:Z(n.menus,t.menus),items:[t.item].concat(n.items),expansions:Z(n.expansions,t.expansions)}},{menus:{},expansions:{},items:[]})},Jd={expand:Kd},Qd=function(n,e){var t=function(e){return function(){return n.formatter.match(e)}},r=function(e){return function(){return n.formatter.getCssText(e)}},o=Qt(e,"style_formats").getOr(Ml),i=function(e){return $n(e,function(e){if(tr(e,"items")){var o=i(e.items);return Z(Z(e,{isSelected:V(!1),getPreview:V("")}),{items:o})}return tr(e,"format")?Z(s=e,{isSelected:t(s.format),getPreview:r(s.format)}):(a=zc((u=e).title),c=Z(u,{format:a,isSelected:t(a),getPreview:r(a)}),n.formatter.register(a,c),c);var u,a,c,s})};return i(o)},Zd=function(n,e,t){var r,o,i,u=(r=n,i=(o=function(n){return ee(n,function(n){return n.items!==undefined?0<o(n.items).length?[n]:[]:!tr(n,"format")||r.formatter.canApply(n.format)?[n]:[]})})(e),Jd.expand(i));return Yd({formats:u,handle:function(e,r){n.undoManager.transact(function(){Xi.isOn(e)?n.formatter.remove(r):n.formatter.apply(r)}),t()}})},nm=["undo","bold","italic","link","image","bullist","styleselect"],em=function(n){var e=n.replace(/\|/g," ").trim();return 0<e.length?e.split(/\s+/):[]},tm=function(n){return ee(n,function(n){return q(n)?tm(n):em(n)})},rm=function(n){var e=n.toolbar!==undefined?n.toolbar:nm;return q(e)?tm(e):em(e)},om=function(n,e){var t=function(n){return function(){return Hs.forToolbarCommand(e,n)}},r=function(n){return function(){return Hs.forToolbarStateCommand(e,n)}},o=function(n,t,r){return function(){return Hs.forToolbarStateAction(e,n,t,r)}},i=t("undo"),u=t("redo"),a=r("bold"),c=r("italic"),s=r("underline"),f=t("removeformat"),l=o("unlink","link",function(){e.execCommand("unlink",null,!1)}),d=o("unordered-list","ul",function(){e.execCommand("InsertUnorderedList",null,!1)}),m=o("ordered-list","ol",function(){e.execCommand("InsertOrderedList",null,!1)}),g=Qd(e,e.settings),v=function(){return Zd(e,g,function(){e.fire("scrollIntoView")})},p=function(n,t){return{isSupported:function(){return n.forall(function(n){return tr(e.buttons,n)})},sketch:t}};return{undo:p(an.none(),i),redo:p(an.none(),u),bold:p(an.none(),a),italic:p(an.none(),c),underline:p(an.none(),s),removeformat:p(an.none(),f),link:p(an.none(),function(){return t=n,r=e,Hs.forToolbarStateAction(r,"link","link",function(){var n=Rl(t,r);t.setContextToolbar(n),$f(r,function(){t.focusToolbar()}),Pf.query(r).each(function(n){r.selection.select(n.dom())})});var t,r}),unlink:p(an.none(),l),image:p(an.none(),function(){return Ff(e)}),bullist:p(an.some("bullist"),d),numlist:p(an.some("numlist"),m),fontsizeselect:p(an.none(),function(){return t=e,r={onChange:function(n){Cf.apply(t,n)},getInitialValue:function(){return Cf.get(t)}},bf(n,"font-size",function(){return Ef(r)});var t,r}),forecolor:p(an.none(),function(){return wf(n,e)}),styleselect:p(an.none(),function(){return Hs.forToolbar("style-formats",function(t){e.fire("toReading"),n.dropup().appear(v,Xi.on,t)},wo([Xi.config({toggleClass:nu.resolve("toolbar-button-selected"),toggleOnExecute:!1,aria:{mode:"pressed"}}),zi.config({channels:nr([Qi(ci.orientationChanged(),Xi.off),Qi(ci.dropupDismissed(),Xi.off)])})]))})}},im=function(n,e){var t=rm(n),r={};return ee(t,function(n){var t=!tr(r,n)&&tr(e,n)&&e[n].isSupported()?[e[n].sketch()]:[];return r[n]=!0,t})},um=function(n,e){return function(t){if(n(t)){var r,o,i,u,a,c,s,f=Ve.fromDom(t.target),l=function(){t.stopPropagation()},d=function(){t.preventDefault()},m=F(d,l),g=(r=f,o=t.clientX,i=t.clientY,u=l,a=d,c=m,s=t,{target:V(r),x:V(o),y:V(i),stop:u,prevent:a,kill:c,raw:V(s)});e(g)}}},am=function(n,e,t,r,o){var i=um(t,r);return n.dom().addEventListener(e,i,o),{unbind:z(cm,n,e,i,o)}},cm=function(n,e,t,r){n.dom().removeEventListener(e,t,r)},sm=function(n,e,t,r){return am(n,e,t,r,!1)},fm=function(n,e,t,r){return am(n,e,t,r,!0)},lm=V(!0),dm=function(n,e,t){return sm(n,e,lm,t)},mm=function(n,e,t){return fm(n,e,lm,t)},gm=function(n){var e=n.matchMedia("(orientation: portrait)").matches;return{isPortrait:V(e)}},vm=gm,pm=function(n,e){var t=Ve.fromDom(n),r=null,o=dm(t,"orientationchange",function(){clearInterval(r);var t=gm(n);e.onChange(t),i(function(){e.onReady(t)})}),i=function(e){clearInterval(r);var t=n.innerHeight,o=0;r=setInterval(function(){t!==n.innerHeight?(clearInterval(r),e(an.some(n.innerHeight))):20<o&&(clearInterval(r),e(an.none())),o++},50)};return{onAdjustment:i,destroy:function(){o.unbind()}}},hm=function(n){var e=pe.detect().os.isiOS(),t=gm(n).isPortrait();return e&&!t?n.screen.height:n.screen.width},bm=function(n){var e=n.raw();return e.touches===undefined||1!==e.touches.length?an.none():an.some(e.touches[0])},ym=function(n){var e,t,r,o=Yo(an.none()),i=(e=function(e){o.set(an.none()),n.triggerEvent(Ce(),e)},t=400,r=null,{cancel:function(){null!==r&&(clearTimeout(r),r=null)},schedule:function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];r=setTimeout(function(){e.apply(null,n),r=null},t)}}),u=nr([{key:mn(),value:function(n){return bm(n).each(function(e){i.cancel();var t={x:V(e.clientX),y:V(e.clientY),target:n.target};i.schedule(n),o.set(an.some(t))}),an.none()}},{key:gn(),value:function(n){return i.cancel(),bm(n).each(function(n){o.get().each(function(e){var t,r,i,u;t=n,r=e,i=Math.abs(t.clientX-r.x()),u=Math.abs(t.clientY-r.y()),(5<i||5<u)&&o.set(an.none())})}),an.none()}},{key:vn(),value:function(e){return i.cancel(),o.get().filter(function(n){return ft(n.target(),e.target())}).map(function(){return n.triggerEvent(Se(),e)})}}]);return{fireIfReady:function(n,e){return Qt(u,e).bind(function(e){return e(n)})}}},wm=function(n){var e=ym({triggerEvent:function(e,t){n.onTapContent(t)}});return{fireTouchstart:function(n){e.fireIfReady(n,"touchstart")},onTouchend:function(){return dm(n.body(),"touchend",function(n){e.fireIfReady(n,"touchend")})},onTouchmove:function(){return dm(n.body(),"touchmove",function(n){e.fireIfReady(n,"touchmove")})}}},xm=6<=pe.detect().os.version.major,Tm=function(n,e,t){var r=wm(n),o=ht.owner(e),i=function(n){return!ft(n.start(),n.finish())||n.soffset()!==n.foffset()},u=function(){var r=n.doc().dom().hasFocus()&&n.getSelection().exists(i);t.getByDom(e).each(!0===(r||ri(o).filter(function(n){return"input"===We.name(n)}).exists(function(n){return n.dom().selectionStart!==n.dom().selectionEnd}))?Xi.on:Xi.off)},a=[dm(n.body(),"touchstart",function(e){n.onTouchContent(),r.fireTouchstart(e)}),r.onTouchmove(),r.onTouchend(),dm(e,"touchstart",function(){n.onTouchToolstrip()}),n.onToReading(function(){ti(n.body())}),n.onToEditing(B),n.onScrollToCursor(function(e){e.preventDefault(),n.getCursorBox().each(function(e){var t=n.win(),r=e.top()>t.innerHeight||e.bottom()>t.innerHeight?e.bottom()-t.innerHeight+50:0;0!==r&&t.scrollTo(t.pageXOffset,t.pageYOffset+r)})})].concat(!0===xm?[]:[dm(Ve.fromDom(n.win()),"blur",function(){t.getByDom(e).each(Xi.off)}),dm(o,"select",u),dm(n.doc(),"selectionchange",u)]);return{destroy:function(){Gn(a,function(n){n.unbind()})}}},Sm=function(n,e){var t=parseInt(Ao.get(n,e),10);return isNaN(t)?0:t},Om=(D=We.isText,A="text",R=function(n){return D(n)?an.from(n.dom().nodeValue):an.none()},M=pe.detect().browser,{get:function(n){if(!D(n))throw new Error("Can only get "+A+" value of a "+A+" node");return I(n).getOr("")},getOption:I=M.isIE()&&10===M.version.major?function(n){try{return R(n)}catch(h){return an.none()}}:R,set:function(n,e){if(!D(n))throw new Error("Can only set raw "+A+" value of a "+A+" node");n.dom().nodeValue=e}}),Cm=function(n){return Om.getOption(n)},km=function(n){return"img"===We.name(n)?1:Cm(n).fold(function(){return ht.children(n).length},function(n){return n.length})},Em=Bt([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),Dm={before:Em.before,on:Em.on,after:Em.after,cata:function(n,e,t,r){return n.fold(e,t,r)},getStart:function(n){return n.fold(H,H,H)}},Am=Bt([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),Rm=Ye("start","soffset","finish","foffset"),Mm={domRange:Am.domRange,relative:Am.relative,exact:Am.exact,exactFromRange:function(n){return Am.exact(n.start(),n.soffset(),n.finish(),n.foffset())},range:Rm,getWin:function(n){var e=n.match({domRange:function(n){return Ve.fromDom(n.startContainer)},relative:function(n){return Dm.getStart(n)},exact:function(n){return n}});return ht.defaultView(e)}},Im=function(n,e,t,r){var o=ht.owner(n).dom().createRange();return o.setStart(n.dom(),e),o.setEnd(t.dom(),r),o},Nm=function(n,e,t,r){var o=Im(n,e,t,r),i=ft(n,t)&&e===r;return o.collapsed&&!i},Bm=function(n,e){n.selectNodeContents(e.dom())},Fm=function(n){n.deleteContents()},Vm=function(n){return{left:V(n.left),top:V(n.top),right:V(n.right),bottom:V(n.bottom),width:V(n.width),height:V(n.height)}},Hm={create:function(n){return n.document.createRange()},replaceWith:function(n,e){Fm(n),n.insertNode(e.dom())},selectNodeContents:function(n,e){var t=n.document.createRange();return Bm(t,e),t},selectNodeContentsUsing:Bm,relativeToNative:function(n,e,t){var r,o,i=n.document.createRange();return r=i,e.fold(function(n){r.setStartBefore(n.dom())},function(n,e){r.setStart(n.dom(),e)},function(n){r.setStartAfter(n.dom())}),o=i,t.fold(function(n){o.setEndBefore(n.dom())},function(n,e){o.setEnd(n.dom(),e)},function(n){o.setEndAfter(n.dom())}),i},exactToNative:function(n,e,t,r,o){var i=n.document.createRange();return i.setStart(e.dom(),t),i.setEnd(r.dom(),o),i},deleteContents:Fm,cloneFragment:function(n){var e=n.cloneContents();return Ve.fromDom(e)},getFirstRect:function(n){var e=n.getClientRects(),t=0<e.length?e[0]:n.getBoundingClientRect();return 0<t.width||0<t.height?an.some(t).map(Vm):an.none()},getBounds:function(n){var e=n.getBoundingClientRect();return 0<e.width||0<e.height?an.some(e).map(Vm):an.none()},isWithin:function(n,e){return e.compareBoundaryPoints(n.END_TO_START,n)<1&&-1<e.compareBoundaryPoints(n.START_TO_END,n)},toString:function(n){return n.toString()}},zm=Bt([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),jm=function(n,e,t){return e(Ve.fromDom(t.startContainer),t.startOffset,Ve.fromDom(t.endContainer),t.endOffset)},Lm=function(n,e){var t,r,o,i=(t=n,e.match({domRange:function(n){return{ltr:V(n),rtl:an.none}},relative:function(n,e){return{ltr:kn(function(){return Hm.relativeToNative(t,n,e)}),rtl:kn(function(){return an.some(Hm.relativeToNative(t,e,n))})}},exact:function(n,e,r,o){return{ltr:kn(function(){return Hm.exactToNative(t,n,e,r,o)}),rtl:kn(function(){return an.some(Hm.exactToNative(t,r,o,n,e))})}}}));return(o=(r=i).ltr()).collapsed?r.rtl().filter(function(n){return!1===n.collapsed}).map(function(n){return zm.rtl(Ve.fromDom(n.endContainer),n.endOffset,Ve.fromDom(n.startContainer),n.startOffset)}).getOrThunk(function(){return jm(0,zm.ltr,o)}):jm(0,zm.ltr,o)},Um=(zm.ltr,zm.rtl,Lm),Pm=function(n,e){return Lm(n,e).match({ltr:function(e,t,r,o){var i=n.document.createRange();return i.setStart(e.dom(),t),i.setEnd(r.dom(),o),i},rtl:function(e,t,r,o){var i=n.document.createRange();return i.setStart(r.dom(),o),i.setEnd(e.dom(),t),i}})},_m=(document.caretPositionFromPoint||document.caretRangeFromPoint,function(n,e){var t=We.name(n);return"input"===t?Dm.after(n):_n(["br","img"],t)?0===e?Dm.before(n):Dm.after(n):Dm.on(n,e)}),Wm=function(n,e,t,r){var o=_m(n,e),i=_m(t,r);return Mm.relative(o,i)},$m=function(n,e){an.from(n.getSelection()).each(function(n){n.removeAllRanges(),n.addRange(e)})},Gm=function(n,e,t,r,o){var i=Hm.exactToNative(n,e,t,r,o);$m(n,i)},qm=function(n,e){return Um(n,e).match({ltr:function(e,t,r,o){Gm(n,e,t,r,o)},rtl:function(e,t,r,o){var i,u,a,c,s,f=n.getSelection();if(f.setBaseAndExtent)f.setBaseAndExtent(e.dom(),t,r.dom(),o);else if(f.extend)try{u=e,a=t,c=r,s=o,(i=f).collapse(u.dom(),a),i.extend(c.dom(),s)}catch(P){Gm(n,r,o,e,t)}else Gm(n,r,o,e,t)}})},Ym=function(n){var e=Ve.fromDom(n.anchorNode),t=Ve.fromDom(n.focusNode)
;return Nm(e,n.anchorOffset,t,n.focusOffset)?an.some(Mm.range(Ve.fromDom(n.anchorNode),n.anchorOffset,Ve.fromDom(n.focusNode),n.focusOffset)):function(n){if(0<n.rangeCount){var e=n.getRangeAt(0),t=n.getRangeAt(n.rangeCount-1);return an.some(Mm.range(Ve.fromDom(e.startContainer),e.startOffset,Ve.fromDom(t.endContainer),t.endOffset))}return an.none()}(n)},Xm=function(n){return an.from(n.getSelection()).filter(function(n){return 0<n.rangeCount}).bind(Ym)},Km=function(n,e,t,r,o){var i=Wm(e,t,r,o);qm(n,i)},Jm=Xm,Qm=function(n){return Xm(n).map(function(n){return Mm.exact(n.start(),n.soffset(),n.finish(),n.foffset())})},Zm=function(n){n.getSelection().removeAllRanges()},ng=function(n,e){var t=Pm(n,e);return Hm.getFirstRect(t)},eg=function(n){return{left:n.left,top:n.top,right:n.right,bottom:n.bottom,width:V(2),height:n.height}},tg=function(n){return{left:V(n.left),top:V(n.top),right:V(n.right),bottom:V(n.bottom),width:V(n.width),height:V(n.height)}},rg=function(n){var e=n.getSelection();return e!==undefined&&0<e.rangeCount?function(n){if(n.collapsed){var e=Ve.fromDom(n.startContainer);return ht.parent(e).bind(function(t){var r=Mm.exact(e,n.startOffset,t,km(t));return ng(n.startContainer.ownerDocument.defaultView,r).map(eg).map(ie)}).getOr([])}return $n(n.getClientRects(),tg)}(e.getRangeAt(0)):[]},og=function(n){n.focus();var e=Ve.fromDom(n.document.body);(ri().exists(function(n){return _n(["input","textarea"],We.name(n))})?function(n){setTimeout(function(){n()},0)}:U)(function(){ri().each(ti),ei(e)})},ig="data-"+nu.resolve("last-outer-height"),ug=function(n,e){Ao.set(n,ig,e)},ag=function(n){return{top:V(n.top()),bottom:V(n.top()+n.height())}},cg=function(n,e){var t=Sm(e,ig),r=n.innerHeight;return r<t?an.some(t-r):an.none()},sg=function(n,e){var t=Ve.fromDom(e.document.body),r=dm(Ve.fromDom(n),"resize",function(){cg(n,t).each(function(n){var t,r;(t=e,r=rg(t),0<r.length?an.some(r[0]).map(ag):an.none()).each(function(t){var r,o,i,u=(r=e,i=n,(o=t).top()>r.innerHeight||o.bottom()>r.innerHeight?Math.min(i,o.bottom()-r.innerHeight+50):0);0!==u&&e.scrollTo(e.pageXOffset,e.pageYOffset+u)})}),ug(t,n.innerHeight)});return ug(t,n.innerHeight),{toEditing:function(){og(e)},destroy:function(){r.unbind()}}},fg=function(n){return an.some(Ve.fromDom(n.dom().contentWindow.document.body))},lg=function(n){return an.some(Ve.fromDom(n.dom().contentWindow.document))},dg=function(n){return an.from(n.dom().contentWindow)},mg=function(n){return dg(n).bind(Jm)},gg=function(n){return n.getFrame()},vg=function(n,e){return function(t){return t[n].getOrThunk(function(){var n=gg(t);return function(){return e(n)}})()}},pg=function(n,e,t,r){return n[t].getOrThunk(function(){return function(n){return dm(e,r,n)}})},hg=function(n){return{left:V(n.left),top:V(n.top),right:V(n.right),bottom:V(n.bottom),width:V(n.width),height:V(n.height)}},bg={getBody:vg("getBody",fg),getDoc:vg("getDoc",lg),getWin:vg("getWin",dg),getSelection:vg("getSelection",mg),getFrame:gg,getActiveApi:function(n){var e=gg(n);return fg(e).bind(function(t){return lg(e).bind(function(r){return dg(e).map(function(o){var i=Ve.fromDom(r.dom().documentElement),u=n.getCursorBox.getOrThunk(function(){return function(){return Qm(o).bind(function(n){return ng(o,n).orThunk(function(){return Jm(o).filter(function(n){return ft(n.start(),n.finish())&&n.soffset()===n.foffset()}).bind(function(n){var e=n.start().dom().getBoundingClientRect();return 0<e.width||0<e.height?an.some(e).map(hg):an.none()})})})}}),a=n.setSelection.getOrThunk(function(){return function(n,e,t,r){Km(o,n,e,t,r)}}),c=n.clearSelection.getOrThunk(function(){return function(){Zm(o)}});return{body:V(t),doc:V(r),win:V(o),html:V(i),getSelection:z(mg,e),setSelection:a,clearSelection:c,frame:V(e),onKeyup:pg(n,r,"onKeyup","keyup"),onNodeChanged:pg(n,r,"onNodeChanged","selectionchange"),onDomChanged:n.onDomChanged,onScrollToCursor:n.onScrollToCursor,onScrollToElement:n.onScrollToElement,onToReading:n.onToReading,onToEditing:n.onToEditing,onToolbarScrollStart:n.onToolbarScrollStart,onTouchContent:n.onTouchContent,onTapContent:n.onTapContent,onTouchToolstrip:n.onTouchToolstrip,getCursorBox:u}})})})}},yg="data-ephox-mobile-fullscreen-style",wg="position:absolute!important;",xg="top:0!important;left:0!important;margin:0!important;padding:0!important;width:100%!important;",Tg=pe.detect().os.isAndroid(),Sg=function(n,e){var t,r,o=function(n){return function(e){var t=Ao.get(e,"style"),r=t===undefined?"no-styles":t.trim();r!==n&&(Ao.set(e,yg,r),Ao.set(e,"style",n))}},i=bu(n,"*"),u=ee(i,function(n){return yu(n,"*")}),a=(t=e,(r=du.get(t,"background-color"))!==undefined&&""!==r?"background-color:"+r+"!important":"background-color:rgb(255,255,255)!important;");Gn(u,o("display:none!important;")),Gn(i,o(wg+xg+a)),o((!0===Tg?"":wg)+xg+a)(n)},Og=function(){var n=hu("["+yg+"]");Gn(n,function(n){var e=Ao.get(n,yg);"no-styles"!==e?Ao.set(n,"style",e):Ao.remove(n,"style"),Ao.remove(n,yg)})},Cg=function(){var n=Tu("head").getOrDie(),e=Tu('meta[name="viewport"]').getOrThunk(function(){var e=Ve.fromTag("meta");return Ao.set(e,"name","viewport"),wt.append(n,e),e}),t=Ao.get(e,"content");return{maximize:function(){Ao.set(e,"content","width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0")},restore:function(){t!==undefined&&null!==t&&0<t.length?Ao.set(e,"content",t):Ao.set(e,"content","user-scalable=yes")}}},kg=function(n,e){var t=Cg(),r=Ol(),o=Ol();return{enter:function(){e.hide(),_o.add(n.container,nu.resolve("fullscreen-maximized")),_o.add(n.container,nu.resolve("android-maximized")),t.maximize(),_o.add(n.body,nu.resolve("android-scroll-reload")),r.set(sg(n.win,bg.getWin(n.editor).getOrDie("no"))),bg.getActiveApi(n.editor).each(function(e){Sg(n.container,e.body()),o.set(Tm(e,n.toolstrip,n.alloy))})},exit:function(){t.restore(),e.show(),_o.remove(n.container,nu.resolve("fullscreen-maximized")),_o.remove(n.container,nu.resolve("android-maximized")),Og(),_o.remove(n.body,nu.resolve("android-scroll-reload")),o.clear(),r.clear()}}},Eg=function(n,e){var t=null;return{cancel:function(){null!==t&&(clearTimeout(t),t=null)},throttle:function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];null!==t&&clearTimeout(t),t=setTimeout(function(){n.apply(null,r),t=null},e)}}},Dg=function(n){var e,t,r,o=Df(Kf.sketch({dom:Ns('<div aria-hidden="true" class="${prefix}-mask-tap-icon"></div>'),containerBehaviours:wo([Xi.config({toggleClass:nu.resolve("mask-tap-icon-selected"),toggleOnExecute:!1})])})),i=(e=n,t=200,r=null,{cancel:function(){null!==r&&(clearTimeout(r),r=null)},throttle:function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];null===r&&(r=setTimeout(function(){e.apply(null,n),r=null},t))}});return Kf.sketch({dom:Ns('<div class="${prefix}-disabled-mask"></div>'),components:[Kf.sketch({dom:Ns('<div class="${prefix}-content-container"></div>'),components:[As.sketch({dom:Ns('<div class="${prefix}-content-tap-section"></div>'),components:[o.asSpec()],action:function(){i.throttle()},buttonBehaviours:wo([Xi.config({toggleClass:nu.resolve("mask-tap-icon-selected")})])})]})]})},Ag=vr([Fr("editor",[Ir("getFrame"),Vr("getBody"),Vr("getDoc"),Vr("getWin"),Vr("getSelection"),Vr("setSelection"),Vr("clearSelection"),Vr("cursorSaver"),Vr("onKeyup"),Vr("onNodeChanged"),Vr("getCursorBox"),Ir("onDomChanged"),jr("onTouchContent",B),jr("onTapContent",B),jr("onTouchToolstrip",B),jr("onScrollToCursor",V({unbind:B})),jr("onScrollToElement",V({unbind:B})),jr("onToEditing",V({unbind:B})),jr("onToReading",V({unbind:B})),jr("onToolbarScrollStart",H)]),Ir("socket"),Ir("toolstrip"),Ir("dropup"),Ir("toolbar"),Ir("container"),Ir("alloy"),Ur("win",function(n){return ht.owner(n.socket).dom().defaultView}),Ur("body",function(n){return Ve.fromDom(n.socket.dom().ownerDocument.body)}),jr("translate",H),jr("setReadOnly",B),jr("readOnlyOnInit",V(!0))]),Rg=function(n){var e=kr("Getting AndroidWebapp schema",Ag,n);du.set(e.toolstrip,"width","100%");var t=sd(Dg(function(){e.setReadOnly(e.readOnlyOnInit()),o.enter()},e.translate));e.alloy.add(t);var r={show:function(){e.alloy.add(t)},hide:function(){e.alloy.remove(t)}};wt.append(e.container,t.element());var o=kg(e,r);return{setReadOnly:e.setReadOnly,refreshStructure:B,enter:o.enter,exit:o.exit,destroy:B}},Mg=V([jr("shell",!0),Ec("toolbarBehaviours",[Dd])]),Ig=V([Zc({name:"groups",overrides:function(){return{behaviours:wo([Dd.config({})])}}})]),Ng=Ds({name:"Toolbar",configFields:Mg(),partFields:Ig(),factory:function(n,e){var t=function(e){return n.shell()?an.some(e):as(e,n,"groups")},r=n.shell()?{behaviours:[Dd.config({})],components:[]}:{behaviours:[],components:e};return{uid:n.uid(),dom:n.dom(),components:r.components,behaviours:Z(wo(r.behaviours),Dc(n.toolbarBehaviours())),apis:{setGroups:function(n,e){t(n).fold(function(){throw console.error("Toolbar was defined to not be a shell, but no groups container was specified in components"),new Error("Toolbar was defined to not be a shell, but no groups container was specified in components")},function(n){Dd.set(n,e)})}},domModification:{attributes:{role:"group"}}}},apis:{setGroups:function(n,e,t){n.setGroups(e,t)}}}),Bg=V([Ir("items"),(N=["itemClass"],Fr("markers",$n(N,Ir))),Ec("tgroupBehaviours",[kc])]),Fg=V([ns({name:"items",unit:"item",overrides:function(n){return{domModification:{classes:[n.markers().itemClass()]}}}})]),Vg=Ds({name:"ToolbarGroup",configFields:Bg(),partFields:Fg(),factory:function(n,e,t){return Z({dom:{attributes:{role:"toolbar"}}},{uid:n.uid(),dom:n.dom(),components:e,behaviours:Z(wo([kc.config({mode:"flow",selector:"."+n.markers().itemClass()})]),Dc(n.tgroupBehaviours())),"debug.sketcher":t["debug.sketcher"]})}}),Hg="data-"+nu.resolve("horizontal-scroll"),zg=function(n){return"true"===Ao.get(n,Hg)?0<(t=n).dom().scrollLeft||function(n){n.dom().scrollLeft=1;var e=0!==n.dom().scrollLeft;return n.dom().scrollLeft=0,e}(t):0<(e=n).dom().scrollTop||function(n){n.dom().scrollTop=1;var e=0!==n.dom().scrollTop;return n.dom().scrollTop=0,e}(e);var e,t},jg={exclusive:function(n,e){return dm(n,"touchmove",function(n){Cu(n.target(),e).filter(zg).fold(function(){n.raw().preventDefault()},B)})},markAsHorizontal:function(n){Ao.set(n,Hg,"true")}},Lg=function(n,e){Dd.append(n,fd(e))},Ug=function(n,e){Dd.remove(n,e)},Pg=function(n){return sd(As.sketch({dom:Ns('<div class="${prefix}-mask-edit-icon ${prefix}-icon"></div>'),action:function(){n.run(function(n){n.setReadOnly(!1)})}}))},_g=function(){return sd(Kf.sketch({dom:Ns('<div class="${prefix}-editor-socket"></div>'),components:[],containerBehaviours:wo([Dd.config({})])}))},Wg=function(n,e,t,r){(!0===t?qo.toAlpha:qo.toOmega)(r),(t?Lg:Ug)(n,e)},$g=function(n,e){return e.getAnimationRoot().fold(function(){return n.element()},function(e){return e(n)})},Gg=function(n){return n.dimension().property()},qg=function(n,e){return n.dimension().getDimension()(e)},Yg=function(n,e){var t=$g(n,e);Jl(t,[e.shrinkingClass(),e.growingClass()])},Xg=function(n,e){_o.remove(n.element(),e.openClass()),_o.add(n.element(),e.closedClass()),du.set(n.element(),Gg(e),"0px"),du.reflow(n.element())},Kg=function(n,e){_o.remove(n.element(),e.closedClass()),_o.add(n.element(),e.openClass()),du.remove(n.element(),Gg(e))},Jg=function(n,e,t){t.setCollapsed(),du.set(n.element(),Gg(e),qg(e,n.element())),du.reflow(n.element());var r=$g(n,e);_o.add(r,e.shrinkingClass()),Xg(n,e),e.onStartShrink()(n)},Qg=function(n,e,t){var r=function(n,e){Kg(n,e);var t=qg(e,n.element());return Xg(n,e),t}(n,e),o=$g(n,e);_o.add(o,e.growingClass()),Kg(n,e),du.set(n.element(),Gg(e),r),t.setExpanded(),e.onStartGrow()(n)},Zg=function(n,e){var t=$g(n,e);return!0===_o.has(t,e.growingClass())},nv=function(n,e){var t=$g(n,e);return!0===_o.has(t,e.shrinkingClass())},ev=Object.freeze({grow:function(n,e,t){t.isExpanded()||Qg(n,e,t)},shrink:function(n,e,t){t.isExpanded()&&Jg(n,e,t)},immediateShrink:function(n,e,t){var r,o;t.isExpanded()&&(r=n,o=e,t.setCollapsed(),du.set(r.element(),Gg(o),qg(o,r.element())),du.reflow(r.element()),Yg(r,o),Xg(r,o),o.onStartShrink()(r),o.onShrunk()(r))},hasGrown:function(n,e,t){return t.isExpanded()},hasShrunk:function(n,e,t){return t.isCollapsed()},isGrowing:Zg,isShrinking:nv,isTransitioning:function(n,e){return!0===Zg(n,e)||!0===nv(n,e)},toggleGrow:function(n,e,t){(t.isExpanded()?Jg:Qg)(n,e,t)},disableTransitions:Yg}),tv=Object.freeze({exhibit:function(n,e){var t=e.expanded();return io(t?{classes:[e.openClass()],styles:{}}:{classes:[e.closedClass()],styles:Zt(e.dimension().property(),"0px")})},events:function(n,e){return Wr([Gr(On(),function(t,r){r.event().raw().propertyName===n.dimension().property()&&(Yg(t,n),e.isExpanded()&&du.remove(t.element(),n.dimension().property()),(e.isExpanded()?n.onGrown():n.onShrunk())(t))})])}}),rv=[Ir("closedClass"),Ir("openClass"),Ir("shrinkingClass"),Ir("growingClass"),Vr("getAnimationRoot"),Ri("onShrunk"),Ri("onStartShrink"),Ri("onGrown"),Ri("onStartGrow"),jr("expanded",!1),Nr("dimension",Ar("property",{width:[Bi("property","width"),Bi("getDimension",function(n){return vf(n)+"px"})],height:[Bi("property","height"),Bi("getDimension",function(n){return gu(n)+"px"})]}))],ov=Object.freeze({init:function(n){var e=Yo(n.expanded());return yo({isExpanded:function(){return!0===e.get()},isCollapsed:function(){return!1===e.get()},setCollapsed:z(e.set,!1),setExpanded:z(e.set,!0),readState:function(){return"expanded: "+e.get()}})}}),iv=To({fields:rv,name:"sliding",active:tv,apis:ev,state:ov}),uv=function(n,e){var t=sd(Kf.sketch({dom:{tag:"div",classes:[nu.resolve("dropup")]},components:[],containerBehaviours:wo([Dd.config({}),iv.config({closedClass:nu.resolve("dropup-closed"),openClass:nu.resolve("dropup-open"),shrinkingClass:nu.resolve("dropup-shrinking"),growingClass:nu.resolve("dropup-growing"),dimension:{property:"height"},onShrunk:function(t){n(),e(),Dd.set(t,[])},onGrown:function(){n(),e()}}),Ji(function(){r(B)})])})),r=function(n){window.requestAnimationFrame(function(){n(),iv.shrink(t)})};return{appear:function(n,e,r){!0===iv.hasShrunk(t)&&!1===iv.isTransitioning(t)&&window.requestAnimationFrame(function(){e(r),Dd.set(t,[n()]),iv.grow(t)})},disappear:r,component:V(t),element:t.element}},av=pe.detect().browser.isFirefox(),cv=gr([Br("triggerEvent"),Br("broadcastEvent"),jr("stopBackspace",!0)]),sv=function(n,e){var t,r,o,i,u=kr("Getting GUI events settings",cv,e),a=pe.detect().deviceType.isTouch()?["touchstart","touchmove","touchend","gesturestart"]:["mousedown","mouseup","mouseover","mousemove","mouseout","click"],c=ym(u),s=$n(a.concat(["selectstart","input","contextmenu","change","transitionend","drag","dragstart","dragend","dragenter","dragleave","dragover","drop"]),function(e){return dm(n,e,function(n){c.fireIfReady(n,e).each(function(e){e&&n.kill()}),u.triggerEvent(e,n)&&n.kill()})}),f=dm(n,"keydown",function(n){var e;u.triggerEvent("keydown",n)?n.kill():!0!==u.stopBackspace||8!==(e=n).raw().which||_n(["input","textarea"],We.name(e.target()))||n.prevent()}),l=(t=n,r=function(n){u.triggerEvent("focusin",n)&&n.kill()},av?mm(t,"focus",r):dm(t,"focusin",r)),d=(o=n,i=function(n){u.triggerEvent("focusout",n)&&n.kill(),setTimeout(function(){u.triggerEvent(ye(),n)},0)},av?mm(o,"blur",i):dm(o,"focusout",i)),m=ht.defaultView(n),g=dm(m,"scroll",function(n){u.broadcastEvent(Ee(),n)&&n.kill()});return{unbind:function(){Gn(s,function(n){n.unbind()}),f.unbind(),l.unbind(),d.unbind(),g.unbind()}}},fv=function(n,e){var t=Qt(n,"target").map(function(n){return n()}).getOr(e);return Yo(t)},lv=Bt([{stopped:[]},{resume:["element"]},{complete:[]}]),dv=function(n,e,t,r,o,i){var u,a,c,s,f=n(e,r),l=(u=t,a=o,c=Yo(!1),s=Yo(!1),{stop:function(){c.set(!0)},cut:function(){s.set(!0)},isStopped:c.get,isCut:s.get,event:V(u),setSource:a.set,getSource:a.get});return f.fold(function(){return i.logEventNoHandlers(e,r),lv.complete()},function(n){var t=n.descHandler();return Pl(t)(l),l.isStopped()?(i.logEventStopped(e,n.element(),t.purpose()),lv.stopped()):l.isCut()?(i.logEventCut(e,n.element(),t.purpose()),lv.complete()):ht.parent(n.element()).fold(function(){return i.logNoParent(e,n.element(),t.purpose()),lv.complete()},function(r){return i.logEventResponse(e,n.element(),t.purpose()),lv.resume(r)})})},mv=function(n,e,t,r,o,i){return dv(n,e,t,r,o,i).fold(function(){return!0},function(r){return mv(n,e,t,r,o,i)},function(){return!1})},gv=function(n,e){var t,r,o=(t=e,r=Yo(!1),{stop:function(){r.set(!0)},cut:B,isStopped:r.get,isCut:V(!1),event:V(t),setSource:L("Cannot set source of a broadcasted event"),getSource:L("Cannot get source of a broadcasted event")});return Gn(n,function(n){var e=n.descHandler();Pl(e)(o)}),o.isStopped()},vv=function(n,e,t,r,o){var i=fv(t,r);return mv(n,e,t,r,i,o)},pv=function(n,e,t){return Qo.closest(n,function(n){return e(n).isSome()},t).bind(e)},hv=Ye("element","descHandler"),bv=function(n,e){return{id:V(n),descHandler:V(e)}},yv=function(n){var e=function(e){return ht.parent(n.element()).fold(function(){return!0},function(n){return ft(e,n)})},t=g(),r=function(n,r){return t.find(e,n,r)},o=sv(n.element(),{triggerEvent:function(n,e){return Oi(n,e.target(),function(t){return o=r,i=n,a=t,c=(u=e).target(),vv(o,i,u,c,a);var o,i,u,a,c})},broadcastEvent:function(n,e){var r=t.filter(n);return gv(r,e)}}),i=Fl({debugInfo:V("real"),triggerEvent:function(n,e,t){Oi(n,e,function(o){vv(r,n,t,e,o)})},triggerFocus:function(n,e){ws(n).fold(function(){ei(n)},function(){Oi(be(),n,function(t){var o,i,u,a,c,s;o=r,i=be(),u={originator:V(e),kill:B,prevent:B,target:V(n)},c=t,s=fv(u,a=n),dv(o,i,u,a,s,c)})})},triggerEscape:function(n,e){i.triggerEvent("keydown",n.element(),e.event())},getByUid:function(n){return m(n)},getByDom:function(n){return v(n)},build:sd,addToGui:function(n){c(n)},removeFromGui:function(n){s(n)},addToWorld:function(n){u(n)},removeFromWorld:function(n){a(n)},broadcast:function(n){l(n)},broadcastOn:function(n,e){d(n,e)},isConnected:V(!0)}),u=function(n){n.connect(i),We.isText(n.element())||(t.register(n),Gn(n.components(),u),i.triggerEvent(ke(),n.element(),{target:V(n.element())}))},a=function(n){We.isText(n.element())||(Gn(n.components(),a),t.unregister(n)),n.disconnect()},c=function(e){Et(n,e)},s=function(n){Rt(n)},f=function(n){var e=t.filter(we());Gn(e,function(e){var t=e.descHandler();Pl(t)(n)})},l=function(n){f({universal:V(!0),data:V(n)})},d=function(n,e){f({universal:V(!1),channels:V(n),data:V(e)})},m=function(n){return t.getById(n).fold(function(){return Nt.error(new Error('Could not find component with uid: "'+n+'" in system.'))},Nt.value)},v=function(n){var e=ws(n).getOr("not found");return m(e)};return u(n),{root:V(n),element:n.element,destroy:function(){o.unbind(),Ot.remove(n.element())},add:c,remove:s,getByUid:m,getByDom:v,addToWorld:u,removeFromWorld:a,broadcast:l,broadcastOn:d}},wv=V(nu.resolve("readonly-mode")),xv=V(nu.resolve("edit-mode")),Tv=function(n,e){var t=Ve.fromTag("input");du.setAll(t,{opacity:"0",position:"absolute",top:"-1000px",left:"-1000px"}),wt.append(n,t),ei(t),e(t),Ot.remove(t)},Sv=function(n){var e=n.getSelection();if(0<e.rangeCount){var t=e.getRangeAt(0),r=n.document.createRange();r.setStart(t.startContainer,t.startOffset),r.setEnd(t.endContainer,t.endOffset),e.removeAllRanges(),e.addRange(r)}},Ov=function(n,e){ri().each(function(n){ft(n,e)||ti(n)}),n.focus(),ei(Ve.fromDom(n.document.body)),Sv(n)},Cv={stubborn:function(n,e,t,r){var o=function(){Ov(e,r)},i=dm(t,"keydown",function(n){_n(["input","textarea"],We.name(n.target()))||o()});return{toReading:function(){Tv(n,ti)},toEditing:o,onToolbarTouch:function(){},destroy:function(){i.unbind()}}},timid:function(n,e,t,r){var o=function(){ti(r)};return{toReading:function(){o()},toEditing:function(){Ov(e,r)},onToolbarTouch:function(){o()},destroy:B}}},kv=function(n,e,t,r){var o=function(){e.run(function(n){n.refreshSelection()})},i=function(n,t){var o=n-r.dom().scrollTop;e.run(function(n){n.scrollIntoView(o,o+t)})},u=function(){e.run(function(n){n.clearSelection()})},a=function(){n.getCursorBox().each(function(n){i(n.top(),n.height())}),e.run(function(n){n.syncHeight()})},c=wm(n),s=Eg(a,300),f=[n.onKeyup(function(){u(),s.throttle()}),n.onNodeChanged(o),n.onDomChanged(s.throttle),n.onDomChanged(o),n.onScrollToCursor(function(n){n.preventDefault(),s.throttle()}),n.onScrollToElement(function(n){n.element(),i(e,r)}),n.onToEditing(function(){e.run(function(n){n.toEditing()})}),n.onToReading(function(){e.run(function(n){n.toReading()})}),dm(n.doc(),"touchend",function(e){ft(n.html(),e.target())||ft(n.body(),e.target())}),dm(t,"transitionend",function(n){var r;"height"===n.raw().propertyName&&(r=gu(t),e.run(function(n){n.setViewportOffset(r)}),o(),a())}),mm(t,"touchstart",function(t){var r;e.run(function(n){n.highlightSelection()}),r=t,e.run(function(n){n.onToolbarTouch(r)}),n.onTouchToolstrip()}),dm(n.body(),"touchstart",function(e){u(),n.onTouchContent(),c.fireTouchstart(e)}),c.onTouchmove(),c.onTouchend(),dm(n.body(),"click",function(n){n.kill()}),dm(t,"touchmove",function(){n.onToolbarScrollStart()})];return{destroy:function(){Gn(f,function(n){n.unbind()})}}},Ev=function(n){var e=an.none(),t=[],r=function(n){o()?u(n):t.push(n)},o=function(){return e.isSome()},i=function(n){Gn(n,u)},u=function(n){e.each(function(e){setTimeout(function(){n(e)},0)})};return n(function(n){e=an.some(n),i(t),t=[]}),{get:r,map:function(n){return Ev(function(e){r(function(t){e(n(t))})})},isReady:o}},Dv={nu:Ev,pure:function(n){return Ev(function(e){e(n)})}},Av=function(n){var e=function(e){var t;n((t=e,function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var r=this;setTimeout(function(){t.apply(r,n)},0)}))},t=function(){return Dv.nu(e)};return{map:function(n){return Av(function(t){e(function(e){var r=n(e);t(r)})})},bind:function(n){return Av(function(t){e(function(e){n(e).get(t)})})},anonBind:function(n){return Av(function(t){e(function(){n.get(t)})})},toLazy:t,toCached:function(){var n=null;return Av(function(e){null===n&&(n=t()),n.get(e)})},get:e}},Rv={nu:Av,pure:function(n){return Av(function(e){e(n)})}},Mv=function(n,e,t){return Math.abs(n-e)<=t?an.none():n<e?an.some(n+t):an.some(n-t)},Iv=function(){var n=null;return{animate:function(e,t,r,o,i,u){var a=!1,c=function(n){a=!0,i(n)};clearInterval(n);var s=function(e){clearInterval(n),c(e)};n=setInterval(function(){var i=e();Mv(i,t,r).fold(function(){clearInterval(n),c(t)},function(r){if(o(r,s),!a){var u=e();(u!==r||Math.abs(u-t)>Math.abs(i-t))&&(clearInterval(n),c(t))}})},u)}}},Nv=function(n,e){return yi([{width:320,height:480,keyboard:{portrait:300,landscape:240}},{width:320,height:568,keyboard:{portrait:300,landscape:240}},{width:375,height:667,keyboard:{portrait:305,landscape:240}},{width:414,height:736,keyboard:{portrait:320,landscape:240}},{width:768,height:1024,keyboard:{portrait:320,landscape:400}},{width:1024,height:1366,keyboard:{portrait:380,landscape:460}}],function(t){return n<=t.width&&e<=t.height?an.some(t.keyboard):an.none()}).getOr({portrait:e/5,landscape:n/4})},Bv=function(n){var e,t=vm(n).isPortrait(),r=Nv((e=n).screen.width,e.screen.height),o=t?r.portrait:r.landscape;return(t?n.screen.height:n.screen.width)-n.innerHeight>o?0:o},Fv=function(n,e){var t=ht.owner(n).dom().defaultView;return gu(n)+gu(e)-Bv(t)},Vv=Fv,Hv=function(n,e,t){var r=Fv(e,t),o=gu(e)+gu(t)-r;du.set(n,"padding-bottom",o+"px")},zv=Bt([{fixed:["element","property","offsetY"]},{scroller:["element","offsetY"]}]),jv="data-"+nu.resolve("position-y-fixed"),Lv="data-"+nu.resolve("y-property"),Uv="data-"+nu.resolve("scrolling"),Pv="data-"+nu.resolve("last-window-height"),_v=function(n){return Sm(n,jv)},Wv=function(n,e){var t=Ao.get(n,Lv);return zv.fixed(n,t,e)},$v=function(n,e){return zv.scroller(n,e)},Gv=function(n){var e=_v(n);return("true"===Ao.get(n,Uv)?$v:Wv)(n,e)},qv=function(n,e,t){var r=ht.owner(n).dom().defaultView.innerHeight;return Ao.set(n,Pv,r+"px"),r-e-t},Yv=function(n){var e=wu(n,"["+jv+"]");return $n(e,Gv)},Xv=function(n,e,t,r){var o,i,u,a,c,s,f,l,d=ht.owner(n).dom().defaultView,m=(l=Ao.get(f=t,"style"),du.setAll(f,{position:"absolute",top:"0px"}),Ao.set(f,jv,"0px"),Ao.set(f,Lv,"top"),{restore:function(){Ao.set(f,"style",l||""),Ao.remove(f,jv),Ao.remove(f,Lv)}}),g=gu(t),v=gu(r),p=(u=g,a=qv(n,g,v),s=Ao.get(c=n,"style"),Wd.register(c),du.setAll(c,{position:"absolute",height:a+"px",width:"100%",top:u+"px"}),Ao.set(c,jv,u+"px"),Ao.set(c,Uv,"true"),Ao.set(c,Lv,"top"),{restore:function(){Wd.deregister(c),Ao.set(c,"style",s||""),Ao.remove(c,jv),Ao.remove(c,Uv),Ao.remove(c,Lv)}}),h=(i=Ao.get(o=r,"style"),du.setAll(o,{position:"absolute",bottom:"0px"}),Ao.set(o,jv,"0px"),Ao.set(o,Lv,"bottom"),{restore:function(){Ao.set(o,"style",i||""),Ao.remove(o,jv),Ao.remove(o,Lv)}}),b=!0,y=function(){var e=d.innerHeight;return Sm(n,Pv)<e},w=function(){if(b){var o=gu(t),i=gu(r),u=qv(n,o,i);Ao.set(n,jv,o+"px"),du.set(n,"height",u+"px"),du.set(r,"bottom",-(o+u+i)+"px"),Hv(e,n,r)}};return Hv(e,n,r),{setViewportOffset:function(e){Ao.set(n,jv,e+"px"),w()},isExpanding:y,isShrinking:j(y),refresh:w,restore:function(){b=!1,m.restore(),p.restore(),h.restore()}}},Kv=_v,Jv=Iv(),Qv="data-"+nu.resolve("last-scroll-top"),Zv=function(n){var e=du.getRaw(n,"top").getOr("0");return parseInt(e,10)},np=function(n){return parseInt(n.dom().scrollTop,10)},ep=function(n,e){var t=e+Kv(n)+"px";du.set(n,"top",t)},tp=function(n,e,t){return Rv.nu(function(r){var o=z(np,n);Jv.animate(o,e,15,function(e){n.dom().scrollTop=e,du.set(n,"top",Zv(n)+15+"px")},function(){n.dom().scrollTop=e,du.set(n,"top",t+"px"),r(e)},10)})},rp=function(n,e){return Rv.nu(function(t){var r=z(np,n);Ao.set(n,Qv,r());var o=Math.abs(e-r()),i=Math.ceil(o/10);Jv.animate(r,e,i,function(e,t){Sm(n,Qv)!==n.dom().scrollTop?t(n.dom().scrollTop):(n.dom().scrollTop=e,Ao.set(n,Qv,e))},function(){n.dom().scrollTop=e,Ao.set(n,Qv,e),t(e)},10)})},op=function(n,e){return Rv.nu(function(t){var r=z(Zv,n),o=function(e){du.set(n,"top",e+"px")},i=Math.abs(e-r()),u=Math.ceil(i/10);Jv.animate(r,e,u,o,function(){o(e),t(e)},10)})},ip=function(n,e,t){var r=ht.owner(n).dom().defaultView;return Rv.nu(function(o){ep(n,t),ep(e,t),r.scrollTo(0,t),o(t)})},up=function(n,e,t,r,o){var i=Vv(e,t),u=z(Sv,n);i<r||i<o?rp(e,e.dom().scrollTop-i+o).get(u):r<0&&rp(e,e.dom().scrollTop+r).get(u)},ap=function(n,e){return e(function(e){var t=[],r=0;0===n.length?e([]):Gn(n,function(o,i){var u;o.get((u=i,function(o){t[u]=o,++r>=n.length&&e(t)}))})})},cp=function(n,e){return n.fold(function(n,t,r){return o=n,i=t,a=e+(u=r),du.set(o,i,a+"px"),Rv.pure(u);var o,i,u,a},function(n,t){return r=n,i=e+(o=t),u=du.getRaw(r,"top").getOr(o),a=i-parseInt(u,10),c=r.dom().scrollTop+a,tp(r,c,i);var r,o,i,u,a,c})},sp=function(n,e){var t=Yv(n),r=$n(t,function(n){return cp(n,e)});return ap(r,Rv.nu)},fp=function(n,e,t,r,o,i){var u,a,c=(u=function(t){return ip(n,e,t)},a=Yo(Dv.pure({})),{start:function(n){var e=Dv.nu(function(e){return u(n).get(e)});a.set(e)},idle:function(n){a.get().get(function(){n()})}}),s=Eg(function(){c.idle(function(){sp(t,r.pageYOffset).get(function(){var n;(n=rg(i),an.from(n[0]).bind(function(n){var t=n.top()-e.dom().scrollTop;return t>r.innerHeight+5||t<-5?an.some({top:V(t),bottom:V(t+n.height())}):an.none()})).each(function(n){e.dom().scrollTop=e.dom().scrollTop+n.top()}),c.start(0),o.refresh()})})},1e3),f=dm(Ve.fromDom(r),"scroll",function(){r.pageYOffset<0||s.throttle()});return sp(t,r.pageYOffset).get(H),{unbind:f.unbind}},lp=function(n){var e=n.cWin(),t=n.ceBody(),r=n.socket(),o=n.toolstrip(),i=n.toolbar(),u=n.contentElement(),a=n.keyboardType(),c=n.outerWindow(),s=n.dropup(),f=Xv(r,t,o,s),l=a(n.outerBody(),e,qe.body(),u,o,i),d=pm(c,{onChange:B,onReady:f.refresh});d.onAdjustment(function(){f.refresh()});var m=dm(Ve.fromDom(c),"resize",function(){f.isExpanding()&&f.refresh()}),g=fp(o,r,n.outerBody(),c,f,e),v=function(n,e){var t=n.document,r=Ve.fromTag("div");_o.add(r,nu.resolve("unfocused-selections")),wt.append(Ve.fromDom(t.documentElement),r);var o=dm(r,"touchstart",function(t){t.prevent(),Ov(n,e),u()}),i=function(n){var e=Ve.fromTag("span");return Kl(e,[nu.resolve("layer-editor"),nu.resolve("unfocused-selection")]),du.setAll(e,{left:n.left()+"px",top:n.top()+"px",width:n.width()+"px",height:n.height()+"px"}),e},u=function(){Ot.empty(r)};return{update:function(){u();var e=rg(n),t=$n(e,i);Tt(r,t)},isActive:function(){return 0<ht.children(r).length},destroy:function(){o.unbind(),Ot.remove(r)},clear:u}}(e,u),p=function(){v.clear()};return{toEditing:function(){l.toEditing(),p()},toReading:function(){l.toReading()},onToolbarTouch:function(n){l.onToolbarTouch(n)},refreshSelection:function(){v.isActive()&&v.update()},clearSelection:p,highlightSelection:function(){v.update()},scrollIntoView:function(n,t){up(e,r,s,n,t)},updateToolbarPadding:B,setViewportOffset:function(n){f.setViewportOffset(n),op(r,n).get(H)},syncHeight:function(){du.set(u,"height",u.dom().contentWindow.document.body.scrollHeight+"px")},refreshStructure:f.refresh,destroy:function(){f.restore(),d.destroy(),g.unbind(),m.unbind(),l.destroy(),v.destroy(),Tv(qe.body(),ti)}}},dp=function(n,e){var t=Cg(),r=Cl(),o=Cl(),i=Ol(),u=Ol();return{enter:function(){e.hide();var a=Ve.fromDom(document);bg.getActiveApi(n.editor).each(function(e){r.set({socketHeight:du.getRaw(n.socket,"height"),iframeHeight:du.getRaw(e.frame(),"height"),outerScroll:document.body.scrollTop}),o.set({exclusives:jg.exclusive(a,"."+Wd.scrollable())}),_o.add(n.container,nu.resolve("fullscreen-maximized")),Sg(n.container,e.body()),t.maximize(),du.set(n.socket,"overflow","scroll"),du.set(n.socket,"-webkit-overflow-scrolling","touch"),ei(e.body());var c=nt(["cWin","ceBody","socket","toolstrip","toolbar","dropup","contentElement","cursor","keyboardType","isScrolling","outerWindow","outerBody"],[]);i.set(lp(c({cWin:e.win(),ceBody:e.body(),socket:n.socket,toolstrip:n.toolstrip,toolbar:n.toolbar,dropup:n.dropup.element(),contentElement:e.frame(),cursor:B,outerBody:n.body,outerWindow:n.win,keyboardType:Cv.stubborn,isScrolling:function(){return o.get().exists(function(n){return n.socket.isScrolling()})}}))),i.run(function(n){n.syncHeight()}),u.set(kv(e,i,n.toolstrip,n.socket,n.dropup))})},refreshStructure:function(){i.run(function(n){n.refreshStructure()})},exit:function(){t.restore(),u.clear(),i.clear(),e.show(),r.on(function(e){e.socketHeight.each(function(e){du.set(n.socket,"height",e)}),e.iframeHeight.each(function(e){du.set(n.editor.getFrame(),"height",e)}),document.body.scrollTop=e.scrollTop}),r.clear(),o.on(function(n){n.exclusives.unbind()}),o.clear(),_o.remove(n.container,nu.resolve("fullscreen-maximized")),Og(),Wd.deregister(n.toolbar),du.remove(n.socket,"overflow"),du.remove(n.socket,"-webkit-overflow-scrolling"),ti(n.editor.getFrame()),bg.getActiveApi(n.editor).each(function(n){n.clearSelection()})}}},mp=function(n){var e=kr("Getting IosWebapp schema",Ag,n);du.set(e.toolstrip,"width","100%"),du.set(e.container,"position","relative");var t=sd(Dg(function(){e.setReadOnly(e.readOnlyOnInit()),r.enter()},e.translate));e.alloy.add(t);var r=dp(e,{show:function(){e.alloy.add(t)},hide:function(){e.alloy.remove(t)}});return{setReadOnly:e.setReadOnly,refreshStructure:r.refreshStructure,enter:r.enter,exit:r.exit,destroy:B}},gp=tinymce.util.Tools.resolve("tinymce.EditorManager"),vp=function(n){var e=Qt(n.settings,"skin_url").fold(function(){return gp.baseURL+"/skins/lightgray"},function(n){return n});return{content:e+"/content.mobile.min.css",ui:e+"/skin.mobile.min.css"}},pp=function(n,e,t){n.system().broadcastOn([ci.formatChanged()],{command:e,state:t})},hp=function(n,e){var t=cn(e.formatter.get());Gn(t,function(t){e.formatter.formatChanged(t,function(e){pp(n,t,e)})}),Gn(["ul","ol"],function(t){e.selection.selectorChanged(t,function(e){pp(n,t,e)})})},bp=(V(["x-small","small","medium","large","x-large"]),function(n){var e=function(){n._skinLoaded=!0,n.fire("SkinLoaded")};return function(){n.initialized?e():n.on("init",e)}}),yp=V("toReading"),wp=V("toEditing");ui.add("mobile",function(n){return{getNotificationManagerImpl:function(){return{open:H,close:B,reposition:B,getArgs:H}},renderUI:function(e){var t=vp(n);0==(!1===n.settings.skin)?(n.contentCSS.push(t.content),ii.DOM.styleSheetLoader.load(t.ui,bp(n))):bp(n)();var r,o,i,u,a,c,s,f,l,m,g,p,h,b,y=function(){n.fire("scrollIntoView")},w=Ve.fromTag("div"),x=pe.detect().os.isAndroid()?(f=y,l=v({classes:[nu.resolve("android-container")]}),m=d(),g=Ol(),p=Pg(g),h=_g(),b=uv(B,f),l.add(m.wrapper()),l.add(h),l.add(b.component()),{system:V(l),element:l.element,init:function(n){g.set(Rg(n))},exit:function(){g.run(function(n){n.exit(),Dd.remove(h,p)})},setToolbarGroups:function(n){var e=m.createGroups(n);m.setGroups(e)},setContextToolbar:function(n){var e=m.createGroups(n);m.setContextToolbar(e)},focusToolbar:function(){m.focus()},restoreToolbar:function(){m.restoreToolbar()},updateMode:function(n){Wg(h,p,n,l.root())},socket:V(h),dropup:V(b)
}):(r=y,o=v({classes:[nu.resolve("ios-container")]}),i=d(),u=Ol(),a=Pg(u),c=_g(),s=uv(function(){u.run(function(n){n.refreshStructure()})},r),o.add(i.wrapper()),o.add(c),o.add(s.component()),{system:V(o),element:o.element,init:function(n){u.set(mp(n))},exit:function(){u.run(function(n){Dd.remove(c,a),n.exit()})},setToolbarGroups:function(n){var e=i.createGroups(n);i.setGroups(e)},setContextToolbar:function(n){var e=i.createGroups(n);i.setContextToolbar(e)},focusToolbar:function(){i.focus()},restoreToolbar:function(){i.restoreToolbar()},updateMode:function(n){Wg(c,a,n,o.root())},socket:V(c),dropup:V(s)}),T=Ve.fromDom(e.targetNode);wt.after(T,w),function(n,e){wt.append(n,e.element());var t=ht.children(e.element());Gn(t,function(n){e.getByDom(n).each(kt)})}(w,x.system());var S=e.targetNode.ownerDocument.defaultView,O=pm(S,{onChange:function(){x.system().broadcastOn([ci.orientationChanged()],{width:hm(S)})},onReady:B}),C=function(e,t,r,o){!1===o&&n.selection.collapse();var i=k(e,t,r);x.setToolbarGroups(!0===o?i.readOnly:i.main),n.setMode(!0===o?"readonly":"design"),n.fire(!0===o?yp():wp()),x.updateMode(o)},k=function(n,e,t){var r=n.get();return{readOnly:r.backToMask.concat(e.get()),main:r.backToMask.concat(t.get())}},E=function(e,t){return n.on(e,t),{unbind:function(){n.off(e)}}};return n.on("init",function(){x.init({editor:{getFrame:function(){return Ve.fromDom(n.contentAreaContainer.querySelector("iframe"))},onDomChanged:function(){return{unbind:B}},onToReading:function(n){return E(yp(),n)},onToEditing:function(n){return E(wp(),n)},onScrollToCursor:function(e){return n.on("scrollIntoView",function(n){e(n)}),{unbind:function(){n.off("scrollIntoView"),O.destroy()}}},onTouchToolstrip:function(){e()},onTouchContent:function(){var t;(t=Ve.fromDom(n.editorContainer.querySelector("."+nu.resolve("toolbar"))),oi(t).bind(function(n){return x.system().getByDom(n).toOption()})).each(Ie),x.restoreToolbar(),e()},onTapContent:function(e){var t=e.target();"img"===We.name(t)?(n.selection.select(t.dom()),e.kill()):"a"===We.name(t)&&x.system().getByDom(Ve.fromDom(n.editorContainer)).each(function(n){qo.isAlpha(n)&&ai(t.dom())})}},container:Ve.fromDom(n.editorContainer),socket:Ve.fromDom(n.contentAreaContainer),toolstrip:Ve.fromDom(n.editorContainer.querySelector("."+nu.resolve("toolstrip"))),toolbar:Ve.fromDom(n.editorContainer.querySelector("."+nu.resolve("toolbar"))),dropup:x.dropup(),alloy:x.system(),translate:B,setReadOnly:function(n){C(s,c,a,n)},readOnlyOnInit:function(){return!1}});var e=function(){x.dropup().disappear(function(){x.system().broadcastOn([ci.dropupDismissed()],{})})},t={label:"The first group",scrollable:!1,items:[Hs.forToolbar("back",function(){n.selection.collapse(),x.exit()},{})]},r={label:"Back to read only",scrollable:!1,items:[Hs.forToolbar("readonly-back",function(){C(s,c,a,!0)},{})]},o=om(x,n),i=im(n.settings,o),u={label:"The extra group",scrollable:!1,items:[]},a=Yo([{label:"the action group",scrollable:!0,items:i},u]),c=Yo([{label:"The read only mode group",scrollable:!0,items:[]},u]),s=Yo({backToMask:[t],backToReadOnly:[r]});hp(x,n)}),{iframeContainer:x.socket().element().dom(),editorContainer:x.element().dom()}}}})}();